var be=Object.defineProperty;var c=(n,e)=>()=>(n&&(e=n(n=0)),e);var F=(n,e)=>{for(var t in e)be(n,t,{get:e[t],enumerable:!0})};var P,N=c(()=>{"use strict";P=class{target;debug;listening=!1;destroyed=!1;domListeners=[];constructor(e,t=!1){if(!(e instanceof EventTarget))throw new Error(`${this.constructor.name}: target must be a valid EventTarget.`);this.target=e,this.debug=t}log(...e){this.debug&&console.log(`[${this.constructor.name}]`,...e)}checkDestroyed(){if(this.destroyed)throw new Error(`${this.constructor.name} has been destroyed.`)}destroy(){if(!this.destroyed){this.log("Destroying watcher");try{this.removeAllDomListeners(),this.removeEventListeners()}finally{this.destroyed=!0}}}addDomListener(e,t){this.target.addEventListener(e,t),this.domListeners.push({type:e,handler:t})}removeAllDomListeners(){for(let{type:e,handler:t}of this.domListeners)this.target.removeEventListener(e,t);this.domListeners=[]}}});var U,o,w=c(()=>{"use strict";U=class{listeners={};anyListeners=[];onceWrappers=new WeakMap;on(e,t,i=0){let r=this.listeners[e]??=[],s={fn:t,priority:i},a=r.length;for(;a>0&&r[a-1].priority<i;)a--;return r.splice(a,0,s),()=>this.off(e,t)}once(e,t,i=0){let r=s=>{this.off(e,r),t(s)};this.onceWrappers.set(t,r),this.on(e,r,i)}onAny(e,t=0){let i={fn:e,priority:t},r=this.anyListeners.length;for(;r>0&&this.anyListeners[r-1].priority<t;)r--;return this.anyListeners.splice(r,0,i),()=>this.offAny(e)}off(e,t){let i=this.listeners[e];if(!i)return;let r=this.onceWrappers.get(t)??t;this.listeners[e]=i.filter(s=>s.fn!==r)}offAny(e){this.anyListeners=this.anyListeners.filter(t=>t.fn!==e)}emit(e,t){if(!e)return this._handleError("Event name is undefined or empty",new Error);let i=this.listeners[e]??[];for(let r of i)try{r.fn(t)}catch(s){this._handleError(`Error in listener for "${e}"`,s)}for(let r of this.anyListeners)try{r.fn(e,t)}catch(s){this._handleError(`Error in any-listener for "${e}"`,s)}}async emitAsync(e,t){if(!e)return this._handleError("Event name is undefined or empty",new Error),[];let i=[],r=this.listeners[e]??[];for(let s of r)try{i.push(await s.fn(t))}catch(a){this._handleError(`Async error in listener for "${e}"`,a)}for(let s of this.anyListeners)try{i.push(await s.fn(e,t))}catch(a){this._handleError(`Async error in any-listener for "${e}"`,a)}return i}removeAllListeners(e){e?e==="any"?this.anyListeners=[]:delete this.listeners[e]:(this.listeners={},this.anyListeners=[])}hasListeners(e){return e==="any"?this.anyListeners.length>0:(this.listeners[e]?.length??0)>0}listenerCount(e){return e==="any"?this.anyListeners.length:this.listeners[e]?.length??0}eventNames(){return Object.keys(this.listeners).filter(e=>this.listeners[e].length>0)}getListeners(e){return e==="any"?this.anyListeners.map(t=>t.fn):(this.listeners[e]??[]).map(t=>t.fn)}_handleError(e,t){if(console.error(e,t),!e.includes("eventbus:error"))try{this.emit("eventbus:error",{message:e,error:t})}catch(i){console.error('EventBus failed to emit "eventbus:error":',i)}}},o=new U});function re(){let n=null;return{get id(){return n},set(e,t){n!==null&&clearTimeout(n),n=window.setTimeout(()=>{n=null,e()},t)},cancel(){n!==null&&(clearTimeout(n),n=null)}}}function T(n,e=300,t=!1){let i=re();function r(...s){let a=t&&i.id===null;i.set(()=>{t||n.apply(this,s)},e),a&&n.apply(this,s)}return r.cancel=()=>i.cancel(),r}function S(n,e=100,t={}){let{leading:i=!0,trailing:r=!0}=t,s=0,a=null,l=null,d=re();function h(){s=i?Date.now():0,n.apply(l,a),a=l=null}function u(...m){let g=Date.now();s===0&&!i&&(s=g),a=m,l=this;let f=e-(g-s);f<=0||f>e?(d.cancel(),h()):d.id===null&&r&&d.set(()=>{r&&a&&h()},f)}return u.cancel=()=>{d.cancel(),s=0,a=l=null},u}var B=c(()=>{"use strict"});var E,$=c(()=>{"use strict";N();w();B();E=class n extends P{static _instance=null;inactivityDelay;lastActiveAt;timer;userIsInactive=!1;constructor(e,t){super(e,t.debug??!1),this.inactivityDelay=t.inactivityDelay,this.lastActiveAt=Date.now(),this.log(`Initialized with inactivityDelay=${this.inactivityDelay}ms`),this.addEventListeners()}static getInstance(e){return this._instance||(this._instance=new n(e.target??document,e)),this._instance}addEventListeners(){let e=S(()=>this.resetTimer(),200);this.target.addEventListener("mousemove",e),this.target.addEventListener("keydown",e),this.target.addEventListener("scroll",e),this.target.addEventListener("visibilitychange",e),this.resetTimer()}removeEventListeners(){this.target.removeEventListener("mousemove",this.resetTimer),this.target.removeEventListener("keydown",this.resetTimer),this.target.removeEventListener("scroll",this.resetTimer),this.target.removeEventListener("visibilitychange",this.resetTimer),this.timer&&clearTimeout(this.timer)}resetTimer(){let e=Date.now();this.lastActiveAt=e,this.userIsInactive&&(this.userIsInactive=!1,o.emit("user:active",{lastActiveAt:this.lastActiveAt,inactivityDelay:this.inactivityDelay,visible:document.visibilityState==="visible"}),this.log("User is active")),this.timer&&clearTimeout(this.timer),this.timer=window.setTimeout(()=>this.setInactive(),this.inactivityDelay)}setInactive(){this.userIsInactive=!0;let e=Date.now();o.emit("user:inactive",{lastActiveAt:this.lastActiveAt,inactiveAt:e,inactivityDelay:this.inactivityDelay,visible:document.visibilityState==="visible"}),this.log("User is inactive")}}});var b,De,x=c(()=>{"use strict";w();b=class n{IBusBindings=[];domBindings=[];debugMode;constructor(e=!1){this.debugMode=e}debug(e,t){if(this.debugMode)try{let i={method:e,details:t};o.emit("debug:EventBinder",i)}catch{}}attachTo(e){if(e.aborted){this.unbindAll();return}let t=()=>this.unbindAll();e.addEventListener("abort",t,{once:!0})}bindBus(e,t){if(this.IBusBindings.find(i=>i.event===e&&i.handler===t)){this.debug("bus:bind:duplicate",{event:e,handler:t});return}try{let i=o.on(e,t);this.IBusBindings.push({event:e,handler:t,unsubscribe:i}),this.debug("bus:bind",{event:e,handler:t})}catch(i){console.error(`EventBinder: Failed to bind bus event "${e}"`,i)}}bindDOM(e,t,i,r=!1){if(!(e instanceof EventTarget)){console.warn("EventBinder: Invalid DOM target",e);return}if(this.domBindings.find(l=>l.target===e&&l.event===t&&l.handler===i)){this.debug("dom:bind:duplicate",{event:t,handler:i,target:e});return}let s=new AbortController,a=typeof r=="boolean"?{capture:r,signal:s.signal}:{...r,signal:s.signal};try{e.addEventListener(t,i,a),this.domBindings.push({target:e,event:t,handler:i,options:a,controller:s}),this.debug("dom:bind",{event:t,handler:i,target:e})}catch(l){console.error(`EventBinder: Failed to bind DOM event "${t}"`,l)}}unbindAll(){this.debug("unbindAll",{bus:this.IBusBindings.length,dom:this.domBindings.length});for(let e of this.IBusBindings)try{e.unsubscribe(),this.debug("bus:unbind",{event:e.event})}catch(t){console.error(`EventBinder: Failed to unbind bus "${e.event}"`,t)}for(let e of this.domBindings)try{e.controller.abort(),this.debug("dom:unbind",{event:e.event,target:e.target})}catch(t){console.error(`EventBinder: Failed to unbind DOM "${e.event}"`,t)}this.IBusBindings=[],this.domBindings=[]}unbindBus(e,t){let i=this.IBusBindings.findIndex(r=>r.event===e&&r.handler===t);if(i===-1)return!1;try{return this.IBusBindings[i].unsubscribe(),this.IBusBindings.splice(i,1),this.debug("bus:unbind:single",{event:e,handler:t}),!0}catch(r){return console.error(`EventBinder: Failed to unbind bus "${e}"`,r),!1}}unbindDOM(e,t,i){let r=this.domBindings.findIndex(s=>s.target===e&&s.event===t&&s.handler===i);if(r===-1)return!1;try{return this.domBindings[r].controller.abort(),this.domBindings.splice(r,1),this.debug("dom:unbind:single",{event:t,target:e}),!0}catch(s){return console.error(`EventBinder: Failed to unbind DOM "${t}"`,s),!1}}getStats(){return{busEvents:this.IBusBindings.length,domEvents:this.domBindings.length,totalEvents:this.IBusBindings.length+this.domBindings.length}}hasBindings(){return this.IBusBindings.length>0||this.domBindings.length>0}getBindingDetails(){return{bus:this.IBusBindings.map(e=>e.event),dom:this.domBindings.map(e=>`${e.event}@${e.target.constructor.name}`)}}static withAutoUnbind(e,t=!1){let i=new n(t);try{let r=e(i);return r instanceof Promise?r.finally(()=>i.unbindAll()):(i.unbindAll(),r)}catch(r){throw i.unbindAll(),r}}},De=new b});var C,V=c(()=>{"use strict";w();x();C=class{static async load(e,t,i={}){let{replace:r=!0,signal:s,withBindings:a,debugBindings:l=!1}=i,d=async()=>{let h={url:e,targetSelector:t};o.emit("partial:load:start",h);try{let m=await fetch(e,s?{signal:s}:void 0);if(!m.ok)throw new Error(`Fetch failed with status ${m.status}`);let g=(await m.text()).trim(),f=document.querySelector(t);if(!f)throw new Error(`Target container not found: ${t}`);let I=document.createElement("template");return I.innerHTML=g,r?f.replaceChildren(...I.content.childNodes):f.append(...I.content.childNodes),o.emit("partial:load:success",{...h,html:g}),{container:f,html:g}}catch(u){throw o.emit("partial:load:error",{...h,error:u}),u}finally{o.emit("partial:load:complete",h)}};return typeof a=="function"?b.withAutoUnbind(async h=>(s&&h.attachTo(s),a(h),d()),l):d()}}});var se={};F(se,{PartialLoader:()=>D,VERSION:()=>ye});var ye,D,q=c(()=>{"use strict";B();w();ye="nextworld-1.0.0",D=class{cache=new Map;loadingPromises=new Map;loadedPartials=new Map;options;constructor(e={}){this.options={debug:!1,baseUrl:"/",cacheEnabled:!0,timeout:1e4,retryAttempts:3,...e}}logDebug(e,t){this.options.debug&&console.debug(`[PartialLoader] ${e}`,t)}async load(e){let t=Array.isArray(e)?e:[e],i=[];for(let r of t)try{r instanceof HTMLLinkElement?i.push(await this.loadLink(r)):i.push(await this.loadInfo(r))}catch{let s=r instanceof HTMLLinkElement?r.getAttribute("src")||"":r.url;i.push({success:!1,url:s,cached:!1})}return o.emit("partials:allLoaded",{count:i.length}),i}loadLink(e){let t=e.getAttribute("src");if(!t)throw new Error("Partial link missing src");return this.loadUrl(this.resolveUrl(t),e)}loadInfo(e){return this.loadUrl(this.resolveUrl(e.url),e.container,e.id)}async loadUrl(e,t,i){try{if(this.loadingPromises.has(e)&&await this.loadingPromises.get(e),this.options.cacheEnabled&&this.cache.has(e))return this.insertHTML(t,this.cache.get(e)),this.loadedPartials.set(i||e,!0),o.emit("partial:loaded",{url:e,cached:!0}),{success:!0,url:e,cached:!0};let r=this.fetchPartial(e);this.loadingPromises.set(e,r);let s=await r;return this.options.cacheEnabled&&this.cache.set(e,s),this.insertHTML(t,s),this.loadedPartials.set(i||e,!0),o.emit("partial:loaded",{url:e,cached:!1}),{success:!0,url:e,cached:!1}}catch(r){throw this.showError(t,r),o.emit("partial:error",{url:e,error:r}),r}finally{this.loadingPromises.delete(e)}}async fetchPartial(e,t=1){let i=new AbortController,r=setTimeout(()=>i.abort(),this.options.timeout);try{let s=await fetch(e,{signal:i.signal,headers:{Accept:"text/html"}});if(!s.ok)throw new Error(`HTTP ${s.status}`);let a=(await s.text()).trim();if(!a)throw new Error("Empty response");return a}catch(s){if(t<this.options.retryAttempts)return await this.delay(Math.min(2**t*100,5e3)),this.fetchPartial(e,t+1);throw s}finally{clearTimeout(r)}}insertHTML(e,t){let i=document.createElement("template");i.innerHTML=t,e instanceof HTMLLinkElement?e.replaceWith(...i.content.childNodes):e instanceof Element?(e.innerHTML="",e.append(...i.content.childNodes)):e.append(...i.content.childNodes)}showError(e,t){let i=document.createElement("div");i.className="partial-error",i.textContent="Partial load failed",this.options.debug&&(i.textContent+=`: ${t.message}`),e instanceof HTMLLinkElement?e.replaceWith(i):(e instanceof Element&&(e.innerHTML=""),e.appendChild(i))}isPartialLoaded(e){return this.loadedPartials.has(e)}resolveUrl(e){if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e)||e.startsWith("//"))return e;try{let t=this.options.baseUrl||window.location.origin+"/",i=new URL(e,t).toString();return i.startsWith(window.location.origin)?i.slice(window.location.origin.length)||"/":i}catch{return e}}delay(e){return new Promise(t=>setTimeout(t,e))}async loadContainer(e=document){let t=e.querySelectorAll('link[rel="partial"][src]');return t.length?this.load(Array.from(t)):[]}watch(e=document.body){if(!window.MutationObserver)return;let t=new MutationObserver(T(()=>this.loadContainer(e),100));return t.observe(e,{childList:!0,subtree:!0}),t}}});var ne={};F(ne,{ServiceWorkerManager:()=>R,VERSION:()=>we});var we,R,Y=c(()=>{"use strict";we="nextworld-1.0.0",R=class{swPath;options;customConfig;registration=null;isSupported;constructor(e="/sw.js",t={},i={}){this.swPath=e,this.options={scope:"/",updateViaCache:"none",...t},this.customConfig=i,this.isSupported="serviceWorker"in navigator}async register(){if(!this.isSupported)throw new Error("ServiceWorker not supported");try{return this.registration=await navigator.serviceWorker.register(this.swPath,this.options),this.setupEventListeners(),this.registration}catch(e){throw console.error("SW registration failed:",e),e}}configure(){this.customConfig.strategy&&this.setStrategy(this.customConfig.strategy)}async unregister(){if(!this.registration)return!1;try{return await this.registration.unregister()}catch(e){return console.error("SW unregistration failed:",e),!1}}async update(){if(!this.registration)return null;try{return await this.registration.update(),null}catch(e){return console.error("SW update failed:",e),null}}getStatus(){return this.registration?this.registration.installing?"installing":this.registration.waiting?"waiting":this.registration.active?"active":"unknown":"unregistered"}setupEventListeners(){this.registration&&(this.registration.addEventListener("updatefound",()=>{let e=this.registration?.installing;e&&e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&this.onUpdateAvailable?.(e)})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{this.onControllerChange?.()}))}async postMessage(e,t){let i=navigator.serviceWorker.controller;if(!i)throw new Error("No active service worker");t?i.postMessage(e,{transfer:t}):i.postMessage(e)}waitForMessage(e=5e3){return new Promise((t,i)=>{let r=setTimeout(()=>i(new Error("Message timeout")),e),s=a=>{clearTimeout(r),navigator.serviceWorker.removeEventListener("message",s),t(a.data)};navigator.serviceWorker.addEventListener("message",s)})}async activateWaiting(){if(!this.registration?.waiting)return!1;try{return await this.postMessage({type:"SKIP_WAITING"}),!0}catch(e){return console.error("Failed to activate waiting SW:",e),!1}}setStrategy(e={}){if(!navigator.serviceWorker.controller){console.warn("No active SW to set strategy");return}this.postMessage({type:"SET_STRATEGY",payload:e})}}});var L,X=c(()=>{"use strict";L=class{container;includePicture;cache=new WeakMap;destroyed=!1;constructor(e,t={}){if(!(e instanceof Element))throw new Error("AsyncImageLoader: container must be a DOM Element.");this.container=e,this.includePicture=t.includePicture??!1}ensureActive(){if(this.destroyed||!this.container)throw new Error("AsyncImageLoader: Instance destroyed.")}getImages(e="img"){if(this.ensureActive(),!e.trim())return[];let t=new Set;return this.container.querySelectorAll(e).forEach(i=>{if(i instanceof HTMLImageElement){if(!this.includePicture&&i.closest("picture"))return;t.add(i)}}),[...t]}async waitForImagesToLoad(e="img",t=!1){let i=this.getImages(e),r=await Promise.all(i.map(s=>this.cache.has(s)?{element:s,loaded:!0}:s.complete&&s.naturalWidth>0?(this.cache.set(s,!0),{element:s,loaded:!0}):new Promise(a=>{s.addEventListener("load",()=>{this.cache.set(s,!0),a({element:s,loaded:!0})},{once:!0}),s.addEventListener("error",()=>a({element:s,loaded:!1}),{once:!0})})));return t?r:r.filter(s=>s.loaded).map(s=>s.element)}getImageData(e="img"){return this.getImages(e).map(t=>{let i=[];if(this.includePicture){let r=t.closest("picture");r&&r.querySelectorAll("source").forEach(s=>{i.push({srcset:s.srcset||"",type:s.type||"",media:s.media||""})})}return{element:t,src:t.src||"",alt:t.alt||"",href:t.closest("a")?.href??null,sources:i}})}destroy(){this.container=null,this.destroyed=!0}}});var G,p,K=c(()=>{"use strict";G=class{callbacks=new Set;running=!1;_rafId=null;add(e){this.callbacks.has(e)||this.callbacks.add(e),this.start()}remove(e){this.callbacks.delete(e),this.callbacks.size===0&&this.stop()}has(e){return this.callbacks.has(e)}start(){this.running||this.callbacks.size===0||(this.running=!0,this._loop())}stop(){this.running=!1,this._rafId!==null&&cancelAnimationFrame(this._rafId),this._rafId=null}pause(){this.stop()}resume(){this.callbacks.size>0&&this.start()}_loop=()=>{if(this.running){for(let e of this.callbacks)try{e()}catch(t){console.error("AnimationLoop callback error:",t)}this._rafId=requestAnimationFrame(this._loop)}}},p=new G});var ae={};F(ae,{SlidePlayer:()=>Z,VERSION:()=>Ee});var Ee,Z,oe=c(()=>{"use strict";w();x();X();K();Ee="nextworld-1.2.0",Z=class n{static SWIPE_THRESHOLD=50;static VERTICAL_TOLERANCE=30;static DEFAULT_INTERVAL=5e3;container;interval;includePicture;dotsSelector;autoCreateDots;enableBusEvents;autoplay;slides=[];dots=[];dotsWrapper=null;currentIndex=0;lastTickTime=0;isDestroyed=!1;isPointerDown=!1;pointerStartX=0;pointerStartY=0;pointerEndX=0;pointerEndY=0;pauseReasons=new Set;loader;binder;animateCallback;lastPauseState=!1;ready;constructor(e,{interval:t=n.DEFAULT_INTERVAL,includePicture:i=!1,dotsSelector:r=".dots",autoCreateDots:s=!1,startPaused:a=!1,enableBusEvents:l=!0,autoplay:d=!0}={}){this.container=this.resolveContainer(e),this.interval=t>0?t:n.DEFAULT_INTERVAL,this.includePicture=i,this.dotsSelector=r,this.autoCreateDots=s,this.enableBusEvents=l,this.autoplay=d,this.loader=new L(this.container,{includePicture:i}),this.binder=new b(!0),a&&this.pauseReasons.add("manual"),this.animateCallback=()=>this.animate(),this.ready=this.init()}resolveContainer(e){let t=typeof e=="string"?document.querySelector(e):e;if(!t)throw new Error("SlidePlayer: container element not found.");return t}async init(){if(await this.loader.waitForImagesToLoad(),this.refreshSlides(),!this.slides.length){console.warn("[SlidePlayer] No .slide elements found in container.");return}this.setupDots(),this.bindEvents(),this.setActiveSlide(0),this.lastTickTime=performance.now(),this.enableBusEvents&&(this.binder.bindBus("user:inactive",()=>this.togglePause("inactivity",!0)),this.binder.bindBus("user:active",()=>this.togglePause("inactivity",!1))),this.isPaused()||p.add(this.animateCallback)}animate(){if(this.isDestroyed||!this.autoplay||this.isPaused()||this.slides.length<2)return;let e=performance.now();e-this.lastTickTime>=this.interval&&(this.next(!1),this.lastTickTime=e)}togglePause(e,t){t?this.pauseReasons.add(e):this.pauseReasons.delete(e),this.emitPauseResumeIfChanged(),this.isPaused()?p.has(this.animateCallback)&&p.remove(this.animateCallback):p.has(this.animateCallback)||p.add(this.animateCallback)}emitPauseResumeIfChanged(){let e=this.isPaused();e!==this.lastPauseState&&(this.lastPauseState=e,this.emit(e?"slideplayer:paused":"slideplayer:resumed",{reasons:Array.from(this.pauseReasons)}))}goToSlide(e,t=!0){e<0||e>=this.slides.length||e===this.currentIndex||(this.setActiveSlide(e),t&&this.resetTimer())}next(e=!0){this.slides.length<2||this.goToSlide((this.currentIndex+1)%this.slides.length,e)}prev(e=!0){if(this.slides.length<2)return;let t=(this.currentIndex-1+this.slides.length)%this.slides.length;this.goToSlide(t,e)}play(){this.togglePause("manual",!1)}pause(){this.togglePause("manual",!0)}isPaused(){return this.pauseReasons.size>0}refreshSlides(){this.slides=Array.from(this.container.querySelectorAll(".slide"))}setupDots(){this.dotsWrapper=this.container.querySelector(this.dotsSelector),!this.dotsWrapper&&this.autoCreateDots&&(this.dotsWrapper=document.createElement("div"),this.dotsWrapper.className="dots",this.container.appendChild(this.dotsWrapper)),this.dotsWrapper&&(this.dotsWrapper.innerHTML="",this.dots=this.slides.map((e,t)=>{let i=document.createElement("div");return i.className="dot",i.dataset.index=t.toString(),this.binder.bindDOM(i,"click",()=>this.goToSlide(t)),this.dotsWrapper.appendChild(i),i}))}updateDots(e){this.dots.forEach((t,i)=>t.classList.toggle("active",i===e))}setActiveSlide(e){let t=this.currentIndex;this.slides[this.currentIndex]?.classList.remove("active"),this.currentIndex=e,this.slides[this.currentIndex]?.classList.add("active"),this.updateDots(e),t!==e&&this.emit("slideplayer:slideChanged",{index:e},"slideplayer:slide-changed")}resetTimer(){this.lastTickTime=performance.now()}bindEvents(){this.bindPointerEvents(),this.bindKeyboardEvents(),this.bindVisibilityEvents(),this.bindActivityEvents(),this.bindUnloadEvent()}bindPointerEvents(){this.binder.bindDOM(this.container,"pointerdown",e=>{let t=e;this.isPointerDown=!0,this.pointerStartX=t.clientX,this.pointerStartY=t.clientY,this.pointerEndX=t.clientX,this.pointerEndY=t.clientY}),this.binder.bindDOM(this.container,"pointermove",e=>{if(!this.isPointerDown)return;let t=e;this.pointerEndX=t.clientX,this.pointerEndY=t.clientY}),this.binder.bindDOM(this.container,"pointerup",()=>{this.isPointerDown&&(this.handleSwipe(),this.isPointerDown=!1)}),this.binder.bindDOM(this.container,"pointerleave",()=>this.isPointerDown=!1),this.binder.bindDOM(this.container,"mouseenter",()=>this.togglePause("hover",!0)),this.binder.bindDOM(this.container,"mouseleave",()=>this.togglePause("hover",!1))}bindKeyboardEvents(){this.binder.bindDOM(document,"keydown",e=>{let t=e;t.key==="ArrowRight"?this.next():t.key==="ArrowLeft"&&this.prev()})}bindVisibilityEvents(){this.binder.bindDOM(document,"visibilitychange",()=>{this.togglePause("hidden",document.visibilityState==="hidden")})}bindActivityEvents(){this.binder.bindBus("user:inactive",()=>this.togglePause("inactivity",!0)),this.binder.bindBus("user:active",()=>this.togglePause("inactivity",!1))}bindUnloadEvent(){this.binder.bindDOM(window,"beforeunload",()=>this.destroy())}handleSwipe(){let e=this.pointerEndX-this.pointerStartX,t=this.pointerEndY-this.pointerStartY;Math.abs(e)>=n.SWIPE_THRESHOLD&&Math.abs(t)<n.VERTICAL_TOLERANCE&&(e<0?this.next():this.prev())}emit(e,t,i){this.container.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0})),this.enableBusEvents&&i&&o.emit(i,t)}destroy(){this.isDestroyed||(this.isDestroyed=!0,p.remove(this.animateCallback),this.binder.unbindAll(),this.loader.destroy(),this.slides=[],this.dots=[],this.dotsWrapper=null,this.pauseReasons.clear())}get currentSlideIndex(){return this.currentIndex}get slideCount(){return this.slides.length}}});var k,le=c(()=>{"use strict";k=(n,e,t)=>Math.max(e,Math.min(n,t))});var ce,W,de,he,A,ue=c(()=>{"use strict";le();ce=.85,W=.1,de=2.5,he=.02,A=class{element;size;x;y;vx;vy;options;constructor(e,t,i={}){this.element=e,this.options={useSubpixel:!0,debug:!1,...i},this.size={width:e.offsetWidth,height:e.offsetHeight},this.x=Math.random()*(t.width-this.size.width),this.y=Math.random()*(t.height-this.size.height),this.vx=(Math.random()-.5)*3,this.vy=(Math.random()-.5)*3,e.style.willChange="transform",e.style.backfaceVisibility="hidden",e.style.perspective="1000px",e.style.opacity="1",this.updatePosition()}updatePosition(){if(!this.element)return!1;let e=this.options.useSubpixel?this.x:Math.round(this.x),t=this.options.useSubpixel?this.y:Math.round(this.y);return this.element.style.transform=`translate3d(${e}px, ${t}px, 0)`,!0}update(e,t,i=!0){if(!this.element)return!1;this.x+=this.vx*e,this.y+=this.vy*e,(this.x<=0||this.x+this.size.width>=t.width)&&(this.vx=-this.vx*ce,this.vx=Math.abs(this.vx)<W?Math.sign(this.vx)*W:this.vx,this.x=k(this.x,0,t.width-this.size.width)),(this.y<=0||this.y+this.size.height>=t.height)&&(this.vy=-this.vy*ce,this.vy=Math.abs(this.vy)<W?Math.sign(this.vy)*W:this.vy,this.y=k(this.y,0,t.height-this.size.height)),this.vx+=(Math.random()-.5)*he,this.vy+=(Math.random()-.5)*he;let r=this.vx**2+this.vy**2;if(r>de**2){let s=de/Math.sqrt(r);this.vx*=s,this.vy*=s}return i?this.updatePosition():!0}resetPosition(e){this.x=Math.random()*(e.width-this.size.width),this.y=Math.random()*(e.height-this.size.height),this.updatePosition()}updateSize(){this.element&&(this.size.width=this.element.offsetWidth,this.size.height=this.element.offsetHeight)}clampPosition(e){this.x=k(this.x,0,e.width-this.size.width),this.y=k(this.y,0,e.height-this.size.height)}destroy(){this.element&&(this.element.style.willChange="auto",this.element.style.backfaceVisibility="",this.element.style.perspective="",this.element=null)}}});var z,pe=c(()=>{"use strict";z=class{fps=60;lastTime=performance.now();frameSkipThreshold=30;shouldSkipFrame=!1;frameCount=0;cachedPerformanceLevel="high";lastLevelUpdate=0;levelUpdateInterval=1e3;cachedSettings=null;lastLoggedFPS=60;fpsLogThreshold=5;update(){let e=performance.now(),t=e-this.lastTime;if(t<1)return this.shouldSkipFrame;let i=1e3/t;return this.fps=this.fps*.9+i*.1,this.frameCount++,this.shouldSkipFrame=this.fps<this.frameSkipThreshold,Math.abs(this.fps-this.lastLoggedFPS)>=this.fpsLogThreshold&&(this.lastLoggedFPS=this.fps),this.lastTime=e,this.shouldSkipFrame}getFrameCount(){return this.frameCount}getCurrentFPS(){return Math.round(this.fps*10)/10}getPerformanceLevel(){let e=performance.now();return e-this.lastLevelUpdate>this.levelUpdateInterval&&(this.cachedPerformanceLevel=this.fps>=50?"high":this.fps>=30?"medium":"low",this.lastLevelUpdate=e,this.cachedSettings=null),this.cachedPerformanceLevel}getRecommendedSettings(){if(this.cachedSettings)return this.cachedSettings;let e=this.getPerformanceLevel(),t={high:{maxImages:50,speedMultiplier:1,useSubpixel:!0},medium:{maxImages:25,speedMultiplier:.8,useSubpixel:!1},low:{maxImages:10,speedMultiplier:.5,useSubpixel:!1}};return this.cachedSettings=t[e],this.cachedSettings}reset(){this.fps=60,this.lastTime=performance.now(),this.shouldSkipFrame=!1,this.frameCount=0,this.cachedPerformanceLevel="high",this.lastLevelUpdate=0,this.cachedSettings=null,this.lastLoggedFPS=60}}});var J,H,me=c(()=>{"use strict";B();J=class{windowCallbacks=new Map;elementObservers=new Map;onWindow(e,t){let i;t?.debounceMs!=null?i=T(e,t.debounceMs):t?.throttleMs!=null?i=S(e,t.throttleMs):(i=e,i.cancel=()=>{});let r=()=>i();return this.windowCallbacks.set(e,r),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),i.cancel?.(),this.windowCallbacks.delete(e)}}onElement(e,t,i){let r=this.elementObservers.get(e);if(!r){let d=new Set,h=new ResizeObserver(()=>{d.forEach(u=>u())});r={observer:h,callbacks:d},this.elementObservers.set(e,r),h.observe(e)}let s;i?.debounceMs!=null?s=T(t,i.debounceMs):i?.throttleMs!=null?s=S(t,i.throttleMs):(s=t,s.cancel=()=>{}),r.callbacks.add(s);let a=r.callbacks,l=r.observer;return()=>{a.delete(s),s.cancel?.(),a.size===0&&(l.disconnect(),this.elementObservers.delete(e))}}getElement(e){let t=e.getBoundingClientRect();return{width:t.width,height:t.height}}destroy(){for(let[e,t]of this.windowCallbacks.entries())window.removeEventListener("resize",t);this.windowCallbacks.clear();for(let e of this.elementObservers.values())e.observer.disconnect();this.elementObservers.clear()}},H=new J});var O,ge=c(()=>{"use strict";ue();pe();me();X();K();O=class{container;performanceMonitor;images=[];speedMultiplier=1;isInViewport=!0;_destroyed=!1;animateCallback;maxImages;intersectionObserver;unsubscribeWindow;unsubscribeElement;imageLoader;containerWidth;containerHeight;debug;constructor(e,t={}){this.container=e,this.debug=t.debug??!1,this.performanceMonitor=new z;let i=this.performanceMonitor.getRecommendedSettings();this.maxImages=t.maxImages??i.maxImages,this.intersectionObserver=new IntersectionObserver(r=>{this.isInViewport=r[0].isIntersecting},{threshold:0}),this.intersectionObserver.observe(this.container),this.setupResizeHandling(),this.imageLoader=new L(this.container),this.updateContainerDimensions(),this.animateCallback=()=>this.animate(),p.has(this.animateCallback)||p.add(this.animateCallback),this.initializeImages()}setupResizeHandling(){this.unsubscribeWindow=H.onWindow(()=>this.handleResize()),this.unsubscribeElement=H.onElement(this.container,()=>this.handleResize())}updateContainerDimensions(){let e=H.getElement(this.container);this.containerWidth=e.width,this.containerHeight=e.height}async initializeImages(){try{let e=await this.imageLoader.waitForImagesToLoad(".floating-image"),t={width:this.containerWidth,height:this.containerHeight};e.slice(0,this.maxImages).forEach(i=>this.addExistingImage(i,t))}catch{}}addExistingImage(e,t){if(this.images.length>=this.maxImages)return;let i=new A(e,t,{debug:this.debug});this.images.push(i)}handleResize(){if(this._destroyed)return;this.updateContainerDimensions();let e={width:this.containerWidth,height:this.containerHeight};this.images.forEach(t=>{t.updateSize(),t.clampPosition(e),t.updatePosition()})}animate(){if(this._destroyed||this.performanceMonitor.update()||!this.isInViewport||this.speedMultiplier===0)return;let t=this.speedMultiplier,i={width:this.containerWidth,height:this.containerHeight};this.images=this.images.filter(r=>r.update(t,i))}resetAllImagePositions(){let e={width:this.containerWidth,height:this.containerHeight};this.images.forEach(t=>t.resetPosition(e))}reinitializeImages(){if(this._destroyed)return;this.images.forEach(i=>i.destroy()),this.images.length=0;let e={width:this.containerWidth,height:this.containerHeight};Array.from(this.container.querySelectorAll(".floating-image")).slice(0,this.maxImages).forEach(i=>{let r=new A(i,e,{debug:this.debug});this.images.push(r)})}destroy(){this._destroyed||(this._destroyed=!0,p.has(this.animateCallback)&&p.remove(this.animateCallback),this.unsubscribeWindow?.(),this.unsubscribeElement?.(),this.intersectionObserver.disconnect(),this.images.forEach(e=>e.destroy()),this.images.length=0,this.imageLoader.destroy())}}});var fe={};F(fe,{ScreensaverController:()=>Q,VERSION:()=>Ie});var Ie,Q,ve=c(()=>{"use strict";w();x();$();V();ge();Ie="nextworld-1.0.0",Q=class{partialUrl;targetSelector;inactivityDelay;screensaverManager=null;watcher=null;_destroyed=!1;eventBinder;_partialLoaded=!1;partialFetcher;_onInactivity;_onActivity;constructor(e){this.partialUrl=e.partialUrl,this.targetSelector=e.targetSelector,this.inactivityDelay=e.inactivityDelay??12e3,this.watcher=e.watcher??null,this.partialFetcher=e.partialFetcher??C,this.eventBinder=new b(!0),this._onInactivity=this.showScreensaver.bind(this),this._onActivity=this.hideScreensaver.bind(this),o.emit("screensaver:log",{level:"info",message:"ScreensaverController initialized",details:{partialUrl:this.partialUrl,targetSelector:this.targetSelector,inactivityDelay:this.inactivityDelay}})}async init(){if(!this._destroyed)try{this.watcher||(this.watcher=E.getInstance({inactivityDelay:this.inactivityDelay})),this.eventBinder.bindBus("user:inactive",this._onInactivity),this.eventBinder.bindBus("user:active",this._onActivity),o.emit("screensaver:log",{level:"info",message:"Bound user inactivity/active events"})}catch(e){o.emit("screensaver:error",{message:"Failed to initialize inactivity watcher",error:e})}}async showScreensaver(){if(!this._destroyed)try{this._partialLoaded||(await this.partialFetcher.load(this.partialUrl,this.targetSelector),this._partialLoaded=!0);let e=document.querySelector(this.targetSelector);if(!e){o.emit("screensaver:error",{message:`Target selector "${this.targetSelector}" not found`});return}e.style.opacity="0",e.style.display="",e.offsetWidth,e.style.transition="opacity 0.5s ease",e.style.opacity="1",this.screensaverManager?(this.screensaverManager.destroy(),this.screensaverManager=new O(e,{debug:!0})):this.screensaverManager=new O(e,{debug:!0}),o.emit("screensaver:log",{level:"info",message:"Screensaver displayed"})}catch(e){o.emit("screensaver:error",{message:"Failed to load or show screensaver",error:e})}}hideScreensaver(){if(!this._destroyed)try{let e=document.querySelector(this.targetSelector);e&&(e.style.transition="opacity 0.5s ease",e.style.opacity="0",setTimeout(()=>{e.style.display="none"},500))}catch(e){o.emit("screensaver:error",{message:"Failed to hide screensaver",error:e})}}destroy(){this._destroyed||(this._destroyed=!0,this.hideScreensaver(),this.screensaverManager?.destroy(),this.eventBinder.unbindAll(),this._partialLoaded=!1,o.emit("screensaver:log",{level:"info",message:"ScreensaverController destroyed"}))}}});var M=class{static#e=null;static ready(){return this.#e||(this.#e=document.readyState!=="loading"?Promise.resolve():new Promise(e=>{document.addEventListener("DOMContentLoaded",()=>e(),{once:!0})})),this.#e}static waitForElement(e,t={}){let{timeout:i=5e3,root:r=document,signal:s}=t,a=Array.isArray(e)?e:[e],l=a.length>1;return new Promise((d,h)=>{let u,m=new Map,g=()=>{ie.disconnect(),u!==void 0&&clearTimeout(u),s&&s.removeEventListener("abort",_)},f=()=>{let v=a.map(y=>m.get(y));g(),d(l?v:v[0])},I=()=>{for(let v of a)if(!m.has(v)){let y=r.querySelector(v);y&&m.set(v,y)}return m.size===a.length?(f(),!0):!1},_=()=>{g(),h(new DOMException("waitForElement aborted","AbortError"))};if(s){if(s.aborted)return _();s.addEventListener("abort",_,{once:!0})}if(I())return;let ie=new MutationObserver(v=>{for(let y of v)if(y.addedNodes.length>0&&I())return});ie.observe(r,{childList:!0,subtree:!0}),isFinite(i)&&i>0&&(u=window.setTimeout(()=>{g();let v=a.filter(y=>!m.has(y));h(new DOMException(`Element(s) "${v.join(", ")}" not found in ${i}ms`,"TimeoutError"))},i))})}};$();w();x();N();V();q();function j(n="id",e=9){return`${n}-${Math.random().toString(36).slice(2,2+e)}`}Y();var ee=class{config;constructor(e={}){this.config={hostname:window.location.hostname,production:window.location.hostname!=="localhost"&&!window.location.hostname.includes("127.0.0.1"),features:e.features??{},...e}}get(e){return e.split(".").reduce((t,i)=>{if(t?.[i]===void 0){console.log(`[spaceface] Config key "${e}" is undefined`);return}return t[i]},this.config)}},te=class n{static EVENT_LOG="log";static EVENT_TELEMETRY="telemetry";appConfig;config;features;debug;pageType;startTime;featureModules;featureCache;inactivityWatcher;screensaverController;slideshows=[];swManager;_partialUnsub;_partialObserver;constructor(e={}){this.appConfig=new ee(e),this.config=this.appConfig.config,this.features=this.config.features??{},this.debug=!!this.config.debug,this.pageType=this.resolvePageType(),this.startTime=performance.now(),this.featureModules=this.defineFeatureModules(),this.featureCache=new Map,this.inactivityWatcher=null,this.screensaverController=null,this.validateConfig(),Object.keys(this.featureModules).forEach(t=>this.loadFeatureModule(t))}validateConfig(){if(!this.config||typeof this.config!="object")throw new Error("Invalid or missing configuration object");this.config.features||this.log("warn","No features specified in config")}log(e,...t){if(!(!this.debug&&e==="debug")&&(o.emit(n.EVENT_LOG,{level:e,args:t}),this.debug)){let r={debug:"debug",info:"info",warn:"warn",error:"error"}[e]??"log";console[r](`[spaceface] [${e.toUpperCase()}]`,...t)}}defineFeatureModules(){return{partialLoader:()=>Promise.resolve().then(()=>(q(),se)),slideplayer:()=>Promise.resolve().then(()=>(oe(),ae)),screensaver:()=>Promise.resolve().then(()=>(ve(),fe)),serviceWorker:()=>Promise.resolve().then(()=>(Y(),ne))}}resolvePageType(){let e=window.location.pathname,t=document.body;return t.dataset.page?t.dataset.page:e==="/"?"home":e==="/app"?"app":"default"}async loadFeatureModule(e){if(!this.featureModules[e]||this.featureCache.has(e))return this.featureCache.get(e)??null;try{let t=await this.featureModules[e]();this.featureCache.set(e,t)}catch(t){this.log("error",`Failed to load module "${e}"`,t),this.featureCache.set(e,null)}return this.featureCache.get(e)}async initInactivityWatcher(){try{let{screensaver:e}=this.features;if(!e||this.inactivityWatcher)return;this.inactivityWatcher=E.getInstance({inactivityDelay:e.delay??3e3})}catch(e){this.log("error","Failed to initialize InactivityWatcher",e)}}async initSlidePlayer(){try{let{slideplayer:e}=this.features;if(!e)return;let i=(await this.loadFeatureModule("slideplayer"))?.SlidePlayer;if(!i)return;this.slideshows=[];for(let r of document.querySelectorAll(".slideshow-container")){let s=new i(r,{interval:e.interval??5e3,includePicture:e.includePicture??!1});s.ready?.then&&await s.ready,this.slideshows.push(s)}this.log("info",`${this.slideshows.length} SlidePlayer instance(s) loaded`)}catch(e){this.log("error","Failed to initialize SlidePlayer",e)}}async initScreensaver(){try{let{screensaver:e}=this.features;if(!e?.partialUrl){this.log("error","Screensaver configuration is missing or incomplete");return}let i=(await this.loadFeatureModule("screensaver"))?.ScreensaverController;if(!i)return;let r=j("screensaver",9),s=Object.assign(document.createElement("div"),{id:r,style:"position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 999; display: none;"});document.body.appendChild(s),this.screensaverController=new i({partialUrl:e.partialUrl,targetSelector:`#${r}`,...e.delay!==void 0&&{inactivityDelay:e.delay}}),this.screensaverController?.init&&await this.screensaverController.init(),o.emit("screensaver:initialized",r),this.log("info","Screensaver initialized:",r)}catch(e){this.log("error","Failed to initialize screensaver",e)}}async initServiceWorker(){try{if(!this.features.serviceWorker)return;let t=(await this.loadFeatureModule("serviceWorker"))?.default;if(!t)return;let i=new t("/sw.js",{},{strategy:{images:"cache-first",others:"network-first"}});await i.register(),i.configure(),this.swManager=i,this.log("info","Service Worker registered and configured")}catch(e){this.log("error","Service Worker registration failed",e)}}async initPartialLoader(){try{let e=this.features.partialLoader;if(!e?.enabled)return null;let i=(await this.loadFeatureModule("partialLoader"))?.PartialLoader;if(!i)return null;let r=new i({debug:e.debug??this.debug,baseUrl:e.baseUrl??"/",cacheEnabled:e.cacheEnabled??!0});return await r.loadContainer(document),this._partialObserver=r.watch(document),this.log("info","PartialLoader initialized"),r}catch(e){return this.log("error","PartialLoader initialization failed",e),null}}async initPageFeatures(){try{this.log("info",`Initializing features for page type: ${this.pageType}`),this.log("info",`Page features initialized for: ${this.pageType}`)}catch(e){this.log("error",`Page feature initialization failed for ${this.pageType}`,e)}}async init(){try{this.log("info",`App initialization started (Page: ${this.pageType})`),document.documentElement.classList.add("js-enabled",`page-${this.pageType}`),await M.ready(),this.log("info","DOM ready");let e=[this.initInactivityWatcher(),this.initPartialLoader(),this.initSlidePlayer(),this.initScreensaver(),this.initServiceWorker()];await Promise.allSettled(e),await this.initPageFeatures();let t=(performance.now()-this.startTime).toFixed(2);this.log("info",`App initialized in ${t}ms`),o.emit(n.EVENT_TELEMETRY,{type:"init:duration",value:t,page:this.pageType})}catch(e){this.log("error","Critical app initialization error",e)}}destroy(){this._partialUnsub&&(this._partialUnsub(),this._partialUnsub=void 0)}},Le=["localhost","127.0.0.1"].some(n=>window.location.hostname.includes(n));Le&&o.onAny((n,e)=>{if(!e)return console.log(`[spaceface onAny] Event: ${n} \u2013 no payload!`);if(typeof e=="string")return console.log(`[spaceface onAny] Event: ${n} [LOG]`,e);let{level:t="log",message:i,args:r,...s}=e,a=i??r??s??"(no details)",d={debug:"debug",info:"info",warn:"warn",error:"error",log:"log"}[t]??"log";console[d](`[ spaceface onAny ] Event: ${n} [${t.toUpperCase()}] \u2013`,a)});var Me=new te({features:{partialLoader:{enabled:!0,debug:!0,baseUrl:"/",cacheEnabled:!0},slideplayer:{interval:5e3,includePicture:!1,showDots:!1},screensaver:{delay:4500,partialUrl:"content/feature/screensaver/index.html"},serviceWorker:!0}});Me.init();export{ee as AppConfig,te as Spaceface};
//# sourceMappingURL=bundle.min.js.map
