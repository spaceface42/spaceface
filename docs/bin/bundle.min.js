var we=Object.defineProperty;var g=(a,e)=>()=>(a&&(e=a(a=0)),e);var B=(a,e)=>{for(var t in e)we(a,t,{get:e[t],enumerable:!0})};var j,o,m=g(()=>{"use strict";j=class{listeners=new Map;anyListeners=[];onceWrappers=new WeakMap;emittingError=!1;debugMode=!1;setDebugMode(e){this.debugMode=e,this.debugMode&&console.debug("[EventBus] Debug mode enabled")}on(e,t,i=0){let r=this.listeners.get(e)??[],n={fn:t,priority:i},s=r.length;for(;s>0&&r[s-1].priority<i;)s--;return r.splice(s,0,n),this.listeners.set(e,r),this.debugMode&&console.debug(`[EventBus] Listener added for event: ${e}`,{priority:i}),()=>this.off(e,t)}once(e,t,i=0){let r=n=>{this.off(e,r),t(n)};return this.onceWrappers.set(t,r),this.on(e,r,i),()=>this.off(e,t)}off(e,t){let i=this.listeners.get(e);if(!i)return;let r=this.onceWrappers.get(t)??t;this.listeners.set(e,i.filter(n=>n.fn!==r)),this.debugMode&&console.debug(`[EventBus] Listener removed for event: ${e}`)}hasListeners(e){return e==="any"?this.anyListeners.length>0:(this.listeners.get(e)?.length??0)>0}onAny(e,t=0){let i={fn:e,priority:t},r=this.anyListeners.length;for(;r>0&&this.anyListeners[r-1].priority<t;)r--;return this.anyListeners.splice(r,0,i),this.debugMode&&console.debug("[EventBus] Listener added for any event",{priority:t}),()=>this.offAny(e)}offAny(e){this.anyListeners=this.anyListeners.filter(t=>t.fn!==e),this.debugMode&&console.debug("[EventBus] Listener removed for any event")}emit(e,t){if(!e){this._handleError("Event name is undefined or empty",new Error);return}this.debugMode&&console.debug(`[EventBus] Emitting event: ${e}`,t);let i=[...this.listeners.get(e)??[]];for(let n of i)try{n.fn(t)}catch(s){this._handleError(`Error in listener for "${e}"`,s)}let r=[...this.anyListeners];for(let n of r)try{n.fn(e,t)}catch(s){this._handleError(`Error in any-listener for "${e}"`,s)}}async emitAsync(e,t){if(!e)return this._handleError("Event name is undefined or empty",new Error),[];let i=[],r=[...this.listeners.get(e)??[]];for(let s of r)try{i.push(await s.fn(t))}catch(l){this._handleError(`Async error in listener for "${e}"`,l)}let n=[...this.anyListeners];for(let s of n)try{i.push(await s.fn(e,t))}catch(l){this._handleError(`Async error in any-listener for "${e}"`,l)}return i}removeAllListeners(e){e?e==="any"?this.anyListeners=[]:this.listeners.delete(e):(this.listeners.clear(),this.anyListeners=[]),this.debugMode&&console.debug(`[EventBus] All listeners removed for event: ${e??"all"}`)}listenerCount(e){return e==="any"?this.anyListeners.length:this.listeners.get(e)?.length??0}eventNames(){return Array.from(this.listeners.keys()).filter(e=>(this.listeners.get(e)?.length??0)>0)}getListeners(e){return e==="any"?this.anyListeners.map(t=>t.fn):(this.listeners.get(e)??[]).map(t=>t.fn)}_handleError(e,t){this.emittingError||(this.emittingError=!0,console.error(`[EventBus] ${e}`,t),this.emittingError=!1)}},o=new j});var D,K=g(()=>{"use strict";m();D=class{target;debug;destroyed=!1;domListeners=new Set;loggedMessages=new Set;constructor(e,t=!1){if(!e||typeof e.addEventListener!="function"||typeof e.removeEventListener!="function")throw new Error(`${this.constructor.name}: target must be a valid EventTarget.`);this.target=e,this.debug=t}log(e,t,i){if(typeof e=="string"&&["debug","info","warn","error"].includes(e)&&typeof t=="string"){let d=e,h=t,u=i;if(!this.debug&&d==="debug")return;try{let f={scope:this.constructor.name,level:d,message:h,data:u,time:Date.now()};o.emit("log",f)}catch{}if(this.debug){let f={debug:"debug",info:"info",warn:"warn",error:"error"}[d]??"log";console[f](`[${this.constructor.name}] [${d.toUpperCase()}]`,h,u)}return}let n=e,s=t;if(!this.debug)return;let l;try{l=`${n}-${JSON.stringify(s)}`}catch{l=`${n}-[unserializable]`}if(!this.loggedMessages.has(l)){this.loggedMessages.add(l);try{let d=s&&typeof s=="object"?JSON.parse(JSON.stringify(s)):s,h={scope:this.constructor.name,level:"debug",message:n,data:d,time:Date.now()};o.emit("log:debug",h)}catch(d){console.warn("Failed to log debug event",{message:n,payload:s,error:d})}}console.debug?.(`[${this.constructor.name}] [DEBUG]`,n,s)}checkDestroyed(){if(this.destroyed)throw new Error(`${this.constructor.name} has been destroyed.`)}destroy(){if(!this.destroyed){this.log("info","Destroying watcher");try{this.removeAllDomListeners(),this.removeEventListeners()}catch(e){this.log("error","Error while destroying watcher",e)}finally{this.destroyed=!0}}}addDomListener(e,t,i){this.destroyed||(this.target.addEventListener(e,t,i),this.domListeners.add({type:e,handler:t,options:i}),this.debug&&this.log("debug","Added DOM listener",{type:e,handler:t,options:i}))}removeAllDomListeners(){for(let{type:e,handler:t,options:i}of this.domListeners)try{this.target.removeEventListener(e,t,i),this.debug&&this.log("debug","Removed DOM listener",{type:e,handler:t})}catch(r){this.log("warn","Failed to remove DOM listener",{type:e,handler:t,error:r})}this.domListeners.clear()}}});function ae(){let a=null;return{get id(){return a},set(e,t){a!==null&&clearTimeout(a),a=window.setTimeout(()=>{a=null,e()},t)},cancel(){a!==null&&(clearTimeout(a),a=null)}}}function b(a,e=300,t=!1){if(typeof a!="function")throw new TypeError("Expected a function for debounce");if(typeof e!="number"||e<0)throw new TypeError("Expected a non-negative number for delay");let i=ae();function r(...n){let s=t&&i.id===null;i.set(()=>{t||a.apply(this,n)},e),s&&a.apply(this,n)}return r.cancel=()=>i.cancel(),r}function z(a,e=100,t={}){if(typeof a!="function")throw new TypeError("Expected a function for throttle");if(typeof e!="number"||e<0)throw new TypeError("Expected a non-negative number for delay");let{leading:i=!0,trailing:r=!0}=t,n=0,s=null,l=null,d=ae();function h(){n=i?Date.now():0,a.apply(l,s),s=l=null}function u(...f){let M=Date.now();n===0&&!i&&(n=M),s=f,l=this;let y=e-(M-n);y<=0||y>e?(d.cancel(),h()):d.id===null&&r&&d.set(()=>{r&&s&&h()},y)}return u.cancel=()=>{d.cancel(),n=0,s=l=null},u}var C=g(()=>{"use strict"});var c,I=g(()=>{"use strict";c={LOG:"log",LOG_DEBUG:"log:debug",LOG_ERROR:"log:error",TELEMETRY:"telemetry",USER_ACTIVE:"user:active",USER_INACTIVE:"user:inactive",SCREENSAVER_INITIALIZED:"screensaver:initialized",SCREENSAVER_SHOWN:"screensaver:shown",SCREENSAVER_HIDDEN:"screensaver:hidden",SCREENSAVER_ERROR:"screensaver:error",SCREENSAVER_LOG:"screensaver:log",SLIDEPLAYER_LOG:"slideplayer:log",FLOATING_IMAGES_LOG:"floatingImages:log",PARTIAL_LOADED:"partial:loaded",PARTIAL_ERROR:"partial:error",PARTIAL_LOAD_COMPLETE:"partial:load:complete",PARTIALS_ALL_LOADED:"partials:allLoaded"}});var E,Y=g(()=>{"use strict";K();m();C();I();E=class a extends D{static _instance=null;inactivityDelay;lastActiveAt;timer;userIsInactive=!1;throttledReset;constructor(e,t){super(e,t.debug??!1),this.inactivityDelay=t.inactivityDelay,this.lastActiveAt=Date.now(),this.throttledReset=z(()=>this.resetTimer(),200),this.log(`Initialized with inactivityDelay=${this.inactivityDelay}ms`),this.addEventListeners()}static getInstance(e){return this._instance||(this._instance=new a(e.target??document,e)),this._instance}addEventListeners(){this.addDomListener("mousemove",this.throttledReset),this.addDomListener("keydown",this.throttledReset),this.addDomListener("scroll",this.throttledReset),this.addDomListener("visibilitychange",this.throttledReset),this.resetTimer()}removeEventListeners(){this.removeAllDomListeners(),this.timer&&(clearTimeout(this.timer),this.timer=void 0)}resetTimer(){let e=Date.now();this.lastActiveAt=e,this.userIsInactive&&(this.userIsInactive=!1,o.emit(c.USER_ACTIVE,{lastActiveAt:this.lastActiveAt,inactivityDelay:this.inactivityDelay,visible:document.visibilityState==="visible"}),this.log("User is active")),this.timer&&clearTimeout(this.timer),this.timer=window.setTimeout(()=>this.setInactive(),this.inactivityDelay)}setInactive(){this.userIsInactive=!0;let e=Date.now();o.emit(c.USER_INACTIVE,{lastActiveAt:this.lastActiveAt,inactiveAt:e,inactivityDelay:this.inactivityDelay,visible:document.visibilityState==="visible"}),this.log("User is inactive")}}});var _,oe=g(()=>{"use strict";m();_=class{scope;devMode;fallbackLogs=[];constructor(e,t=!0){this.scope=e,this.devMode=t}shouldLog(e){let t=["debug","info","event","warn","error"],i=t.indexOf(this.devMode?"debug":"warn");return t.indexOf(e)>=i}log(e,t,i){if(!this.shouldLog(e))return;let r={level:e,scope:this.scope,message:t,data:i,time:Date.now()};try{o.emit("log",r)}catch(n){this.fallbackLogs.push(r),this.devMode&&console.error("[EventLogger][ERROR] Failed to emit log event",{entry:r,error:n})}this.devMode&&(console.debug("[EventLogger][DEBUG] Logging to console",{level:e,message:t,data:i}),this.consoleOutput(e,t,i))}consoleOutput(e,t,i){let r;switch(e){case"warn":r="warn";break;case"error":r="error";break;default:r="log"}let n=`[${this.scope}][${e.toUpperCase()}]`;i!==void 0?console[r](n,t,i):console[r](n,t)}getFallbackLogs(){return this.fallbackLogs}debug(e,t){this.log("debug",e,t)}info(e,t){this.log("info",e,t)}warn(e,t){this.log("warn",e,t)}event(e,t){this.log("event",e,t)}error(e,t){this.log("error",e,t)}}});var v,$e,H=g(()=>{"use strict";m();oe();v=class a{IBusBindings=[];domBindings=[];debugMode;logger;constructor(e=!1){this.debugMode=e,this.logger=new _("eventbinder")}debug(e,t){if(this.debugMode)try{let i={method:e,details:t};this.logger.debug(e,i)}catch(i){console.error(`Debugging failed in method: ${e}`,i)}}attachTo(e){if(e.aborted)return this.unbindAll(),()=>{};let t=()=>this.unbindAll();return e.addEventListener("abort",t,{once:!0}),()=>{try{e.removeEventListener("abort",t)}catch(i){console.warn("Failed to remove abort listener",i)}}}setDebugMode(e){this.debugMode=e,this.logger.info(`Debug mode ${e?"enabled":"disabled"}`)}bindBus(e,t){if(this.IBusBindings.find(i=>i.event===e&&i.handler===t)){this.debug("bus:bind:duplicate",{event:e,handler:t});return}try{let i=o.on(e,t);this.IBusBindings.push({event:e,handler:t,unsubscribe:i}),this.debug("bus:bind",{event:e,handler:t})}catch(i){this.logger.error(`Failed to bind bus event "${e}": ${i instanceof Error?i.message:String(i)}`)}}bindDOM(e,t,i,r=!1){if(!e||typeof e.addEventListener!="function"||typeof e.removeEventListener!="function"){this.logger.warn(`Invalid DOM target for bindDOM: ${String(e)}`);return}let n=new AbortController,s=typeof r=="boolean"?{capture:r,signal:n.signal}:{...r,signal:n.signal},l=(d,h)=>!!d==!!h&&(d?.capture??!1)===(h?.capture??!1)&&(d?.passive??!1)===(h?.passive??!1)&&(d?.once??!1)===(h?.once??!1);if(this.domBindings.find(d=>d.target===e&&d.event===t&&d.handler===i&&l(d.options,s))){this.debug("dom:bind:duplicate",{event:t,handler:i,target:e,options:s});return}try{e.addEventListener(t,i,s),this.domBindings.push({target:e,event:t,handler:i,options:s,controller:n}),this.debug("dom:bind",{event:t,handler:i,target:e,options:s})}catch(d){this.logger.error(`Failed to bind DOM event "${t}": ${d instanceof Error?d.message:String(d)}`)}}unbindAll(){this.debug("unbindAll",{bus:this.IBusBindings.length,dom:this.domBindings.length});for(let e of this.IBusBindings)try{e.unsubscribe(),this.debug("bus:unbind",{event:e.event})}catch(t){this.logger.error(`Failed to unbind bus "${e.event}": ${t instanceof Error?t.message:String(t)}`)}for(let e of this.domBindings)try{e.controller.abort(),this.debug("dom:unbind",{event:e.event,target:e.target})}catch(t){this.logger.error(`Failed to unbind DOM "${e.event}": ${t instanceof Error?t.message:String(t)}`)}this.IBusBindings=[],this.domBindings=[]}unbindBus(e,t){let i=this.IBusBindings.findIndex(r=>r.event===e&&r.handler===t);if(i===-1)return!1;try{return this.IBusBindings[i].unsubscribe(),this.IBusBindings.splice(i,1),this.debug("bus:unbind:single",{event:e,handler:t}),!0}catch(r){return this.logger.error(`Failed to unbind bus "${e}": ${r instanceof Error?r.message:String(r)}`),!1}}unbindDOM(e,t,i){let r=this.domBindings.findIndex(n=>n.target===e&&n.event===t&&n.handler===i);if(r===-1)return!1;try{return this.domBindings[r].controller.abort(),this.domBindings.splice(r,1),this.debug("dom:unbind:single",{event:t,target:e}),!0}catch(n){return this.logger.error(`Failed to unbind DOM "${t}": ${n instanceof Error?n.message:String(n)}`),!1}}getStats(){return{busEvents:this.IBusBindings.length,domEvents:this.domBindings.length,totalEvents:this.IBusBindings.length+this.domBindings.length}}hasBindings(){return this.IBusBindings.length>0||this.domBindings.length>0}getBindingDetails(){return{bus:this.IBusBindings.map(e=>e.event),dom:this.domBindings.map(e=>`${e.event}@${e.target.constructor.name}`)}}static withAutoUnbind(e,t=!1){let i=new a(t);try{let r=e(i);return r instanceof Promise?r.finally(()=>i.unbindAll()):(i.unbindAll(),r)}catch(r){throw i.unbindAll(),r}}},$e=new v});var le={};B(le,{PartialLoader:()=>L,VERSION:()=>Ie});var Ie,L,N=g(()=>{"use strict";C();m();Ie="2.0.0",L=class{cache=new Map;loadingPromises=new Map;loadedPartials=new Map;options;constructor(e={}){this.options={debug:!1,baseUrl:"/",cacheEnabled:!0,timeout:1e4,retryAttempts:3,...e}}logDebug(e,t){if(this.options.debug){let i=`${e}-${JSON.stringify(t)}`;if(!this.loadedPartials.has(i)){this.loadedPartials.set(i,!0);let r={scope:"PartialLoader",level:"debug",message:e,data:t,time:Date.now()};o.emit("log:debug",r),o.emit("log",r)}}}async load(e){let t=Array.isArray(e)?e:[e],i=[];for(let r of t)try{r instanceof HTMLLinkElement?i.push(await this.loadLink(r)):i.push(await this.loadInfo(r))}catch(n){let s=r instanceof HTMLLinkElement?r.getAttribute("src")||"":r.url;this.logDebug("Failed to load partial",{url:s,error:n}),i.push({success:!1,url:s,cached:!1})}return o.emit("partials:allLoaded",{url:"",cached:!1}),this.logDebug("All partials loaded",{count:i.length}),i}loadLink(e){let t=e.getAttribute("src");if(!t)throw new Error("Partial link missing src");return this.loadUrl(this.resolveUrl(t),e)}loadInfo(e){return this.loadUrl(this.resolveUrl(e.url),e.container,e.id)}async loadUrl(e,t,i){try{if(this.options.cacheEnabled&&this.cache.has(e))return this.insertHTML(t,this.cache.get(e)),this.loadedPartials.set(i||e,!0),o.emit("partial:loaded",{url:e,html:this.cache.get(e),cached:!0}),this.logDebug("Partial loaded from cache",{url:e,id:i}),{success:!0,url:e,cached:!0};let r=this.loadingPromises.get(e);r||(r=this.fetchWithRetry(e),this.loadingPromises.set(e,r));let n=await r;return this.options.cacheEnabled&&this.cache.set(e,n),this.insertHTML(t,n),this.loadedPartials.set(i||e,!0),o.emit("partial:loaded",{url:e,html:n,cached:!1}),this.logDebug("Partial loaded",{url:e,id:i}),{success:!0,url:e,cached:!1}}catch(r){throw this.showError(t,r),o.emit("partial:error",{url:e,error:r}),this.logDebug("Partial load failed",{url:e,id:i,error:r}),r}finally{this.loadingPromises.delete(e),o.emit("partial:load:complete",{url:e}),this.logDebug("Partial load complete",{url:e,id:i})}}async fetchWithRetry(e,t=1){let i=new AbortController,r=setTimeout(()=>i.abort(),this.options.timeout);try{let n=await fetch(e,{signal:i.signal,headers:{Accept:"text/html"}});if(!n.ok)throw new Error(`HTTP ${n.status}`);let s=(await n.text()).trim();if(!s)throw new Error("Empty response");return s}catch(n){if(t<this.options.retryAttempts)return this.logDebug("Retrying fetch",{url:e,attempt:t}),await this.delay(Math.min(2**t*100,5e3)),this.fetchWithRetry(e,t+1);throw n}finally{clearTimeout(r)}}async fetchPartial(e,t=1){let i=new AbortController,r=setTimeout(()=>i.abort(),this.options.timeout);try{let n=await fetch(e,{signal:i.signal,headers:{Accept:"text/html"}});if(!n.ok)throw new Error(`HTTP ${n.status}`);let s=(await n.text()).trim();if(!s)throw new Error("Empty response");return s}catch(n){if(t<this.options.retryAttempts)return this.logDebug("Retrying fetch",{url:e,attempt:t}),await this.delay(Math.min(2**t*100,5e3)),this.fetchPartial(e,t+1);throw n}finally{clearTimeout(r)}}insertHTML(e,t){let i=document.createElement("template");i.innerHTML=t,e instanceof HTMLLinkElement?e.replaceWith(...i.content.childNodes):e instanceof Element?(e.innerHTML="",e.append(...i.content.childNodes)):e.append(...i.content.childNodes),this.logDebug("Inserted HTML into container",{container:e})}showError(e,t){let i=document.createElement("div");i.className="partial-error",i.textContent="Partial load failed",this.options.debug&&(i.textContent+=`: ${t.message}`),e instanceof HTMLLinkElement?e.replaceWith(i):(e instanceof Element&&(e.innerHTML=""),e.appendChild(i)),o.emit("log:error",{scope:"PartialLoader",message:"Partial load failed",error:t,context:{url:e instanceof HTMLLinkElement?e.href:void 0,retryAttempts:this.options.retryAttempts}}),this.logDebug("Error displayed in container",{container:e,error:t})}isPartialLoaded(e){return this.loadedPartials.has(e)}resolveUrl(e){if(/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e)||e.startsWith("//"))return this.logDebug("URL is already absolute",{src:e}),e;try{let t=this.options.baseUrl||window.location.origin+"/",i=new URL(e,t).toString(),r=i.startsWith(window.location.origin)?i.slice(window.location.origin.length)||"/":i;return this.logDebug("Resolved relative URL",{src:e,resolvedUrl:r}),r}catch(t){return this.logDebug("Failed to resolve URL",{src:e,error:t}),e}}delay(e){return this.logDebug("Delaying execution",{ms:e}),new Promise(t=>setTimeout(t,e))}async loadContainer(e=document){let t=e.querySelectorAll('link[rel="partial"][src]');return t.length?this.load(Array.from(t)):[]}watch(e=document.body){if(!window.MutationObserver)return;let t=new MutationObserver(b(()=>this.loadContainer(e),100));return t.observe(e,{childList:!0,subtree:!0}),this.logDebug("Watching container for partials",{container:e}),t}async fetchWithLoaderCache(e){if(this.options.cacheEnabled&&this.cache.has(e))return this.logDebug("Fetching from cache",{url:e}),this.cache.get(e);let t=await this.fetchPartial(e);return this.options.cacheEnabled&&this.cache.set(e,t),this.logDebug("Fetched and cached partial",{url:e}),t}}});var x,q=g(()=>{"use strict";m();N();x=class{static loader;static getLoader(){return this.loader??(this.loader=new L)}static logDebug(e,t){let i={scope:"PartialFetcher",level:"debug",message:e,data:t,time:Date.now()};o.emit("log",i)}static async load(e,t,i={}){let r=i.loader??this.getLoader(),n=document.querySelector(t);if(!n)throw new Error(`Target ${t} not found`);try{this.logDebug("Fetching partial",{url:e,targetSelector:t}),await r.load([{url:e,container:n}]),o.emit("partial:loaded",{url:e,targetSelector:t,cached:!1}),this.logDebug("Partial loaded successfully",{url:e,targetSelector:t})}catch(s){throw o.emit("partial:error",{url:e,error:s}),this.logDebug("Partial load error",{url:e,error:s}),s}finally{o.emit("partial:load:complete",{url:e,targetSelector:t,error:!1})}}static async preload(e,t){let i=t??this.getLoader(),r=document.createElement("div");return Promise.all(e.map(async n=>{try{this.logDebug("Preloading partial",{url:n}),await i.load([{url:n,container:r}]),o.emit("partial:loaded",{url:n,cached:!0})}catch(s){o.emit("partial:error",{url:n,error:s}),this.logDebug("Preload error",{url:n,error:s})}finally{o.emit("partial:load:complete",{url:n,error:!1})}}))}static watch(e=document.body,t){let i=t??this.getLoader();return this.logDebug("Watching container for partials",{container:e}),i.watch?.(e)}}});var P,J=g(()=>{"use strict";P=class{container;includePicture;debug;cache=new WeakMap;destroyed=!1;constructor(e,t={}){if(!(e instanceof Element))throw new Error("AsyncImageLoader: container must be a DOM Element.");this.container=e,this.includePicture=t.includePicture??!1,this.debug=t.debug??!1}logDebug(e,t){this.debug&&console.debug(`[AsyncImageLoader] ${e}`,t)}ensureActive(e){if(this.destroyed||!this.container)throw new Error(`AsyncImageLoader: Instance destroyed. Method: ${e}`)}getImages(e="img"){if(this.ensureActive("getImages"),!e.trim())return[];let t=new Set;return this.container.querySelectorAll(e).forEach(i=>{if(i instanceof HTMLImageElement){if(!this.includePicture&&i.closest("picture"))return;t.add(i)}}),[...t]}async waitForImagesToLoad(e="img",t=!1,i=1e4){this.logDebug("Waiting for images to load",{selector:e,includeFailed:t,timeout:i});let r=this.getImages(e),n=await Promise.all(r.map(s=>this.cache.has(s)?(this.logDebug("Image already cached",{img:s}),{element:s,loaded:!0}):s.complete&&s.naturalWidth>0?(this.cache.set(s,!0),this.logDebug("Image already loaded",{img:s}),{element:s,loaded:!0}):new Promise(l=>{let d=()=>{clearTimeout(u),this.cache.set(s,!0),this.logDebug("Image loaded successfully",{img:s}),l({element:s,loaded:!0})},h=()=>{clearTimeout(u),this.logDebug("Image failed to load",{img:s}),l({element:s,loaded:!1})},u=setTimeout(()=>{s.removeEventListener("load",d),s.removeEventListener("error",h),this.logDebug("Image load timeout",{img:s}),l({element:s,loaded:!1})},i);s.addEventListener("load",d,{once:!0}),s.addEventListener("error",h,{once:!0})})));return t?n:n.filter(s=>s.loaded).map(s=>s.element)}getImageData(e="img"){return this.getImages(e).map(t=>{let i=[];if(this.includePicture){let r=t.closest("picture");r&&r.querySelectorAll("source").forEach(n=>{i.push({srcset:n.srcset||"",type:n.type||"",media:n.media||""})})}return{element:t,src:t.src||"",alt:t.alt||"",href:t.closest("a")?.href??null,sources:i}})}clearCache(){this.logDebug("Clearing image cache"),this.cache=new WeakMap}destroy(){this.container=null,this.destroyed=!0}}});var Z,p,Q=g(()=>{"use strict";Z=class{callbacks=new Set;running=!1;_rafId=null;errorHandler;constructor(e=console.error){this.errorHandler=e}add(e){if(typeof e!="function")throw new TypeError("AnimationLoop.add: Callback must be a function");this.callbacks.has(e)||this.callbacks.add(e),this.start()}remove(e){this.callbacks.delete(e),this.callbacks.size===0&&this.stop()}clear(){this.callbacks.clear(),this.stop()}has(e){return this.callbacks.has(e)}pause(){this.stop()}resume(){this.callbacks.size>0&&this.start()}start(){this.running||this.callbacks.size===0||(this.running=!0,this._rafId=requestAnimationFrame(this._loop))}stop(){this.running=!1,this._rafId!==null&&cancelAnimationFrame(this._rafId),this._rafId=null}_loop=()=>{if(this.running){for(let e of Array.from(this.callbacks))try{e()}catch(t){this.errorHandler(t)}this._rafId=requestAnimationFrame(this._loop)}}},p=new Z});var S,ee=g(()=>{"use strict";S=class{pausedReasons=new Set;set(e,t){t?this.pausedReasons.add(e):this.pausedReasons.delete(e)}has(e){return this.pausedReasons.has(e)}isPaused(){return this.pausedReasons.size>0}list(){return Array.from(this.pausedReasons)}clear(){this.pausedReasons.clear()}}});var de={};B(de,{SlidePlayer:()=>te,VERSION:()=>Le});var Le,te,ce=g(()=>{"use strict";m();H();J();Q();ee();I();Le="2.0.0",te=class a{static SWIPE_THRESHOLD=50;static VERTICAL_TOLERANCE=30;static DEFAULT_INTERVAL=5e3;container;interval;includePicture;dotsSelector;autoCreateDots;enableBusEvents;autoplay;debug;slides=[];dots=[];dotsWrapper=null;currentIndex=0;lastTickTime=0;isDestroyed=!1;isPointerDown=!1;pointerStartX=0;pointerStartY=0;pointerEndX=0;pointerEndY=0;animationPolicy=new S;loader;binder;animateCallback;lastPauseState=!1;ready;initError=null;constructor(e,{interval:t=a.DEFAULT_INTERVAL,includePicture:i=!1,dotsSelector:r=".dots",autoCreateDots:n=!1,startPaused:s=!1,enableBusEvents:l=!0,autoplay:d=!0,debug:h=!1}={}){this.container=this.resolveContainer(e),this.interval=t>0?t:a.DEFAULT_INTERVAL,this.includePicture=i,this.dotsSelector=r,this.autoCreateDots=n,this.enableBusEvents=l,this.autoplay=d,this.debug=h,this.loader=new P(this.container,{includePicture:i}),this.binder=new v(this.debug),s&&this.animationPolicy.set("manual",!0),this.animateCallback=()=>this.animate(),this.ready=this.init().catch(u=>{this.initError=u,this.log("error","SlidePlayer init failed",u)}).then(()=>{}),this.log("info","SlidePlayer initialized",{container:this.container,interval:t,autoplay:d,debug:h})}log(e,t,i){if(!this.debug&&e==="debug")return;let r={scope:"SlidePlayer",level:e,message:t,data:i,time:Date.now()};o.emit(c.SLIDEPLAYER_LOG,{level:e,message:t,data:i}),o.emit(c.LOG,r),this.debug&&console[{debug:"debug",info:"info",warn:"warn",error:"error"}[e]]?.(`[SlidePlayer] [${e.toUpperCase()}]`,t,i)}resolveContainer(e){let t=typeof e=="string"?document.querySelector(e):e;if(!t)throw new Error("SlidePlayer: container element not found.");return t}async init(){if(await this.loader.waitForImagesToLoad(),this.refreshSlides(),!this.slides.length){this.log("warn","No .slide elements found in container.");return}this.setupDots(),this.bindEvents(),this.setActiveSlide(0),this.lastTickTime=performance.now(),!this.isPaused()&&this.autoplay&&p.add(this.animateCallback)}animate(){if(this.isDestroyed||!this.autoplay||this.isPaused()||this.slides.length<2)return;let e=performance.now();e-this.lastTickTime>=this.interval&&(this.next(!1),this.lastTickTime=e)}togglePause(e,t){this.animationPolicy.set(e,t),this.emitPauseResumeIfChanged(),this.isPaused()?(p.has(this.animateCallback)&&p.remove(this.animateCallback),this.log("debug",`Paused due to: ${this.animationPolicy.list().join(", ")}`)):(p.has(this.animateCallback)||p.add(this.animateCallback),this.log("debug","Resumed playback"))}emitPauseResumeIfChanged(){let e=this.isPaused();if(e!==this.lastPauseState){this.lastPauseState=e;let t=e?"slideplayer:paused":"slideplayer:resumed";this.emit(t,{reasons:this.animationPolicy.list()})}}play(){this.togglePause("manual",!1)}pause(){this.togglePause("manual",!0)}isPaused(){return this.animationPolicy.isPaused()}goToSlide(e,t=!0){e<0||e>=this.slides.length||e===this.currentIndex||(this.setActiveSlide(e),t&&this.resetTimer())}next(e=!0){this.slides.length<2||this.goToSlide((this.currentIndex+1)%this.slides.length,e)}prev(e=!0){if(this.slides.length<2)return;let t=(this.currentIndex-1+this.slides.length)%this.slides.length;this.goToSlide(t,e)}refreshSlides(){this.slides=Array.from(this.container.querySelectorAll(".slide"))}setupDots(){this.dotsWrapper=this.container.querySelector(this.dotsSelector),!this.dotsWrapper&&this.autoCreateDots&&(this.dotsWrapper=document.createElement("div"),this.dotsWrapper.className="dots",this.container.appendChild(this.dotsWrapper)),this.dotsWrapper&&(this.dotsWrapper.innerHTML="",this.dots=this.slides.map((e,t)=>{let i=document.createElement("div");return i.className="dot",i.dataset.index=t.toString(),this.binder.bindDOM(i,"click",()=>this.goToSlide(t)),this.dotsWrapper.appendChild(i),i}))}updateDots(e){this.dots.forEach((t,i)=>t.classList.toggle("active",i===e))}setActiveSlide(e){let t=this.currentIndex;this.slides[this.currentIndex]?.classList.remove("active"),this.currentIndex=e,this.slides[this.currentIndex]?.classList.add("active"),this.updateDots(e),t!==e&&this.emit("slideplayer:slideChanged",{index:e},"slideplayer:slide-changed")}resetTimer(){this.lastTickTime=performance.now()}bindEvents(){this.bindPointerEvents(),this.bindKeyboardEvents(),this.bindVisibilityEvents(),this.bindActivityEvents(),this.bindUnloadEvent()}bindPointerEvents(){this.binder.bindDOM(this.container,"pointerdown",e=>{let t=e;this.isPointerDown=!0,this.pointerStartX=t.clientX,this.pointerStartY=t.clientY,this.pointerEndX=t.clientX,this.pointerEndY=t.clientY}),this.binder.bindDOM(this.container,"pointermove",e=>{if(!this.isPointerDown)return;let t=e;this.pointerEndX=t.clientX,this.pointerEndY=t.clientY}),this.binder.bindDOM(window,"pointerup",()=>{this.isPointerDown&&(this.handleSwipe(),this.isPointerDown=!1)}),this.binder.bindDOM(window,"pointercancel",()=>{this.isPointerDown=!1}),this.binder.bindDOM(this.container,"pointerleave",()=>this.isPointerDown=!1),this.binder.bindDOM(this.container,"mouseenter",()=>this.togglePause("hover",!0)),this.binder.bindDOM(this.container,"mouseleave",()=>this.togglePause("hover",!1))}bindKeyboardEvents(){this.binder.bindDOM(document,"keydown",e=>{let t=e;t.key==="ArrowRight"?this.next():t.key==="ArrowLeft"&&this.prev()})}bindVisibilityEvents(){this.binder.bindDOM(document,"visibilitychange",()=>{this.togglePause("hidden",document.visibilityState==="hidden")})}bindActivityEvents(){this.enableBusEvents&&(this.binder.bindBus(c.USER_INACTIVE,()=>this.togglePause("inactivity",!0)),this.binder.bindBus(c.USER_ACTIVE,()=>this.togglePause("inactivity",!1)),this.binder.bindBus(c.SCREENSAVER_SHOWN,()=>this.togglePause("screensaver",!0)),this.binder.bindBus(c.SCREENSAVER_HIDDEN,()=>this.togglePause("screensaver",!1)))}bindUnloadEvent(){this.binder.bindDOM(window,"beforeunload",()=>this.destroy())}handleSwipe(){let e=this.pointerEndX-this.pointerStartX,t=this.pointerEndY-this.pointerStartY;if(Math.abs(e)>=a.SWIPE_THRESHOLD&&Math.abs(t)<a.VERTICAL_TOLERANCE){let i=e<0?"next":"prev";this.log("debug","Swipe detected",{dx:e,dy:t,direction:i}),e<0?this.next():this.prev()}}emit(e,t,i){this.container.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0})),this.enableBusEvents&&i&&o.emit(i,t)}destroy(){this.isDestroyed||(this.isDestroyed=!0,p.remove(this.animateCallback),this.binder.unbindAll(),this.loader.destroy(),this.slides=[],this.dots=[],this.dotsWrapper=null,this.animationPolicy.clear(),this.log("info","SlidePlayer destroyed"))}get currentSlideIndex(){return this.currentIndex}get slideCount(){return this.slides.length}}});var R,he=g(()=>{"use strict";R=(a,e,t)=>{if(e>t)throw new RangeError("The `min` value cannot be greater than the `max` value.");return Math.max(e,Math.min(a,t))}});var ue,W,ge,pe,O,me=g(()=>{"use strict";he();ue=.85,W=.1,ge=2.5,pe=.02,O=class{element;size;x;y;vx;vy;options;constructor(e,t,i={}){this.element=e,this.options={useSubpixel:!0,debug:!1,...i},this.size={width:e.offsetWidth,height:e.offsetHeight},this.x=Math.random()*Math.max(0,t.width-this.size.width),this.y=Math.random()*Math.max(0,t.height-this.size.height),this.vx=(Math.random()-.5)*3,this.vy=(Math.random()-.5)*3,e.style.willChange="transform",e.style.backfaceVisibility="hidden",e.style.perspective="1000px",e.style.opacity="1",this.updatePosition()}logDebug(e,t){this.options.debug&&console.debug(`[FloatingImage] ${e}`,t)}updatePosition(){if(!this.element)return this.logDebug("updatePosition called on destroyed element"),!1;let e=this.options.useSubpixel?this.x:Math.round(this.x),t=this.options.useSubpixel?this.y:Math.round(this.y);return this.element.style.transform=`translate3d(${e}px, ${t}px, 0)`,this.logDebug("Position updated",{x:e,y:t}),!0}getElement(){return this.element}update(e,t,i=!0){return this.element?(this.x+=this.vx*e,this.y+=this.vy*e,this.handleCollisions(t),this.applyVelocityJitter(),i?this.updatePosition():!0):(this.logDebug("update called on destroyed element"),!1)}handleCollisions(e){if(this.x<=0||this.x+this.size.width>=e.width){this.vx=-this.vx*ue;let t=this.vx>=0?1:-1;this.vx=Math.abs(this.vx)<W?t*W:this.vx,this.x=R(this.x,0,Math.max(0,e.width-this.size.width)),this.logDebug("Horizontal collision handled",{x:this.x,vx:this.vx})}if(this.y<=0||this.y+this.size.height>=e.height){this.vy=-this.vy*ue;let t=this.vy>=0?1:-1;this.vy=Math.abs(this.vy)<W?t*W:this.vy,this.y=R(this.y,0,Math.max(0,e.height-this.size.height)),this.logDebug("Vertical collision handled",{y:this.y,vy:this.vy})}}applyVelocityJitter(){this.vx+=(Math.random()-.5)*pe,this.vy+=(Math.random()-.5)*pe;let e=this.vx**2+this.vy**2;if(e>ge**2){let t=ge/Math.sqrt(e);this.vx*=t,this.vy*=t,this.logDebug("Velocity clamped",{vx:this.vx,vy:this.vy})}}resetPosition(e){this.x=Math.random()*Math.max(0,e.width-this.size.width),this.y=Math.random()*Math.max(0,e.height-this.size.height),this.updatePosition()}updateSize(){this.element&&(this.size.width=this.element.offsetWidth,this.size.height=this.element.offsetHeight)}clampPosition(e){this.x=R(this.x,0,Math.max(0,e.width-this.size.width)),this.y=R(this.y,0,Math.max(0,e.height-this.size.height))}destroy(){this.element&&(this.element.style.willChange="auto",this.element.style.backfaceVisibility="",this.element.style.perspective="",this.element=null)}}});var V,fe=g(()=>{"use strict";V=class{fps=60;lastTime=performance.now();frameSkipThreshold=30;shouldSkipFrame=!1;frameCount=0;cachedPerformanceLevel="high";lastLevelUpdate=0;levelUpdateInterval=1e3;cachedSettings=null;lastLoggedFPS=60;fpsLogThreshold=5;update(){let e=performance.now(),t=e-this.lastTime;if(t<1)return this.shouldSkipFrame;let i=1e3/t;return this.fps=this.fps*.9+i*.1,this.frameCount++,this.shouldSkipFrame=this.fps<this.frameSkipThreshold,Math.abs(this.fps-this.lastLoggedFPS)>=this.fpsLogThreshold&&(this.lastLoggedFPS=this.fps),this.lastTime=e,this.shouldSkipFrame}getFrameCount(){return this.frameCount}getCurrentFPS(){return Math.round(this.fps*10)/10}getPerformanceLevel(){let e=performance.now();return e-this.lastLevelUpdate>this.levelUpdateInterval&&(this.cachedPerformanceLevel=this.fps>=50?"high":this.fps>=30?"medium":"low",this.lastLevelUpdate=e,this.cachedSettings=null),this.cachedPerformanceLevel}getRecommendedSettings(){if(this.cachedSettings)return this.cachedSettings;let e=this.getPerformanceLevel(),t={high:{maxImages:50,speedMultiplier:1,useSubpixel:!0},medium:{maxImages:25,speedMultiplier:.8,useSubpixel:!1},low:{maxImages:10,speedMultiplier:.5,useSubpixel:!1}};return this.cachedSettings=t[e],this.cachedSettings}reset(){this.fps=60,this.lastTime=performance.now(),this.shouldSkipFrame=!1,this.frameCount=0,this.cachedPerformanceLevel="high",this.lastLevelUpdate=0,this.cachedSettings=null,this.lastLoggedFPS=60}}});var ie,U,ve=g(()=>{"use strict";C();ie=class{windowCallbacks=new Map;elementObservers=new Map;debug=!1;setDebugMode(e){this.debug=e}logDebug(e,t){this.debug&&console.debug(`[ResizeManager] ${e}`,t)}wrapCallback(e,t){if(t?.debounceMs!=null)return b(e,t.debounceMs);if(t?.throttleMs!=null)return z(e,t.throttleMs);{let i=e;return i.cancel=()=>{},i}}onWindow(e,t={debounceMs:200}){let i=b(e,t.debounceMs),r=()=>i();return this.windowCallbacks.set(e,r),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),i.cancel?.(),this.windowCallbacks.delete(e)}}onElement(e,t,i){this.logDebug("Registering element resize callback",{el:e,cb:t,options:i});let r=this.elementObservers.get(e);if(!r){let s=new Set,l=new ResizeObserver(d=>{try{let h=d[0];s.forEach(u=>u(h))}catch(h){this.logDebug("ResizeObserver callback error",{error:h})}});r={observer:l,callbacks:s},this.elementObservers.set(e,r),l.observe(e)}let n=this.wrapCallback(t,i);return r.callbacks.add(n),()=>{this.logDebug("Removing element resize callback",{el:e,cb:t}),r.callbacks.delete(n),n.cancel?.(),r.callbacks.size===0&&(r.observer.disconnect(),this.elementObservers.delete(e))}}getElement(e){try{let t=e.getBoundingClientRect();return{width:t.width,height:t.height}}catch{throw new Error("ResizeManager: Failed to get element size.")}}destroy(){this.logDebug("Destroying ResizeManager");for(let[e,t]of this.windowCallbacks.entries())window.removeEventListener("resize",t);this.windowCallbacks.clear();for(let e of this.elementObservers.values()){e.observer.disconnect();for(let t of e.callbacks)t.cancel?.()}this.elementObservers.clear(),this.logDebug("ResizeManager destroyed")}},U=new ie});var ye={};B(ye,{FloatingImagesManager:()=>T,VERSION:()=>Pe});var Pe,T,re=g(()=>{"use strict";me();fe();ve();J();Q();m();C();ee();I();Pe="2.1.0",T=class{container;performanceMonitor;images=[];speedMultiplier=1;isInViewport=!0;_destroyed=!1;animateCallback;maxImages;intersectionObserver;unsubscribeWindow;unsubscribeElement;imageLoader;containerWidth;containerHeight;debug;hoverBehavior;hoverSlowMultiplier;tapToFreeze;pauseOnScreensaver;interactionCleanups=[];frozenElements=new WeakSet;imageSpeedOverrides=new WeakMap;unsubScreensaverShown;unsubScreensaverHidden;unbindVisibility;pausedByScreensaver=!1;speedBeforeScreensaver=1;animationPolicy=new S;constructor(e,t={}){this.container=e,this.debug=t.debug??!1,this.hoverBehavior=t.hoverBehavior??"none",this.hoverSlowMultiplier=t.hoverSlowMultiplier??.2,this.tapToFreeze=t.tapToFreeze??!0,this.pauseOnScreensaver=t.pauseOnScreensaver??!1,this.performanceMonitor=new V;let i=this.performanceMonitor.getRecommendedSettings();this.maxImages=t.maxImages??i.maxImages,this.intersectionObserver=new IntersectionObserver(r=>{let n=r[0];n&&(this.isInViewport=!!n.isIntersecting)},{threshold:0}),this.intersectionObserver.observe(this.container),this.setupResizeHandling(),this.setupScreensaverHandling(),this.imageLoader=new P(this.container),this.updateContainerDimensions(),this.animateCallback=()=>this.animate(),p.has(this.animateCallback)||p.add(this.animateCallback),this.initializeImages(),this.log("info","FloatingImagesManager initialized",{container:this.container,maxImages:this.maxImages})}log(e,t,i){if(!this.debug&&e==="debug")return;let r={scope:"FloatingImagesManager",level:e,message:t,data:i,time:Date.now()};if(o.emit(c.FLOATING_IMAGES_LOG,{level:e,message:t,data:i}),o.emit(c.LOG,r),this.debug){let s={debug:"debug",info:"info",warn:"warn",error:"error"}[e]??"log";console[s](`[FloatingImagesManager] [${e.toUpperCase()}]`,t,i)}}setupResizeHandling(){this.unsubscribeWindow=U.onWindow(()=>this.handleResize()),this.unsubscribeElement=U.onElement(this.container,()=>this.handleResize())}setupScreensaverHandling(){if(!this.pauseOnScreensaver)return;this.unsubScreensaverShown=o.on(c.SCREENSAVER_SHOWN,()=>{this.pausedByScreensaver||(this.speedBeforeScreensaver=this.speedMultiplier,this.speedMultiplier=0,this.pausedByScreensaver=!0,this.animationPolicy.set("screensaver",!0),this.log("debug","Paused due to screensaver"))}),this.unsubScreensaverHidden=o.on(c.SCREENSAVER_HIDDEN,()=>{this.pausedByScreensaver&&(this.speedMultiplier=this.speedBeforeScreensaver,this.pausedByScreensaver=!1,this.animationPolicy.set("screensaver",!1),this.log("debug","Resumed after screensaver"))});let e=()=>{this.animationPolicy.set("hidden",document.visibilityState==="hidden")};document.addEventListener("visibilitychange",e),this.unbindVisibility=()=>document.removeEventListener("visibilitychange",e)}updateContainerDimensions(){if(!this.container.isConnected){this.containerWidth=0,this.containerHeight=0,this.log("warn","Container is not in the DOM, dimensions set to 0");return}let e=U.getElement(this.container);this.containerWidth=e.width,this.containerHeight=e.height}async initializeImages(){try{let e=await this.imageLoader.waitForImagesToLoad(".floating-image"),t={width:this.containerWidth,height:this.containerHeight};e.slice(0,this.maxImages).forEach(i=>{this._destroyed||this.addExistingImage(i,t)}),this.log("info","Images initialized",{count:this.images.length})}catch(e){this.log("error","Failed to initialize images",e)}}addExistingImage(e,t){if(this.images.length>=this.maxImages)return;let i=new O(e,t,{debug:this.debug});this.images.push(i),this.bindImageInteraction(e)}handleResize=b(()=>{try{if(this._destroyed)return;if(!this.container.isConnected){this.log("warn","Resize event ignored, container not in DOM");return}this.updateContainerDimensions();let e={width:this.containerWidth,height:this.containerHeight};this.images.forEach(t=>{t.updateSize(),t.clampPosition(e),t.updatePosition()}),this.log("debug","Container resized",e)}catch(e){this.log("error","Error during handleResize",e)}},200);animate(){if(this._destroyed||!this.isInViewport||this.speedMultiplier===0||this.animationPolicy.isPaused()||this.performanceMonitor.update())return;let t=this.speedMultiplier,i={width:this.containerWidth,height:this.containerHeight};this.images=this.images.filter(r=>{let n=r.getElement(),s=n?this.imageSpeedOverrides.get(n)??t:t;return s<=0?r.updatePosition():r.update(s,i)})}resetAllImagePositions(){let e={width:this.containerWidth,height:this.containerHeight};this.images.forEach(t=>t.resetPosition(e)),this.log("debug","All image positions reset",e)}reinitializeImages(){try{if(this._destroyed)return;if(!this.container.isConnected){this.log("warn","reinitializeImages: container not in DOM, skipping");return}this.images.forEach(i=>i.destroy()),this.images.length=0,this.unbindImageInteractions();let e={width:this.containerWidth,height:this.containerHeight};Array.from(this.container.querySelectorAll(".floating-image")).slice(0,this.maxImages).forEach(i=>{let r=new O(i,e,{debug:this.debug});this.images.push(r),this.bindImageInteraction(i)}),this.log("info","Images reinitialized",{count:this.images.length})}catch(e){this.log("error","Error during reinitializeImages",e)}}destroy(){this._destroyed||(this._destroyed=!0,p.has(this.animateCallback)&&p.remove(this.animateCallback),this.unsubscribeWindow?.(),this.unsubscribeElement?.(),this.unsubScreensaverShown?.(),this.unsubScreensaverHidden?.(),this.unbindVisibility?.(),this.unsubscribeWindow=void 0,this.unsubscribeElement=void 0,this.unsubScreensaverShown=void 0,this.unsubScreensaverHidden=void 0,this.unbindVisibility=void 0,this.intersectionObserver.disconnect(),this.unbindImageInteractions(),this.images.forEach(e=>e.destroy()),this.images.length=0,this.imageLoader.destroy(),this.containerWidth=0,this.containerHeight=0,this.log("info","FloatingImagesManager destroyed"))}bindImageInteraction(e){let t=this.hoverBehavior!=="none",i=this.tapToFreeze;if(!t&&!i)return;let r=()=>{if(this.hoverBehavior!=="none"&&!this.frozenElements.has(e)){if(this.hoverBehavior==="stop"){this.imageSpeedOverrides.set(e,0);return}this.imageSpeedOverrides.set(e,this.hoverSlowMultiplier)}},n=()=>{this.frozenElements.has(e)||this.imageSpeedOverrides.delete(e)},s=l=>{if(!(!this.tapToFreeze||l.pointerType!=="touch")){if(this.frozenElements.has(e)){this.frozenElements.delete(e),this.imageSpeedOverrides.delete(e);return}this.frozenElements.add(e),this.imageSpeedOverrides.set(e,0)}};e.addEventListener("pointerenter",r),e.addEventListener("pointerleave",n),e.addEventListener("pointerup",s),this.interactionCleanups.push(()=>{e.removeEventListener("pointerenter",r),e.removeEventListener("pointerleave",n),e.removeEventListener("pointerup",s),this.imageSpeedOverrides.delete(e)})}unbindImageInteractions(){this.interactionCleanups.forEach(e=>e()),this.interactionCleanups=[],this.frozenElements=new WeakSet,this.imageSpeedOverrides=new WeakMap}}});var be={};B(be,{ScreensaverController:()=>ne,VERSION:()=>Se});var Se,ne,Ee=g(()=>{"use strict";m();H();Y();q();re();I();Se="2.0.0",ne=class a{static STATES={IDLE:"idle",LOADING:"loading",VISIBLE:"visible",HIDING:"hiding",DESTROYED:"destroyed"};partialUrl;targetSelector;inactivityDelay;debug;onError;screensaverManager=null;watcher=null;_destroyed=!1;eventBinder;_partialLoaded=!1;partialFetcher;_loadPromise;_hideTimeout=null;_bound=!1;state=a.STATES.IDLE;_onInactivity;_onActivity;constructor(e){this.partialUrl=e.partialUrl,this.targetSelector=e.targetSelector,this.inactivityDelay=e.inactivityDelay??12e3,this.debug=!!e.debug,this.watcher=e.watcher??null,this.partialFetcher=e.partialFetcher??x,this.onError=e.onError,this.eventBinder=new v(this.debug),this._onInactivity=this.showScreensaver.bind(this),this._onActivity=this.hideScreensaver.bind(this),this.log("info","ScreensaverController initialized",{partialUrl:this.partialUrl,targetSelector:this.targetSelector,inactivityDelay:this.inactivityDelay})}log(e,t,i){if(!this.debug&&e==="debug")return;let r={scope:"ScreensaverController",level:e,message:t,data:i,time:Date.now()};if(o.emit(c.SCREENSAVER_LOG,{level:e,message:t,data:i}),o.emit(c.LOG,r),this.debug){let s={debug:"debug",info:"info",warn:"warn",error:"error"}[e]??"log";console[s](`[ScreensaverController] [${e.toUpperCase()}]`,t,i)}}async init(){if(!this._destroyed&&!this._bound)try{this.watcher||(this.watcher=E.getInstance({inactivityDelay:this.inactivityDelay})),this.eventBinder.bindBus(c.USER_INACTIVE,this._onInactivity),this.eventBinder.bindBus(c.USER_ACTIVE,this._onActivity),this._bound=!0,this.log("info","Bound user inactivity/active events")}catch(e){this.handleError("Failed to initialize inactivity watcher",e)}}async showScreensaver(){if(!this._destroyed&&!(this.state===a.STATES.VISIBLE||this.state===a.STATES.LOADING))try{this.state=a.STATES.LOADING,this._partialLoaded||(this._loadPromise||(this._loadPromise=this.partialFetcher.load(this.partialUrl,this.targetSelector).then(()=>{this._partialLoaded=!0}).finally(()=>{this._loadPromise=void 0})),await this._loadPromise);let e=document.querySelector(this.targetSelector);if(!e){this.state=a.STATES.IDLE,this.handleError(`Target selector "${this.targetSelector}" not found`,null);return}e.style.opacity="0",e.style.display="",e.offsetWidth,e.style.transition="opacity 0.5s ease",e.style.opacity="1",this.screensaverManager?(this.screensaverManager.destroy(),this.screensaverManager=new T(e,{debug:this.debug})):this.screensaverManager=new T(e,{debug:this.debug}),this.state=a.STATES.VISIBLE,o.emit(c.SCREENSAVER_SHOWN,{targetSelector:this.targetSelector}),this.log("info","Screensaver displayed")}catch(e){this.state=a.STATES.IDLE,this.handleError("Failed to load or show screensaver",e)}}hideScreensaver(){if(!this._destroyed&&!(this.state===a.STATES.IDLE||this.state===a.STATES.HIDING))try{this.state=a.STATES.HIDING;let e=document.querySelector(this.targetSelector);e?(e.style.transition="opacity 0.5s ease",e.style.opacity="0",this._hideTimeout&&clearTimeout(this._hideTimeout),this._hideTimeout=window.setTimeout(()=>{e.style.display="none",this.state=a.STATES.IDLE,this._hideTimeout=null},500)):this.state=a.STATES.IDLE,o.emit(c.SCREENSAVER_HIDDEN,{targetSelector:this.targetSelector}),this.log("debug","Screensaver hidden")}catch(e){this.state=a.STATES.IDLE,this.handleError("Failed to hide screensaver",e)}}destroy(){if(!this._destroyed){this._destroyed=!0,this.state=a.STATES.DESTROYED,this.hideScreensaver();try{this.screensaverManager?.destroy()}catch(e){this.log("warn","screensaverManager.destroy() failed",e)}this.eventBinder.unbindAll(),this._partialLoaded=!1,this._hideTimeout&&(clearTimeout(this._hideTimeout),this._hideTimeout=null),this._loadPromise=void 0,this._bound=!1,this.log("info","ScreensaverController destroyed")}}handleError(e,t){o.emit(c.SCREENSAVER_ERROR,{message:e,error:t}),this.onError?.(e,t),this.log("error",e,t)}}});var F=class{static#e=null;static ready(){return this.#e||(this.#e=document.readyState!=="loading"?Promise.resolve():new Promise(e=>{document.addEventListener("DOMContentLoaded",()=>e(),{once:!0})})),this.#e}static waitForElement(e,t={}){let{timeout:i=5e3,root:r=document,signal:n}=t;if(i<=0)return Promise.reject(new TypeError("Timeout must be greater than 0"));let s=Array.isArray(e)?e:[e],l=new Map;return new Promise((d,h)=>{let u,f=()=>{for(let A of s)if(!l.has(A)){let k=r.querySelector(A);k&&l.set(A,k)}l.size===s.length&&(y(),d(s.length===1?l.get(s[0]):Array.from(l.values())))},M=new MutationObserver(f),y=()=>{M.disconnect(),u!==void 0&&clearTimeout(u),n?.removeEventListener("abort",G)},G=()=>{y(),h(new DOMException("waitForElement aborted","AbortError"))};if(n?.aborted)return G();n?.addEventListener("abort",G,{once:!0}),M.observe(r,{childList:!0,subtree:!0}),f(),u=window.setTimeout(()=>{y();let A=s.filter(k=>!l.has(k));h(new DOMException(`Element(s) "${A.join(", ")}" not found within ${i}ms in root: ${r.nodeName}`,"TimeoutError"))},i)})}};Y();m();H();K();q();N();function X(a="id",e=9,t=!1){if(!Number.isInteger(e)||e<=0)throw new Error("Length must be a positive integer.");let i=t?Array.from(crypto.getRandomValues(new Uint8Array(e))).map(r=>(r%36).toString(36)).join(""):Math.random().toString(36).slice(2,2+e);return`${a}-${i}`}I();var se=class{config;constructor(e={}){this.config={hostname:e.hostname??window.location.hostname,production:e.production??(window.location.hostname!=="localhost"&&!window.location.hostname.includes("127.0.0.1")),features:e.features??{},...e}}},$=class a{static EVENT_LOG=c.LOG;static EVENT_TELEMETRY=c.TELEMETRY;appConfig;debug;pageType;startTime;featureModules;featureCache=new Map;inactivityWatcher=null;screensaverController=null;slideshows=[];floatingImagesManagers=[];_partialUnsub;_partialObserver;pjaxFeatures=new Map;managedFeatures=[];onceFeatures=[];constructor(e={}){this.appConfig=new se(e),this.appConfig.config.features=this.normalizeFeaturesConfig(this.appConfig.config.features),this.debug=!!this.appConfig.config.debug,this.pageType=this.resolvePageType(),this.startTime=performance.now(),this.featureModules={partialLoader:()=>Promise.resolve().then(()=>(N(),le)),slideplayer:()=>Promise.resolve().then(()=>(ce(),de)),screensaver:()=>Promise.resolve().then(()=>(Ee(),be)),floatingImages:()=>Promise.resolve().then(()=>(re(),ye))},this.appConfig.config.features||this.log("warn","No features specified in config"),this.setupManagedFeatures(),this.setupOnceFeatures()}log(e,...t){if(!this.debug&&e==="debug")return;let[i,...r]=t,n=typeof i=="string"?i:"",s=typeof i=="string"?r.length?r:void 0:t.length?t:void 0,l={level:e,args:t,scope:"Spaceface",message:n,data:s,time:Date.now()};o.emit(a.EVENT_LOG,l),this.debug&&console[e]?.(`[spaceface] [${e.toUpperCase()}]`,...t)}resolvePageType(){let e=document.body;if(e.dataset.page)return e.dataset.page;let i=window.location.pathname.replace(/\/+$/,"")||"/";return i==="/"?"home":(i.split("/").filter(Boolean).pop()??"default").replace(/\.html$/i,"").replace(/^_+/,"")||"default"}async loadFeatureModule(e){if(this.featureCache.has(e))return this.featureCache.get(e);try{let t=await this.featureModules[e]?.();if(!t)throw new Error(`Module "${e}" could not be loaded.`);return this.featureCache.set(e,t),t}catch(t){return this.log("error",`Failed to load module "${e}"`,t),this.featureCache.set(e,null),null}}async initBase(){this.log("info",`App initialization started (Page: ${this.pageType})`),document.documentElement.classList.add("js-enabled",`page-${this.pageType}`),await F.ready(),this.log("info","DOM ready")}finishInit(){let e=(performance.now()-this.startTime).toFixed(2);this.log("info",`App initialized in ${e}ms`),o.emit(a.EVENT_TELEMETRY,{type:"init:duration",value:e,page:this.pageType})}async initInactivityWatcher(){let e=performance.now(),t=this.appConfig.config.features.screensaver;if(!t||this.inactivityWatcher){this.emitFeatureTelemetry("inactivityWatcher",e,"skipped");return}try{this.inactivityWatcher=E.getInstance({inactivityDelay:t.delay??3e3}),this.log("debug",`InactivityWatcher initialized with delay=${t.delay??3e3}ms`),this.emitFeatureTelemetry("inactivityWatcher",e,"success")}catch(i){throw this.emitFeatureTelemetry("inactivityWatcher",e,"error",i),i}}async initSlidePlayer(){let e=performance.now(),t=this.appConfig.config.features.slideplayer;if(!t){this.emitFeatureTelemetry("slideplayer",e,"skipped");return}try{let r=(await this.loadFeatureModule("slideplayer"))?.SlidePlayer;if(!r){this.emitFeatureTelemetry("slideplayer",e,"skipped");return}this.slideshows=Array.from(document.querySelectorAll(".slideshow-container")).map(n=>{let s=new r(n,{interval:t.interval??5e3,includePicture:t.includePicture??!1});return s.ready?.then?.(()=>{}),s}),this.log("info",`${this.slideshows.length} SlidePlayer instance(s) loaded`),this.emitFeatureTelemetry("slideplayer",e,"success")}catch(i){throw this.emitFeatureTelemetry("slideplayer",e,"error",i),i}}async initScreensaver(){let e=performance.now(),t=this.appConfig.config.features.screensaver;if(!t?.partialUrl){this.log("error","Screensaver configuration is missing or incomplete"),this.emitFeatureTelemetry("screensaver",e,"skipped");return}try{let r=(await this.loadFeatureModule("screensaver"))?.ScreensaverController;if(!r)throw new Error("ScreensaverController module is unavailable.");let n=X("screensaver",9),s=Object.assign(document.createElement("div"),{id:n,style:"position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 999; display: none;"});document.body.appendChild(s),this.screensaverController=new r({partialUrl:t.partialUrl,targetSelector:`#${n}`,...t.delay!==void 0&&{inactivityDelay:t.delay}}),await this.screensaverController?.init?.(),o.emit(c.SCREENSAVER_INITIALIZED,n),this.log("info","Screensaver initialized:",n),this.emitFeatureTelemetry("screensaver",e,"success")}catch(i){this.log("error","Failed to initialize screensaver:",i),this.emitFeatureTelemetry("screensaver",e,"error",i)}}async initPartialLoader(){let e=performance.now(),t=this.appConfig.config.features.partialLoader;if(!t?.enabled)return this.emitFeatureTelemetry("partialLoader",e,"skipped"),null;try{let r=(await this.loadFeatureModule("partialLoader"))?.PartialLoader;if(!r)return this.emitFeatureTelemetry("partialLoader",e,"skipped"),null;let n=new r({debug:t.debug??this.debug,baseUrl:t.baseUrl??"/",cacheEnabled:t.cacheEnabled??!0,timeout:t.timeout,retryAttempts:t.retryAttempts});await n.loadContainer(document);let s=n.watch?.(document);return typeof s=="function"?this._partialUnsub=s:s&&(this._partialObserver=s),this.log("info","PartialLoader initialized"),this.emitFeatureTelemetry("partialLoader",e,"success"),n}catch(i){throw this.emitFeatureTelemetry("partialLoader",e,"error",i),i}}async initDomFeatures(){await this.runFeatureGraph(this.managedFeatures,"init")}async initOnceFeatures(){await this.runFeatureGraph(this.onceFeatures,"init"),this.log("info",`Page features initialized for: ${this.pageType}`)}registerPjaxFeature(e,t,i){this.pjaxFeatures.has(e)||this.pjaxFeatures.set(e,{init:t,when:i})}async handlePjaxComplete(){this.pageType=this.resolvePageType(),document.documentElement.classList.add(`page-${this.pageType}`),await this.runFeatureGraph(this.managedFeatures,"onRouteChange");for(let{init:e,when:t}of this.pjaxFeatures.values())t&&!t(this.pageType)||await e()}destroy(){this._partialUnsub?.(),this._partialObserver?.disconnect?.(),this.managedFeatures.forEach(e=>e.destroy()),this.onceFeatures.forEach(e=>e.destroy()),this.featureCache.clear(),document.querySelector('[id^="screensaver"]')?.remove(),this.log("info","Spaceface destroyed, all resources released.")}emitFeatureTelemetry(e,t,i,r){let n=(performance.now()-t).toFixed(2);o.emit(a.EVENT_TELEMETRY,{type:"feature:init",feature:e,status:i,duration:n,page:this.pageType,error:r})}async initFloatingImages(){let e=performance.now(),t=this.appConfig.config.features.floatingImages;if(!t){this.emitFeatureTelemetry("floatingImages",e,"skipped");return}try{let r=(await this.loadFeatureModule("floatingImages"))?.FloatingImagesManager;if(!r){this.emitFeatureTelemetry("floatingImages",e,"skipped");return}let n=t.selector??".floating-images-container",s=Array.from(document.querySelectorAll(n));if(!s.length){this.emitFeatureTelemetry("floatingImages",e,"skipped");return}this.destroyFloatingImagesManagers();let l=t.pauseOnScreensaver??this.pageType==="floatingimages";this.floatingImagesManagers=s.map(d=>new r(d,{maxImages:t.maxImages,debug:t.debug??this.debug,hoverBehavior:t.hoverBehavior??"none",hoverSlowMultiplier:t.hoverSlowMultiplier??.2,tapToFreeze:t.tapToFreeze??!0,pauseOnScreensaver:l})),this.log("info",`${this.floatingImagesManagers.length} FloatingImages instance(s) loaded`),this.emitFeatureTelemetry("floatingImages",e,"success")}catch(i){throw this.emitFeatureTelemetry("floatingImages",e,"error",i),i}}destroyFloatingImagesManagers(){this.floatingImagesManagers.forEach(e=>e.destroy?.()),this.floatingImagesManagers=[]}destroySlidePlayers(){this.slideshows.forEach(e=>e.destroy?.()),this.slideshows=[]}setupManagedFeatures(){this.managedFeatures=[{name:"slideplayer",dependsOn:[],init:()=>this.initSlidePlayer(),onRouteChange:async()=>{this.destroySlidePlayers(),await this.initSlidePlayer()},destroy:()=>this.destroySlidePlayers()},{name:"floatingImages",dependsOn:[],init:()=>this.initFloatingImages(),onRouteChange:async()=>{this.destroyFloatingImagesManagers(),await this.initFloatingImages()},destroy:()=>this.destroyFloatingImagesManagers()}]}setupOnceFeatures(){this.onceFeatures=[{name:"inactivityWatcher",dependsOn:[],init:()=>this.initInactivityWatcher(),destroy:()=>this.inactivityWatcher?.destroy?.()},{name:"screensaver",dependsOn:["inactivityWatcher"],init:()=>this.initScreensaver(),destroy:()=>this.screensaverController?.destroy?.()}]}async runFeatureGraph(e,t){let i=new Map(e.map(s=>[s.name,s])),r=new Set,n=0;for(;i.size;){if(n++,n>e.length*2)throw new Error("Feature dependency graph contains a cycle or unresolved dependency.");let s=!1;for(let[l,d]of Array.from(i.entries()))(d.dependsOn??[]).every(u=>r.has(u))&&(t==="onRouteChange"&&d.onRouteChange?await d.onRouteChange(this.pageType):await d.init(),i.delete(l),r.add(l),s=!0);if(!s){let l=Array.from(i.keys()).join(", ");throw new Error(`Unresolved feature dependencies: ${l}`)}}}getFeatureSnapshot(){return{pageType:this.pageType,managedFeatures:this.managedFeatures.map(e=>e.name),onceFeatures:this.onceFeatures.map(e=>e.name),activeSlidePlayers:this.slideshows.length,activeFloatingImagesManagers:this.floatingImagesManagers.length,inactivityWatcherReady:!!this.inactivityWatcher,screensaverReady:!!this.screensaverController,partialLoaderWatching:!!(this._partialUnsub||this._partialObserver)}}normalizeFeaturesConfig(e){let t={...e},i=r=>typeof r=="number"&&Number.isFinite(r)&&r>0;return t.slideplayer&&t.slideplayer.interval!==void 0&&!i(t.slideplayer.interval)&&(this.log("warn","Invalid slideplayer.interval; expected positive number. Falling back to default."),delete t.slideplayer.interval),t.screensaver&&(typeof t.screensaver.partialUrl!="string"||!t.screensaver.partialUrl.trim()?(this.log("warn","Invalid screensaver.partialUrl; disabling screensaver feature."),delete t.screensaver):t.screensaver.delay!==void 0&&!i(t.screensaver.delay)&&(this.log("warn","Invalid screensaver.delay; removing delay override."),delete t.screensaver.delay)),t.floatingImages&&(t.floatingImages.maxImages!==void 0&&!i(t.floatingImages.maxImages)&&(this.log("warn","Invalid floatingImages.maxImages; removing override."),delete t.floatingImages.maxImages),t.floatingImages.hoverSlowMultiplier!==void 0&&(typeof t.floatingImages.hoverSlowMultiplier!="number"||t.floatingImages.hoverSlowMultiplier<0)&&(this.log("warn","Invalid floatingImages.hoverSlowMultiplier; removing override."),delete t.floatingImages.hoverSlowMultiplier),t.floatingImages.selector!==void 0&&typeof t.floatingImages.selector!="string"&&(this.log("warn","Invalid floatingImages.selector; removing override."),delete t.floatingImages.selector)),t.partialLoader&&(t.partialLoader.timeout!==void 0&&!i(t.partialLoader.timeout)&&(this.log("warn","Invalid partialLoader.timeout; removing override."),delete t.partialLoader.timeout),t.partialLoader.retryAttempts!==void 0&&!i(t.partialLoader.retryAttempts)&&(this.log("warn","Invalid partialLoader.retryAttempts; removing override."),delete t.partialLoader.retryAttempts)),t}};var Te={partialLoader:{enabled:!0,debug:!0,baseUrl:"/",cacheEnabled:!0},slideplayer:{interval:5e3,includePicture:!1},floatingImages:{selector:".floating-images-container",maxImages:24,debug:!1,hoverBehavior:"slow",hoverSlowMultiplier:.2,tapToFreeze:!0},screensaver:{delay:4500,partialUrl:"content/feature/screensaver/index.html"}},w=new $({features:Te});w.initBase().then(async()=>{await w.initPartialLoader(),await w.initDomFeatures(),await w.initOnceFeatures(),w.finishInit()});var Me=["localhost","127.0.0.1"].some(a=>window.location.hostname.includes(a));Me&&o.onAny((a,e)=>{if(a==="log:debug"||a==="log"&&e?.level==="debug")return;let{level:t="log",args:i,...r}=e??{};if(!e)return console.log(`[spaceface onAny] Event: ${a} \u2013 no payload!`);if(typeof e=="string")return console.log(`[spaceface onAny] Event: ${a} [LOG]`,e);let n=i??r??"(no details)",l={debug:"debug",info:"info",warn:"warn",error:"error",log:"log"}[t]??"log";console[l](`[SPCFC *] Event: ${a} [${String(t).toUpperCase()}] \u2013`,n)});window.addEventListener("beforeunload",()=>{w.destroy(),w.log("info","App destroyed on beforeunload")});
//# sourceMappingURL=bundle.min.js.map
