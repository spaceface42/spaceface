{
  "version": 3,
  "sources": ["../../src/system/bin/EventBus.ts", "../../src/system/bin/EventWatcher.ts", "../../src/system/features/bin/timing.ts", "../../src/system/bin/InactivityWatcher.ts", "../../src/system/bin/EventLogger.ts", "../../src/system/bin/EventBinder.ts", "../../src/system/bin/PartialLoader.ts", "../../src/system/bin/PartialFetcher.ts", "../../src/system/bin/ServiceWorkerManager.ts", "../../src/system/features/bin/AsyncImageLoader.ts", "../../src/system/features/bin/AnimationLoop.ts", "../../src/system/features/SlidePlayer/SlidePlayer.ts", "../../src/system/features/bin/math.ts", "../../src/system/features/FloatingImages/FloatingImage.ts", "../../src/system/features/bin/PerformanceMonitor.ts", "../../src/system/features/bin/ResizeManager.ts", "../../src/system/features/FloatingImages/FloatingImagesManager.ts", "../../src/system/features/Screensaver/ScreensaverController.ts", "../../src/system/bin/DomReadyPromise.ts", "../../src/app/symlink.ts", "../../src/system/bin/generateId.ts", "../../src/app/spaceface.core.ts", "../../src/app/pjax.ts", "../../src/app/main.pjax.ts"],
  "sourcesContent": ["export const VERSION = 'nextworld-1.3.0' as const;\n\nimport {\n    UnsubscribeFn,\n    ListenerInterface,\n    AnyListenerInterface,\n    EventBusInterface\n} from '../types/bin.js';\n\nexport class EventBus implements EventBusInterface {\n    private listeners: Map<string, ListenerInterface[]> = new Map();\n    private anyListeners: AnyListenerInterface[] = [];\n    private onceWrappers = new WeakMap<Function, Function>();\n    private emittingError = false;\n    private debugMode = false; // Debug mode flag\n\n    /**\n     * Enable or disable debug mode.\n     * @param enable Set to true to enable debug mode, false to disable.\n     */\n    setDebugMode(enable: boolean): void {\n        this.debugMode = enable;\n        if (this.debugMode) {\n            console.debug(\"[EventBus] Debug mode enabled\");\n        }\n    }\n\n    /**\n     * Register an event listener.\n     * @param event The event name.\n     * @param fn The listener function.\n     * @param priority The priority of the listener.\n     * @returns A function to unsubscribe the listener.\n     */\n    on<T = any>(event: string, fn: (payload: T) => any, priority = 0): UnsubscribeFn {\n        const list = this.listeners.get(event) ?? [];\n        const listener: ListenerInterface = { fn, priority };\n        let i = list.length;\n        while (i > 0 && list[i - 1].priority < priority) i--;\n        list.splice(i, 0, listener);\n        this.listeners.set(event, list);\n\n        if (this.debugMode) {\n            console.debug(`[EventBus] Listener added for event: ${event}`, { priority });\n        }\n\n        return () => this.off(event, fn);\n    }\n\n    /**\n     * Register a one-time event listener.\n     * @param event The event name.\n     * @param fn The listener function.\n     * @param priority The priority of the listener.\n     * @returns A function to unsubscribe the listener.\n     */\n    once<T = any>(event: string, fn: (payload: T) => any, priority = 0): UnsubscribeFn {\n        const wrapper = (payload: T) => {\n            this.off(event, wrapper);\n            fn(payload);\n        };\n        this.onceWrappers.set(fn, wrapper);\n        this.on(event, wrapper, priority);\n        return () => this.off(event, fn);\n    }\n\n    /**\n     * Remove an event listener.\n     * @param event The event name.\n     * @param fn The listener function to remove.\n     */\n    off(event: string, fn: Function): void {\n        const list = this.listeners.get(event);\n        if (!list) return;\n        const wrapper = this.onceWrappers.get(fn) ?? fn;\n        this.listeners.set(event, list.filter(l => l.fn !== wrapper));\n\n        if (this.debugMode) {\n            console.debug(`[EventBus] Listener removed for event: ${event}`);\n        }\n    }\n\n    /**\n     * Check if there are listeners for a specific event.\n     * @param event The event name.\n     * @returns True if there are listeners, false otherwise.\n     */\n    hasListeners(event: string): boolean {\n        return event === \"any\"\n            ? this.anyListeners.length > 0\n            : (this.listeners.get(event)?.length ?? 0) > 0;\n    }\n\n    /**\n     * Register a listener for any event.\n     * @param fn The listener function.\n     * @param priority The priority of the listener.\n     * @returns A function to unsubscribe the listener.\n     */\n    onAny(fn: (event: string, payload: any) => any, priority = 0): UnsubscribeFn {\n        const listener: AnyListenerInterface = { fn, priority };\n        let i = this.anyListeners.length;\n        while (i > 0 && this.anyListeners[i - 1].priority < priority) i--;\n        this.anyListeners.splice(i, 0, listener);\n\n        if (this.debugMode) {\n            console.debug(\"[EventBus] Listener added for any event\", { priority });\n        }\n\n        return () => this.offAny(fn);\n    }\n\n    /**\n     * Remove a listener for any event.\n     * @param fn The listener function to remove.\n     */\n    offAny(fn: Function): void {\n        this.anyListeners = this.anyListeners.filter(l => l.fn !== fn);\n\n        if (this.debugMode) {\n            console.debug(\"[EventBus] Listener removed for any event\");\n        }\n    }\n\n    /**\n     * Emit an event to all registered listeners.\n     * @param event The event name.\n     * @param payload The event payload.\n     */\n    emit<T = any>(event: string, payload?: T): void {\n        if (!event) {\n            this._handleError(\"Event name is undefined or empty\", new Error());\n            return;\n        }\n\n        if (this.debugMode) {\n            console.debug(`[EventBus] Emitting event: ${event}`, payload);\n        }\n\n        const list = [...(this.listeners.get(event) ?? [])];\n        for (const l of list) {\n            try {\n                l.fn(payload);\n            } catch (err) {\n                this._handleError(`Error in listener for \"${event}\"`, err);\n            }\n        }\n\n        const anyList = [...this.anyListeners];\n        for (const l of anyList) {\n            try {\n                l.fn(event, payload);\n            } catch (err) {\n                this._handleError(`Error in any-listener for \"${event}\"`, err);\n            }\n        }\n    }\n\n    /**\n     * Emit an event asynchronously to all registered listeners.\n     * @param event The event name.\n     * @param payload The event payload.\n     * @returns A promise that resolves with the results of all listeners.\n     */\n    async emitAsync<T = any>(event: string, payload?: T): Promise<any[]> {\n        if (!event) {\n            this._handleError(\"Event name is undefined or empty\", new Error());\n            return [];\n        }\n\n        const results: any[] = [];\n        const list = [...(this.listeners.get(event) ?? [])];\n        for (const l of list) {\n            try {\n                results.push(await l.fn(payload));\n            } catch (err) {\n                this._handleError(`Async error in listener for \"${event}\"`, err);\n            }\n        }\n\n        const anyList = [...this.anyListeners];\n        for (const l of anyList) {\n            try {\n                results.push(await l.fn(event, payload));\n            } catch (err) {\n                this._handleError(`Async error in any-listener for \"${event}\"`, err);\n            }\n        }\n\n        return results;\n    }\n\n    /**\n     * Remove all listeners for a specific event or all events.\n     * @param event The event name. If omitted, all listeners are removed.\n     */\n    removeAllListeners(event?: string): void {\n        if (!event) {\n            this.listeners.clear();\n            this.anyListeners = [];\n        } else if (event === \"any\") {\n            this.anyListeners = [];\n        } else {\n            this.listeners.delete(event);\n        }\n\n        if (this.debugMode) {\n            console.debug(`[EventBus] All listeners removed for event: ${event ?? \"all\"}`);\n        }\n    }\n\n    /**\n     * Get the number of listeners for a specific event.\n     * @param event The event name.\n     * @returns The number of listeners.\n     */\n    listenerCount(event: string): number {\n        return event === \"any\"\n            ? this.anyListeners.length\n            : (this.listeners.get(event)?.length ?? 0);\n    }\n\n    /**\n     * Get the names of all events with registered listeners.\n     * @returns An array of event names.\n     */\n    eventNames(): string[] {\n        return Array.from(this.listeners.keys()).filter(event => (this.listeners.get(event)?.length ?? 0) > 0);\n    }\n\n    /**\n     * Get all listeners for a specific event.\n     * @param event The event name.\n     * @returns An array of listener functions.\n     */\n    getListeners(event: string): Function[] {\n        return event === \"any\"\n            ? this.anyListeners.map(l => l.fn)\n            : (this.listeners.get(event) ?? []).map(l => l.fn);\n    }\n\n    /**\n     * Handle errors during event emission.\n     * @param message The error message.\n     * @param error The error object.\n     */\n    private _handleError(message: string, error: any): void {\n        if (this.emittingError) return;\n        this.emittingError = true;\n\n        console.error(`[EventBus] ${message}`, error);\n\n        this.emittingError = false;\n    }\n}\n\nexport const eventBus = new EventBus();\n", "// src/spaceface/system/bin/EventWatcher.ts\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport { eventBus } from \"./EventBus.js\";\nimport type { LogPayload } from \"../types/bin.js\";\n\nexport abstract class EventWatcher {\n    protected readonly target: EventTarget;\n    protected readonly debug: boolean;\n    protected destroyed = false;\n\n    // DOM listeners storage (use Set to avoid duplicates)\n    private domListeners = new Set<{\n        type: string;\n        handler: EventListenerOrEventListenerObject;\n        options?: boolean | AddEventListenerOptions;\n    }>();\n\n    // To deduplicate log:debug messages\n    private loggedMessages = new Set<string>();\n\n    constructor(target: EventTarget, debug: boolean = false) {\n        // Use duck-typing so code runs in environments where EventTarget isn't constructible\n        if (!target || typeof (target as any).addEventListener !== \"function\" || typeof (target as any).removeEventListener !== \"function\") {\n            throw new Error(`${this.constructor.name}: target must be a valid EventTarget.`);\n        }\n        this.target = target;\n        this.debug = debug;\n    }\n\n    /**\n     * Centralized logging with support for debug mode.\n     */\n    protected log(levelOrMessage: 'debug' | 'info' | 'warn' | 'error' | string, messageOrData?: unknown, data?: unknown) {\n        // If first arg is a recognized level and second arg is a string -> new form\n        const levels = ['debug', 'info', 'warn', 'error'];\n        if (typeof levelOrMessage === 'string' && levels.includes(levelOrMessage) && typeof messageOrData === 'string') {\n            const level = levelOrMessage as 'debug' | 'info' | 'warn' | 'error';\n            const message = messageOrData as string;\n            const payload = data;\n            if (!this.debug && level === 'debug') return;\n            try {\n                const logPayload: LogPayload = {\n                    scope: this.constructor.name,\n                    level,\n                    message,\n                    data: payload,\n                    time: Date.now(),\n                };\n                eventBus.emit(\"log\", logPayload);\n            } catch (_) { /* ignore eventBus errors */ }\n            if (this.debug) {\n                const method = { debug: 'debug', info: 'info', warn: 'warn', error: 'error' }[level] ?? 'log';\n                (console as any)[method](`[${this.constructor.name}] [${level.toUpperCase()}]`, message, payload);\n            }\n            return;\n        }\n\n        // Backward-compatible form: log(message, data?)\n        const message = levelOrMessage as string;\n        const payload = messageOrData;\n        if (!this.debug) return;\n        let logKey: string;\n        try {\n            logKey = `${message}-${JSON.stringify(payload)}`;\n        } catch {\n            logKey = `${message}-[unserializable]`;\n        }\n        if (!this.loggedMessages.has(logKey)) {\n            this.loggedMessages.add(logKey);\n            try {\n                const sanitizedPayload = payload && typeof payload === 'object' ? JSON.parse(JSON.stringify(payload)) : payload;\n                const logPayload: LogPayload = {\n                    scope: this.constructor.name,\n                    level: 'debug',\n                    message,\n                    data: sanitizedPayload,\n                    time: Date.now(),\n                };\n                eventBus.emit(\"log:debug\", logPayload);\n            } catch (error) {\n                console.warn(\"Failed to log debug event\", { message, payload, error });\n            }\n        }\n        (console as any).debug?.(`[${this.constructor.name}] [DEBUG]`, message, payload);\n    }\n\n    protected checkDestroyed() {\n        if (this.destroyed) {\n            throw new Error(`${this.constructor.name} has been destroyed.`);\n        }\n    }\n\n    public destroy() {\n        if (this.destroyed) return;\n        this.log('info', \"Destroying watcher\");\n        try {\n            this.removeAllDomListeners();\n            this.removeEventListeners();\n        } catch (err) {\n            // ensure we mark destroyed and surface debug info without throwing\n            this.log('error', \"Error while destroying watcher\", err);\n        } finally {\n            this.destroyed = true;\n        }\n    }\n\n    /**\n     * Add a DOM listener and store it for later removal.\n     */\n    protected addDomListener(type: string, handler: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions) {\n        if (this.destroyed) return;\n        this.target.addEventListener(type, handler, options);\n        this.domListeners.add({ type, handler, options });\n        if (this.debug) {\n            this.log('debug', `Added DOM listener`, { type, handler, options });\n        }\n    }\n\n    /**\n     * Remove all stored DOM listeners.\n     */\n    protected removeAllDomListeners() {\n        for (const { type, handler, options } of this.domListeners) {\n            try {\n                this.target.removeEventListener(type, handler, options as any);\n                if (this.debug) {\n                    this.log('debug', `Removed DOM listener`, { type, handler });\n                }\n            } catch (e) {\n                this.log('warn', `Failed to remove DOM listener`, { type, handler, error: e });\n            }\n        }\n        this.domListeners.clear();\n    }\n\n    /** Must be implemented by subclasses */\n    protected abstract addEventListeners(): void;\n    protected abstract removeEventListeners(): void;\n}\n", "// src/spaceface/system/features/bin/timing.ts\n\nexport const VERSION = 'nextworld-1.3.0' as const;\n\n/** Generic type: function with cancel method */\nexport type CancellableFunction<T extends (...args: any[]) => void> = T & { cancel: () => void };\n\n/** Internal helper: manages a timeout with cancel support */\nfunction createTimeout(): { id: number | null; set: (fn: () => void, ms: number) => void; cancel: () => void } {\n  let id: number | null = null;\n\n  return {\n    get id() { return id; },\n    set(fn: () => void, ms: number) {\n      if (id !== null) clearTimeout(id);\n      id = window.setTimeout(() => {\n        id = null;\n        fn();\n      }, ms);\n    },\n    cancel() {\n      if (id !== null) {\n        clearTimeout(id);\n        id = null;\n      }\n    },\n  };\n}\n\n/**\n * Creates a debounced function that delays invoking `func` until after `delay` ms\n * have elapsed since the last call. Includes error handling for invalid inputs.\n *\n * @param func - The function to debounce.\n * @param delay - The number of milliseconds to delay.\n * @param immediate - If `true`, trigger the function on the leading edge.\n * @returns A debounced function with a `cancel` method.\n */\nexport function debounce<T extends (...args: any[]) => void>(\n  func: T,\n  delay = 300,\n  immediate = false\n): CancellableFunction<(...args: Parameters<T>) => void> {\n  if (typeof func !== 'function') {\n    throw new TypeError('Expected a function for debounce');\n  }\n  if (typeof delay !== 'number' || delay < 0) {\n    throw new TypeError('Expected a non-negative number for delay');\n  }\n\n  const timer = createTimeout();\n\n  function debounced(this: ThisParameterType<T>, ...args: Parameters<T>) {\n    const callNow = immediate && timer.id === null;\n\n    timer.set(() => {\n      if (!immediate) func.apply(this, args);\n    }, delay);\n\n    if (callNow) func.apply(this, args);\n  }\n\n  debounced.cancel = () => timer.cancel();\n\n  return debounced;\n}\n\n/**\n * Creates a throttled function that invokes `func` at most once per `delay` ms.\n * Includes error handling for invalid inputs.\n *\n * @param func - The function to throttle.\n * @param delay - The number of milliseconds to throttle calls.\n * @param options - Options to control leading and trailing edge calls.\n * @returns A throttled function with a `cancel` method.\n */\nexport function throttle<T extends (...args: any[]) => void>(\n  func: T,\n  delay = 100,\n  options: { leading?: boolean; trailing?: boolean } = {}\n): CancellableFunction<(...args: Parameters<T>) => void> {\n  if (typeof func !== 'function') {\n    throw new TypeError('Expected a function for throttle');\n  }\n  if (typeof delay !== 'number' || delay < 0) {\n    throw new TypeError('Expected a non-negative number for delay');\n  }\n\n  const { leading = true, trailing = true } = options;\n  let lastCall = 0;\n  let lastArgs: Parameters<T> | null = null;\n  let lastThis: ThisParameterType<T> | null = null;\n  const timer = createTimeout();\n\n  function invoke() {\n    lastCall = leading ? Date.now() : 0;\n    func.apply(lastThis!, lastArgs!);\n    lastArgs = lastThis = null;\n  }\n\n  function throttled(this: ThisParameterType<T>, ...args: Parameters<T>) {\n    const now = Date.now();\n    if (lastCall === 0 && !leading) lastCall = now;\n\n    lastArgs = args;\n    lastThis = this;\n\n    const remaining = delay - (now - lastCall);\n\n    if (remaining <= 0 || remaining > delay) {\n      timer.cancel();\n      invoke();\n    } else if (timer.id === null && trailing) {\n      timer.set(() => {\n        if (trailing && lastArgs) invoke();\n      }, remaining);\n    }\n  }\n\n  throttled.cancel = () => {\n    timer.cancel();\n    lastCall = 0;\n    lastArgs = lastThis = null;\n  };\n\n  return throttled;\n}\n", "// src/spaceface/system/bin/InactivityWatcher.ts\n\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport { EventWatcher } from './EventWatcher.js';\nimport { eventBus } from './EventBus.js';\nimport { throttle } from '../features/bin/timing.js';\n\nexport interface InactivityWatcherOptionsInterface {\n    inactivityDelay: number;\n    debug?: boolean;\n    target?: EventTarget;\n}\n\nexport class InactivityWatcher extends EventWatcher {\n    private static _instance: InactivityWatcher | null = null;\n\n    private inactivityDelay: number;\n    private lastActiveAt: number;\n    private timer?: number;\n    private userIsInactive: boolean = false;\n    private throttledReset: () => void;\n\n    /**\n     * Private constructor to enforce singleton pattern.\n     * @param target The target to monitor for activity.\n     * @param options Configuration options for the watcher.\n     */\n    private constructor(target: EventTarget, options: InactivityWatcherOptionsInterface) {\n        super(target, options.debug ?? false);\n        this.inactivityDelay = options.inactivityDelay;\n        this.lastActiveAt = Date.now();\n        this.throttledReset = throttle(() => this.resetTimer(), 200);\n\n        this.log(`Initialized with inactivityDelay=${this.inactivityDelay}ms`);\n        this.addEventListeners();\n    }\n\n    /**\n     * Get the singleton instance of the InactivityWatcher.\n     * @param options Configuration options for the watcher.\n     * @returns The singleton instance.\n     */\n    static getInstance(options: InactivityWatcherOptionsInterface): InactivityWatcher {\n        if (!this._instance) {\n            this._instance = new InactivityWatcher(options.target ?? document, options);\n        }\n        return this._instance;\n    }\n\n    /**\n     * Add event listeners to monitor user activity.\n     */\n    protected addEventListeners(): void {\n        this.addDomListener('mousemove', this.throttledReset);\n        this.addDomListener('keydown', this.throttledReset);\n        this.addDomListener('scroll', this.throttledReset);\n        this.addDomListener('visibilitychange', this.throttledReset);\n\n        this.resetTimer();\n    }\n\n    /**\n     * Remove all event listeners and clear the timer.\n     */\n    protected removeEventListeners(): void {\n        this.removeAllDomListeners();\n\n        if (this.timer) {\n            clearTimeout(this.timer);\n            this.timer = undefined;\n        }\n    }\n\n    /**\n     * Reset the inactivity timer and emit an active event if the user was inactive.\n     */\n    private resetTimer(): void {\n        const now = Date.now();\n        this.lastActiveAt = now;\n\n        if (this.userIsInactive) {\n            this.userIsInactive = false;\n            eventBus.emit('user:active', {\n                lastActiveAt: this.lastActiveAt,\n                inactivityDelay: this.inactivityDelay,\n                visible: document.visibilityState === 'visible',\n            });\n            this.log('User is active');\n        }\n\n        if (this.timer) clearTimeout(this.timer);\n        this.timer = window.setTimeout(() => this.setInactive(), this.inactivityDelay);\n    }\n\n    /**\n     * Mark the user as inactive and emit an inactive event.\n     */\n    private setInactive(): void {\n        this.userIsInactive = true;\n        const now = Date.now();\n        eventBus.emit('user:inactive', {\n            lastActiveAt: this.lastActiveAt,\n            inactiveAt: now,\n            inactivityDelay: this.inactivityDelay,\n            visible: document.visibilityState === 'visible',\n        });\n        this.log('User is inactive');\n    }\n}\n", "// src/system/bin/EventLogger.ts\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport { eventBus } from '../bin/EventBus.js';\n\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error' | 'event';\n\nexport interface LogEntry {\n  level: LogLevel;\n  scope: string;\n  message: string;\n  data?: any;\n  time: number;\n}\n\nexport class EventLogger {\n  private scope: string;\n  private devMode: boolean;\n  private fallbackLogs: LogEntry[] = []; // Fallback storage for logs\n\n  constructor(scope: string, devMode: boolean = true) {\n    this.scope = scope;\n    this.devMode = devMode;\n  }\n\n  /**\n   * Filters logs based on the configured log level.\n   * Suppresses logs below the specified level in production.\n   */\n  private shouldLog(level: LogLevel): boolean {\n    const levels = ['debug', 'info', 'event', 'warn', 'error'];\n    const currentLevelIndex = levels.indexOf(this.devMode ? 'debug' : 'warn');\n    const logLevelIndex = levels.indexOf(level);\n    return logLevelIndex >= currentLevelIndex;\n  }\n\n  /**\n   * Log a message with the specified level.\n   * @param level The log level (e.g., debug, info, warn, error).\n   * @param message The log message.\n   * @param data Optional additional data to log.\n   */\n  private log(level: LogLevel, message: string, data?: any) {\n    if (!this.shouldLog(level)) return;\n\n    const entry: LogEntry = {\n      level,\n      scope: this.scope,\n      message,\n      data,\n      time: Date.now()\n    };\n\n    try {\n      // Attempt to emit structured log event\n      eventBus.emit('log', entry);\n    } catch (error) {\n      // Fallback to in-memory storage if eventBus fails\n      this.fallbackLogs.push(entry);\n      if (this.devMode) {\n        console.error(`[EventLogger][ERROR] Failed to emit log event`, { entry, error });\n      }\n    }\n\n    // Console output only in devMode (except errors are always useful in dev)\n    if (this.devMode) {\n      console.debug(`[EventLogger][DEBUG] Logging to console`, { level, message, data }); // Debug log for visibility\n      this.consoleOutput(level, message, data);\n    }\n  }\n\n  /**\n   * Output log to the console based on the log level.\n   * @param level The log level.\n   * @param message The log message.\n   * @param data Optional additional data to log.\n   */\n  private consoleOutput(level: LogLevel, message: string, data?: any) {\n    let method: 'log' | 'warn' | 'error';\n    switch (level) {\n      case 'warn': method = 'warn'; break;\n      case 'error': method = 'error'; break;\n      default: method = 'log'; // debug, info, event \u2192 log\n    }\n\n    const prefix = `[${this.scope}][${level.toUpperCase()}]`;\n    if (data !== undefined) {\n      console[method](prefix, message, data);\n    } else {\n      console[method](prefix, message);\n    }\n  }\n\n  /**\n   * Retrieve fallback logs stored in memory.\n   * @returns An array of fallback log entries.\n   */\n  getFallbackLogs(): LogEntry[] {\n    return this.fallbackLogs;\n  }\n\n  debug(msg: string, data?: any) { this.log('debug', msg, data); }\n  info(msg: string, data?: any) { this.log('info', msg, data); }\n  warn(msg: string, data?: any) { this.log('warn', msg, data); }\n  event(msg: string, data?: any) { this.log('event', msg, data); }\n  error(msg: string, data?: any) { this.log('error', msg, data); }\n}\n", "// src/spaceface/system/bin/EventBinder.ts\n\n/**\n * EventBinder v1.2.2\n *\n * Manages the lifecycle of EventBus and DOM event bindings with\n * support for auto-unbinding, debugging, and scoped lifetimes.\n *\n * Provides a single utility class for safely attaching and\n * detaching event handlers in a structured way.\n */\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport {\n  DomBinding,\n  EventBinderStats,\n  EventBinderInterface,\n  BusBindingInterface\n} from \"../types/bin.js\";\n\nimport { eventBus } from \"./EventBus.js\";\nimport { EventLogger } from \"./EventLogger.js\";\n\ninterface IEventBinderDebugPayload {\n  method: string;\n  details: unknown;\n}\n\n/**\n * EventBinder\n *\n * A utility for managing event bindings across EventBus and DOM.\n * Keeps track of all active bindings and supports automatic cleanup.\n */\nexport class EventBinder implements EventBinderInterface {\n  private IBusBindings: BusBindingInterface[] = [];\n  private domBindings: DomBinding[] = [];\n  private debugMode: boolean;\n  private logger: EventLogger;\n\n  /**\n   * Create a new EventBinder.\n   * @param debug Enable debug logging (emits `debug:EventBinder` events)\n   */\n  constructor(debug = false) {\n    this.debugMode = debug;\n    this.logger = new EventLogger(\"eventbinder\");\n  }\n\n  /**\n   * Emit debug info via EventBus if debug mode is enabled.\n   * @param method The method name where the debug is called.\n   * @param details Additional details to log.\n   */\n  private debug(method: string, details: unknown): void {\n    if (!this.debugMode) return;\n    try {\n      const payload: IEventBinderDebugPayload = { method, details };\n      this.logger.debug(method, payload);\n    } catch (error) {\n      console.error(`Debugging failed in method: ${method}`, error);\n    }\n  }\n\n  /**\n   * Attach binder lifetime to an AbortSignal.\n   * All bindings will be unbound automatically when the signal aborts.\n   * @param signal AbortSignal to link binder lifetime to.\n   * @returns Unsubscribe function that removes the abort listener.\n   */\n  attachTo(signal: AbortSignal): () => void {\n    if (signal.aborted) {\n      this.unbindAll();\n      return () => {};\n    }\n    const listener = () => this.unbindAll();\n    signal.addEventListener(\"abort\", listener, { once: true });\n    // return an unsubscribe so callers (eg tests) can remove the attachment without aborting the signal\n    return () => {\n      try {\n        signal.removeEventListener(\"abort\", listener);\n      } catch (error) {\n        console.warn(\"Failed to remove abort listener\", error);\n      }\n    };\n  }\n\n  /**\n   * Toggle debug mode at runtime.\n   * @param enable Set to true to enable debug mode, false to disable.\n   */\n  public setDebugMode(enable: boolean): void {\n    this.debugMode = enable;\n    this.logger.info(`Debug mode ${enable ? 'enabled' : 'disabled'}`);\n  }\n\n  /**\n   * Bind a handler to an EventBus event.\n   * @param event Event name\n   * @param handler Event handler function\n   */\n  bindBus(event: string, handler: (...args: any[]) => void): void {\n    if (this.IBusBindings.find(b => b.event === event && b.handler === handler)) {\n      this.debug(\"bus:bind:duplicate\", { event, handler });\n      return;\n    }\n    try {\n      const unsubscribe = eventBus.on(event, handler);\n      this.IBusBindings.push({ event, handler, unsubscribe });\n      this.debug(\"bus:bind\", { event, handler });\n    } catch (err) {\n      this.logger.error(`Failed to bind bus event \"${event}\": ${err instanceof Error ? err.message : String(err)}`);\n    }\n  }\n\n  /**\n   * Bind a DOM event handler with automatic tracking and unbind support.\n   * @param target Target element or EventTarget\n   * @param event Event name\n   * @param handler Event listener\n   * @param options Optional event listener options\n   */\n  bindDOM(\n    target: EventTarget,\n    event: string,\n    handler: EventListenerOrEventListenerObject,\n    options: AddEventListenerOptions | boolean = false\n  ): void {\n    // Duck-typing check so this works in non-browser/test runtimes where EventTarget instanceof may fail\n    if (!target || typeof (target as any).addEventListener !== \"function\" || typeof (target as any).removeEventListener !== \"function\") {\n      this.logger.warn(`Invalid DOM target for bindDOM: ${String(target)}`);\n      return;\n    }\n\n    const controller = new AbortController();\n    const normalizedOptions: AddEventListenerOptions =\n      typeof options === \"boolean\"\n        ? { capture: options, signal: controller.signal }\n        : { ...options, signal: controller.signal };\n\n    // simple options equality (compare capture/passive/once) to avoid duplicate bindings with identical semantics\n    const optionsEqual = (a?: AddEventListenerOptions, b?: AddEventListenerOptions) =>\n      (!!a === !!b) &&\n      ((a?.capture ?? false) === (b?.capture ?? false)) &&\n      ((a?.passive ?? false) === (b?.passive ?? false)) &&\n      ((a?.once ?? false) === (b?.once ?? false));\n\n    if (this.domBindings.find(b => b.target === target && b.event === event && b.handler === handler && optionsEqual(b.options, normalizedOptions))) {\n      this.debug(\"dom:bind:duplicate\", { event, handler, target, options: normalizedOptions });\n      return;\n    }\n\n    try {\n      (target as EventTarget).addEventListener(event, handler, normalizedOptions);\n      this.domBindings.push({ target, event, handler, options: normalizedOptions, controller });\n      this.debug(\"dom:bind\", { event, handler, target, options: normalizedOptions });\n    } catch (err) {\n      this.logger.error(`Failed to bind DOM event \"${event}\": ${err instanceof Error ? err.message : String(err)}`);\n    }\n  }\n\n  /**\n   * Unbind all EventBus and DOM event handlers managed by this binder.\n   */\n  unbindAll(): void {\n    this.debug(\"unbindAll\", {\n      bus: this.IBusBindings.length,\n      dom: this.domBindings.length,\n    });\n\n    for (const b of this.IBusBindings) {\n      try {\n        b.unsubscribe();\n        this.debug(\"bus:unbind\", { event: b.event });\n      } catch (err) {\n        this.logger.error(`Failed to unbind bus \"${b.event}\": ${err instanceof Error ? err.message : String(err)}`);\n      }\n    }\n\n    for (const b of this.domBindings) {\n      try {\n        b.controller.abort();\n        this.debug(\"dom:unbind\", { event: b.event, target: b.target });\n      } catch (err) {\n        this.logger.error(`Failed to unbind DOM \"${b.event}\": ${err instanceof Error ? err.message : String(err)}`);\n      }\n    }\n\n    this.IBusBindings = [];\n    this.domBindings = [];\n  }\n\n  /**\n   * Unbind a specific EventBus handler.\n   * @param event Event name\n   * @param handler Event handler\n   * @returns True if successfully unbound, false otherwise\n   */\n  unbindBus(event: string, handler: (...args: any[]) => void): boolean {\n    const i = this.IBusBindings.findIndex(b => b.event === event && b.handler === handler);\n    if (i === -1) return false;\n\n    try {\n      this.IBusBindings[i].unsubscribe();\n      this.IBusBindings.splice(i, 1);\n      this.debug(\"bus:unbind:single\", { event, handler });\n      return true;\n    } catch (err) {\n      this.logger.error(`Failed to unbind bus \"${event}\": ${err instanceof Error ? err.message : String(err)}`);\n      return false;\n    }\n  }\n\n  /**\n   * Unbind a specific DOM event handler.\n   * @param target Target element\n   * @param event Event name\n   * @param handler Event listener\n   * @returns True if successfully unbound, false otherwise\n   */\n  unbindDOM(target: EventTarget, event: string, handler: EventListenerOrEventListenerObject): boolean {\n    const i = this.domBindings.findIndex(b => b.target === target && b.event === event && b.handler === handler);\n    if (i === -1) return false;\n\n    try {\n      this.domBindings[i].controller.abort();\n      this.domBindings.splice(i, 1);\n      this.debug(\"dom:unbind:single\", { event, target });\n      return true;\n    } catch (err) {\n      this.logger.error(`Failed to unbind DOM \"${event}\": ${err instanceof Error ? err.message : String(err)}`);\n      return false;\n    }\n  }\n\n  /**\n   * Get binding statistics.\n   * @returns Number of bus and DOM events currently bound\n   */\n  getStats(): EventBinderStats {\n    return {\n      busEvents: this.IBusBindings.length,\n      domEvents: this.domBindings.length,\n      totalEvents: this.IBusBindings.length + this.domBindings.length,\n    };\n  }\n\n  /**\n   * Check if there are any active bindings.\n   * @returns True if any EventBus or DOM bindings exist\n   */\n  hasBindings(): boolean {\n    return this.IBusBindings.length > 0 || this.domBindings.length > 0;\n  }\n\n  /**\n   * Get details of all active bindings.\n   * @returns Object with arrays of bus and DOM binding info\n   */\n  getBindingDetails(): { bus: string[]; dom: string[] } {\n    return {\n      bus: this.IBusBindings.map(b => b.event),\n      dom: this.domBindings.map(b => `${b.event}@${b.target.constructor.name}`),\n    };\n  }\n\n  /**\n   * Utility wrapper for scoped binding lifetimes.\n   * Automatically unbinds after callback execution (sync or async).\n   *\n   * @param callback Function that receives a temporary EventBinder\n   * @param debug Enable debug mode\n   * @returns The callback result\n   */\n  static withAutoUnbind<T>(\n    callback: (binder: EventBinder) => T | Promise<T>,\n    debug = false\n  ): Promise<T> | T {\n    const binder = new EventBinder(debug);\n    try {\n      const result = callback(binder);\n      if (result instanceof Promise) {\n        return result.finally(() => binder.unbindAll());\n      } else {\n        binder.unbindAll();\n        return result;\n      }\n    } catch (err) {\n      binder.unbindAll();\n      throw err;\n    }\n  }\n}\n\n/** Default shared EventBinder instance */\nexport const eventBinder = new EventBinder();\n", "// src/spaceface/system/bin/PartialLoader.ts\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport { debounce } from \"../features/bin/timing.js\";\nimport { eventBus } from \"./EventBus.js\";\n\nimport {\n    PartialLoaderOptionsInterface,\n    PartialLoadResultInterface,\n    PartialInfoInterface,\n    PartialEventPayload,\n    LogPayload\n} from \"../types/bin.js\";\n\nexport class PartialLoader {\n    private cache = new Map<string, string>();\n    private loadingPromises = new Map<string, Promise<string>>();\n    private loadedPartials = new Map<string, boolean>();\n    private options: Required<PartialLoaderOptionsInterface>;\n\n    constructor(options: PartialLoaderOptionsInterface = {}) {\n        this.options = {\n            debug: false,\n            baseUrl: \"/\",\n            cacheEnabled: true,\n            timeout: 10000,\n            retryAttempts: 3,\n            ...options,\n        };\n    }\n\n    /** Emit debug events instead of console.debug */\n    private logDebug(msg: string, data?: unknown) {\n        if (this.options.debug) {\n            const logKey = `${msg}-${JSON.stringify(data)}`;\n            if (!this.loadedPartials.has(logKey)) {\n                this.loadedPartials.set(logKey, true);\n                const payload: LogPayload = {\n                    scope: \"PartialLoader\",\n                    level: \"debug\",\n                    message: msg,\n                    data,\n                    time: Date.now(),\n                };\n                eventBus.emit(\"log:debug\", payload);\n                eventBus.emit(\"log\", payload);\n            }\n        }\n    }\n\n    /** Load partials from links or info objects */\n    async load(\n        input: HTMLLinkElement | PartialInfoInterface | (HTMLLinkElement | PartialInfoInterface)[]\n    ): Promise<PartialLoadResultInterface[]> {\n        const items = Array.isArray(input) ? input : [input];\n        const results: PartialLoadResultInterface[] = [];\n\n        for (const item of items) {\n            try {\n                if (item instanceof HTMLLinkElement) {\n                    results.push(await this.loadLink(item));\n                } else {\n                    results.push(await this.loadInfo(item));\n                }\n            } catch (error) {\n                const url = item instanceof HTMLLinkElement\n                    ? item.getAttribute(\"src\") || \"\"\n                    : item.url;\n                this.logDebug(\"Failed to load partial\", { url, error });\n                results.push({ success: false, url, cached: false });\n            }\n        }\n\n        eventBus.emit<PartialEventPayload>(\"partials:allLoaded\", { url: \"\", cached: false });\n        this.logDebug(\"All partials loaded\", { count: results.length });\n        return results;\n    }\n\n    private loadLink(link: HTMLLinkElement) {\n        const src = link.getAttribute(\"src\");\n        if (!src) throw new Error(\"Partial link missing src\");\n        return this.loadUrl(this.resolveUrl(src), link);\n    }\n\n    private loadInfo(info: PartialInfoInterface) {\n        return this.loadUrl(this.resolveUrl(info.url), info.container, info.id);\n    }\n\n    private async loadUrl(url: string, container: Element | ParentNode, id?: string): Promise<PartialLoadResultInterface> {\n        try {\n            if (this.options.cacheEnabled && this.cache.has(url)) {\n                this.insertHTML(container, this.cache.get(url)!);\n                this.loadedPartials.set(id || url, true);\n\n                eventBus.emit<PartialEventPayload>(\"partial:loaded\", { url, html: this.cache.get(url)!, cached: true });\n                this.logDebug(\"Partial loaded from cache\", { url, id });\n                return { success: true, url, cached: true };\n            }\n\n            let fetchPromise = this.loadingPromises.get(url);\n            if (!fetchPromise) {\n                fetchPromise = this.fetchWithRetry(url);\n                this.loadingPromises.set(url, fetchPromise);\n            }\n\n            const html = await fetchPromise;\n            if (this.options.cacheEnabled) this.cache.set(url, html);\n\n            this.insertHTML(container, html);\n            this.loadedPartials.set(id || url, true);\n\n            eventBus.emit<PartialEventPayload>(\"partial:loaded\", { url, html, cached: false });\n            this.logDebug(\"Partial loaded\", { url, id });\n            return { success: true, url, cached: false };\n        } catch (error) {\n            this.showError(container, error as Error);\n            eventBus.emit<PartialEventPayload>(\"partial:error\", { url, error });\n            this.logDebug(\"Partial load failed\", { url, id, error });\n            throw error;\n        } finally {\n            this.loadingPromises.delete(url);\n            eventBus.emit<PartialEventPayload>(\"partial:load:complete\", { url });\n            this.logDebug(\"Partial load complete\", { url, id });\n        }\n    }\n\n    private async fetchWithRetry(url: string, attempt = 1): Promise<string> {\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), this.options.timeout);\n\n        try {\n            const res = await fetch(url, { signal: controller.signal, headers: { Accept: \"text/html\" } });\n            if (!res.ok) throw new Error(`HTTP ${res.status}`);\n            const html = (await res.text()).trim();\n            if (!html) throw new Error(\"Empty response\");\n            return html;\n        } catch (err) {\n            if (attempt < this.options.retryAttempts) {\n                this.logDebug(\"Retrying fetch\", { url, attempt });\n                await this.delay(Math.min(2 ** attempt * 100, 5000));\n                return this.fetchWithRetry(url, attempt + 1);\n            }\n            throw err;\n        } finally {\n            clearTimeout(timeoutId);\n        }\n    }\n\n    private async fetchPartial(url: string, attempt = 1): Promise<string> {\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), this.options.timeout);\n\n        try {\n            const res = await fetch(url, { signal: controller.signal, headers: { Accept: \"text/html\" } });\n            if (!res.ok) throw new Error(`HTTP ${res.status}`);\n            const html = (await res.text()).trim();\n            if (!html) throw new Error(\"Empty response\");\n            return html;\n        } catch (err) {\n            if (attempt < this.options.retryAttempts) {\n                this.logDebug(\"Retrying fetch\", { url, attempt });\n                await this.delay(Math.min(2 ** attempt * 100, 5000));\n                return this.fetchPartial(url, attempt + 1);\n            }\n            throw err;\n        } finally {\n            clearTimeout(timeoutId);\n        }\n    }\n\n    private insertHTML(container: ParentNode | Element, html: string) {\n        const template = document.createElement(\"template\");\n        template.innerHTML = html;\n\n        if (container instanceof HTMLLinkElement) {\n            container.replaceWith(...template.content.childNodes);\n        } else if (container instanceof Element) {\n            container.innerHTML = \"\";\n            container.append(...template.content.childNodes);\n        } else {\n            container.append(...template.content.childNodes);\n        }\n\n        this.logDebug(\"Inserted HTML into container\", { container });\n    }\n\n    private showError(container: ParentNode | Element, error: Error) {\n        const div = document.createElement(\"div\");\n        div.className = \"partial-error\";\n        div.textContent = \"Partial load failed\";\n        if (this.options.debug) div.textContent += `: ${error.message}`;\n\n        if (container instanceof HTMLLinkElement) {\n            container.replaceWith(div);\n        } else if (container instanceof Element) {\n            container.innerHTML = \"\";\n            container.appendChild(div);\n        } else {\n            container.appendChild(div);\n        }\n\n        eventBus.emit(\"log:error\", {\n            scope: \"PartialLoader\",\n            message: \"Partial load failed\",\n            error,\n            context: {\n                url: container instanceof HTMLLinkElement ? container.href : undefined,\n                retryAttempts: this.options.retryAttempts,\n            },\n        });\n        this.logDebug(\"Error displayed in container\", { container, error });\n    }\n\n    isPartialLoaded(id: string) {\n        return this.loadedPartials.has(id);\n    }\n\n    private resolveUrl(src: string): string {\n        if (/^[a-zA-Z][a-zA-Z\\d+\\-.]*:/.test(src) || src.startsWith(\"//\")) {\n            this.logDebug(\"URL is already absolute\", { src });\n            return src;\n        }\n\n        try {\n            const base = this.options.baseUrl || window.location.origin + \"/\";\n            const url = new URL(src, base).toString();\n            const resolvedUrl = url.startsWith(window.location.origin)\n                ? url.slice(window.location.origin.length) || \"/\"\n                : url;\n            this.logDebug(\"Resolved relative URL\", { src, resolvedUrl });\n            return resolvedUrl;\n        } catch (error) {\n            this.logDebug(\"Failed to resolve URL\", { src, error });\n            return src;\n        }\n    }\n\n    private delay(ms: number): Promise<void> {\n        this.logDebug(\"Delaying execution\", { ms });\n        return new Promise(resolve => setTimeout(resolve, ms));\n    }\n\n    async loadContainer(container: ParentNode = document): Promise<PartialLoadResultInterface[]> {\n        const links = container.querySelectorAll<HTMLLinkElement>('link[rel=\"partial\"][src]');\n        if (!links.length) return [];\n        return this.load(Array.from(links));\n    }\n\n    watch(container: HTMLElement | Document = document.body) {\n        if (!window.MutationObserver) return;\n        const observer = new MutationObserver(\n            debounce(() => this.loadContainer(container), 100)\n        );\n        observer.observe(container, { childList: true, subtree: true });\n        this.logDebug(\"Watching container for partials\", { container });\n        return observer;\n    }\n\n    /** Exposed method so PartialFetcher can reuse loader's cache + retry */\n    async fetchWithLoaderCache(url: string): Promise<string> {\n        if (this.options.cacheEnabled && this.cache.has(url)) {\n            this.logDebug(\"Fetching from cache\", { url });\n            return this.cache.get(url)!;\n        }\n        const html = await this.fetchPartial(url);\n        if (this.options.cacheEnabled) this.cache.set(url, html);\n        this.logDebug(\"Fetched and cached partial\", { url });\n        return html;\n    }\n}\n", "// src/system/bin/PartialFetcher.ts\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport { eventBus } from \"./EventBus.js\";\nimport { PartialLoader } from \"./PartialLoader.js\";\nimport type { PartialFetchOptionsInterface, PartialEventPayload, PartialLoaderLike, LogPayload } from \"../types/bin.js\";\n\nexport class PartialFetcher {\n    /** Default internal loader instance */\n    private static loader: PartialLoaderLike;\n\n    /**\n     * Get or create the default loader instance.\n     * @returns The default loader instance.\n     */\n    private static getLoader(): PartialLoaderLike {\n        return this.loader ?? (this.loader = new PartialLoader());\n    }\n\n    /**\n     * Emit debug logs via EventBus.\n     * @param message The debug message.\n     * @param data Additional data to log.\n     */\n    private static logDebug(message: string, data?: unknown): void {\n        const payload: LogPayload = {\n            scope: \"PartialFetcher\",\n            level: \"debug\",\n            message,\n            data,\n            time: Date.now(),\n        };\n        eventBus.emit(\"log\", payload);\n    }\n\n    /**\n     * Load a partial HTML into a target container.\n     * @param url The URL of the partial to load.\n     * @param targetSelector The CSS selector of the target container.\n     * @param options Additional options for the loader.\n     */\n    static async load(\n        url: string,\n        targetSelector: string,\n        options: PartialFetchOptionsInterface = {}\n    ): Promise<void> {\n        const loader = options.loader ?? this.getLoader();\n        const container = document.querySelector<HTMLElement>(targetSelector);\n        if (!container) throw new Error(`Target ${targetSelector} not found`);\n\n        try {\n            this.logDebug(\"Fetching partial\", { url, targetSelector });\n            await loader.load([{ url, container }]);\n            eventBus.emit<PartialEventPayload>(\"partial:loaded\", { url, targetSelector, cached: false });\n            this.logDebug(\"Partial loaded successfully\", { url, targetSelector });\n        } catch (error) {\n            eventBus.emit<PartialEventPayload>(\"partial:error\", { url, error });\n            this.logDebug(\"Partial load error\", { url, error });\n            throw error;\n        } finally {\n            eventBus.emit<PartialEventPayload>(\"partial:load:complete\", { url, targetSelector, error: false });\n        }\n    }\n\n    /**\n     * Preload multiple partials without rendering them.\n     * @param urls The URLs of the partials to preload.\n     * @param loader Optional custom loader instance.\n     * @returns A promise that resolves when all partials are preloaded.\n     */\n    static async preload(urls: string[], loader?: PartialLoaderLike): Promise<void[]> {\n        const activeLoader = loader ?? this.getLoader();\n        const dummyContainer = document.createElement(\"div\");\n\n        return Promise.all(\n            urls.map(async (url) => {\n                try {\n                    this.logDebug(\"Preloading partial\", { url });\n                    await activeLoader.load([{ url, container: dummyContainer }]);\n                    eventBus.emit<PartialEventPayload>(\"partial:loaded\", { url, cached: true });\n                } catch (error) {\n                    eventBus.emit<PartialEventPayload>(\"partial:error\", { url, error });\n                    this.logDebug(\"Preload error\", { url, error });\n                } finally {\n                    eventBus.emit<PartialEventPayload>(\"partial:load:complete\", { url, error: false });\n                }\n            })\n        );\n    }\n\n    /**\n     * Watch a container for dynamic partial loading.\n     * @param container The container to watch.\n     * @param loader Optional custom loader instance.\n     * @returns The result of the loader's watch method.\n     */\n    static watch(container: HTMLElement | Document = document.body, loader?: PartialLoaderLike): unknown {\n        const activeLoader = loader ?? this.getLoader();\n        this.logDebug(\"Watching container for partials\", { container });\n        return activeLoader.watch?.(container);\n    }\n}\n", "// src/spaceface/system/bin/ServiceWorkerManager.ts\n\nexport const VERSION = 'nextworld-1.0.0' as const;\nexport class ServiceWorkerManager {\n  private swPath: string;\n  private options: RegistrationOptions;\n  private customConfig: Record<string, any>;\n  private registration: ServiceWorkerRegistration | null = null;\n  private isSupported: boolean;\n\n  constructor(\n    swPath: string = '/sw.js',\n    options: RegistrationOptions = {},\n    customConfig: Record<string, any> = {}\n  ) {\n    this.swPath = swPath;\n    this.options = {\n      scope: '/',\n      updateViaCache: 'none',\n      ...options,\n    };\n    this.customConfig = customConfig;\n    this.isSupported = 'serviceWorker' in navigator;\n  }\n\n  /**\n   * Register the service worker\n   */\n  public async register(): Promise<ServiceWorkerRegistration | null> {\n    if (!this.isSupported) {\n      throw new Error('ServiceWorker not supported');\n    }\n\n    try {\n      this.registration = await navigator.serviceWorker.register(\n        this.swPath,\n        this.options\n      );\n\n      this.setupEventListeners();\n      return this.registration;\n    } catch (error) {\n      console.error('SW registration failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Apply custom configuration after registration\n   */\n  public configure(): void {\n    if (this.customConfig.strategy) {\n      this.setStrategy(this.customConfig.strategy);\n    }\n  }\n\n  /**\n   * Unregister the service worker\n   */\n  public async unregister(): Promise<boolean> {\n    if (!this.registration) return false;\n\n    try {\n      return await this.registration.unregister();\n    } catch (error) {\n      console.error('SW unregistration failed:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Update the service worker\n   */\n  public async update(): Promise<void | null> {\n    if (!this.registration) return null;\n\n    try {\n      // registration.update() returns void\n      await this.registration.update();\n      return null;\n    } catch (error) {\n      console.error('SW update failed:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Get registration status\n   */\n  public getStatus(): 'unregistered' | 'installing' | 'waiting' | 'active' | 'unknown' {\n    if (!this.registration) return 'unregistered';\n\n    if (this.registration.installing) return 'installing';\n    if (this.registration.waiting) return 'waiting';\n    if (this.registration.active) return 'active';\n\n    return 'unknown';\n  }\n\n  /**\n   * Setup lifecycle event listeners\n   */\n  private setupEventListeners(): void {\n    if (!this.registration) return;\n\n    this.registration.addEventListener('updatefound', () => {\n      const newWorker = this.registration?.installing;\n      if (!newWorker) return;\n\n      newWorker.addEventListener('statechange', () => {\n        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n          this.onUpdateAvailable?.(newWorker);\n        }\n      });\n    });\n\n    navigator.serviceWorker.addEventListener('controllerchange', () => {\n      this.onControllerChange?.();\n    });\n  }\n\n  /**\n   * Send a message to the service worker\n   */\n  public async postMessage(message: any, transfer?: Transferable[]): Promise<void> {\n    const sw = navigator.serviceWorker.controller;\n    if (!sw) throw new Error('No active service worker');\n\n    if (transfer) {\n      sw.postMessage(message, { transfer });\n    } else {\n      sw.postMessage(message);\n    }\n  }\n\n  /**\n   * Wait for message from service worker\n   */\n  public waitForMessage(timeout: number = 5000): Promise<any> {\n    return new Promise((resolve, reject) => {\n      const timer = setTimeout(() => reject(new Error('Message timeout')), timeout);\n\n      const handler = (event: MessageEvent) => {\n        clearTimeout(timer);\n        navigator.serviceWorker.removeEventListener('message', handler);\n        resolve(event.data);\n      };\n\n      navigator.serviceWorker.addEventListener('message', handler);\n    });\n  }\n\n  /**\n   * Activate the waiting service worker\n   */\n  public async activateWaiting(): Promise<boolean> {\n    if (!this.registration?.waiting) return false;\n\n    try {\n      await this.postMessage({ type: 'SKIP_WAITING' });\n      return true;\n    } catch (error) {\n      console.error('Failed to activate waiting SW:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Set runtime cache strategy (e.g., cache-first or network-first)\n   */\n  public setStrategy(config: Record<string, any> = {}): void {\n    if (!navigator.serviceWorker.controller) {\n      console.warn('No active SW to set strategy');\n      return;\n    }\n\n    this.postMessage({\n      type: 'SET_STRATEGY',\n      payload: config,\n    });\n  }\n\n  // Optional hooks for integration - override as needed\n  public onUpdateAvailable?(newWorker: ServiceWorker): void;\n  public onControllerChange?(): void;\n}\n", "// src/spaceface/system/features/bin/AsyncImageLoader.ts\n\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport {\n  AsyncImageLoaderOptions,\n  SourceDataInterface,\n  ImageMetadataInterface,\n  ImageLoadResultInterface\n} from '../../types/bin.js';\n\nexport class AsyncImageLoader {\n  private container: Element | null;\n  private includePicture: boolean;\n  private debug: boolean;\n  private cache = new WeakMap<HTMLImageElement, boolean>();\n  private destroyed = false;\n\n  constructor(container: Element, options: AsyncImageLoaderOptions = {}) {\n    if (!(container instanceof Element)) {\n      throw new Error(\"AsyncImageLoader: container must be a DOM Element.\");\n    }\n    this.container = container;\n    this.includePicture = options.includePicture ?? false;\n    this.debug = options.debug ?? false;\n  }\n\n  private logDebug(message: string, data?: unknown): void {\n    if (!this.debug) return;\n    console.debug(`[AsyncImageLoader] ${message}`, data);\n  }\n\n  private ensureActive(methodName: string): void {\n    if (this.destroyed || !this.container) {\n      throw new Error(`AsyncImageLoader: Instance destroyed. Method: ${methodName}`);\n    }\n  }\n\n  public getImages(selector = \"img\"): HTMLImageElement[] {\n    this.ensureActive(\"getImages\");\n    if (!selector.trim()) return [];\n\n    const images = new Set<HTMLImageElement>();\n\n    this.container!.querySelectorAll(selector).forEach(el => {\n      if (el instanceof HTMLImageElement) {\n        if (!this.includePicture && el.closest(\"picture\")) return;\n        images.add(el);\n      }\n    });\n\n    return [...images];\n  }\n\n  // ---------- Overloads ----------\n  public async waitForImagesToLoad(\n    selector?: string,\n    includeFailed?: false\n  ): Promise<HTMLImageElement[]>;\n\n  public async waitForImagesToLoad(\n    selector: string,\n    includeFailed: true\n  ): Promise<ImageLoadResultInterface[]>;\n\n  // ---------- Implementation ----------\n  public async waitForImagesToLoad(\n    selector = \"img\",\n    includeFailed = false,\n    timeout = 10000\n  ): Promise<HTMLImageElement[] | ImageLoadResultInterface[]> {\n    this.logDebug(\"Waiting for images to load\", { selector, includeFailed, timeout });\n    const images = this.getImages(selector);\n\n    const results = await Promise.all(\n      images.map(img => {\n        if (this.cache.has(img)) {\n          this.logDebug(\"Image already cached\", { img });\n          return { element: img, loaded: true };\n        }\n\n        if (img.complete && img.naturalWidth > 0) {\n          this.cache.set(img, true);\n          this.logDebug(\"Image already loaded\", { img });\n          return { element: img, loaded: true };\n        }\n\n        return new Promise<ImageLoadResultInterface>(resolve => {\n          const onLoad = () => {\n            clearTimeout(timer);\n            this.cache.set(img, true);\n            this.logDebug(\"Image loaded successfully\", { img });\n            resolve({ element: img, loaded: true });\n          };\n\n          const onError = () => {\n            clearTimeout(timer);\n            this.logDebug(\"Image failed to load\", { img });\n            resolve({ element: img, loaded: false });\n          };\n\n          const timer = setTimeout(() => {\n            img.removeEventListener(\"load\", onLoad);\n            img.removeEventListener(\"error\", onError);\n            this.logDebug(\"Image load timeout\", { img });\n            resolve({ element: img, loaded: false });\n          }, timeout);\n\n          img.addEventListener(\"load\", onLoad, { once: true });\n          img.addEventListener(\"error\", onError, { once: true });\n        });\n      })\n    );\n\n    return includeFailed\n      ? results\n      : results.filter(r => r.loaded).map(r => r.element);\n  }\n\n  public getImageData(selector = \"img\"): ImageMetadataInterface[] {\n    return this.getImages(selector).map(img => {\n      const sources: SourceDataInterface[] = [];\n\n      if (this.includePicture) {\n        const picture = img.closest(\"picture\");\n        if (picture) {\n          picture.querySelectorAll(\"source\").forEach(source => {\n            sources.push({\n              srcset: source.srcset || \"\",\n              type: source.type || \"\",\n              media: source.media || \"\"\n            });\n          });\n        }\n      }\n\n      return {\n        element: img,\n        src: img.src || \"\",\n        alt: img.alt || \"\",\n        href: img.closest(\"a\")?.href ?? null,\n        sources\n      };\n    });\n  }\n\n  public clearCache(): void {\n    this.logDebug(\"Clearing image cache\");\n    this.cache = new WeakMap();\n  }\n\n  public destroy(): void {\n    this.container = null;\n    this.destroyed = true;\n  }\n}\n", "// src/spaceface/system/features/bin/AnimationLoop.ts\n\nexport const VERSION = 'nextworld-1.3.0' as const;\n\ntype FrameCallback = () => void;\n\n/**\n * Manages a loop of animation frames, allowing callbacks to be added and removed dynamically.\n * Ensures safe execution of callbacks and handles errors gracefully.\n */\nexport class AnimationLoop {\n    private callbacks: Set<FrameCallback> = new Set();\n    private running = false;\n    private _rafId: number | null = null;\n    private errorHandler: (error: unknown) => void;\n\n    constructor(errorHandler: (error: unknown) => void = console.error) {\n        this.errorHandler = errorHandler;\n    }\n\n    /**\n     * Adds a callback to the animation loop.\n     * Starts the loop if it is not already running.\n     *\n     * @param callback - The function to be called on each animation frame.\n     */\n    add(callback: FrameCallback): void {\n        if (typeof callback !== 'function') {\n            throw new TypeError('AnimationLoop.add: Callback must be a function');\n        }\n        if (!this.callbacks.has(callback)) this.callbacks.add(callback);\n        this.start();\n    }\n\n    /**\n     * Removes a callback from the animation loop.\n     * Stops the loop if no callbacks remain.\n     *\n     * @param callback - The function to be removed.\n     */\n    remove(callback: FrameCallback): void {\n        this.callbacks.delete(callback);\n        if (this.callbacks.size === 0) this.stop();\n    }\n\n    /**\n     * Removes all callbacks from the animation loop.\n     * Stops the loop if it is running.\n     */\n    clear(): void {\n        this.callbacks.clear();\n        this.stop();\n    }\n\n    /**\n     * Checks if a callback is currently in the animation loop.\n     *\n     * @param callback - The function to check.\n     * @returns True if the callback is in the loop, false otherwise.\n     */\n    has(callback: FrameCallback): boolean {\n        return this.callbacks.has(callback);\n    }\n\n    /**\n     * Pauses the animation loop, stopping all callbacks temporarily.\n     * This is equivalent to calling `stop` but does not clear callbacks.\n     */\n    pause(): void {\n        this.stop();\n    }\n\n    /**\n     * Resumes the animation loop if there are callbacks to execute.\n     */\n    resume(): void {\n        if (this.callbacks.size > 0) this.start();\n    }\n\n    /**\n     * Starts the animation loop if it is not already running.\n     * Private method to ensure controlled access.\n     */\n    private start(): void {\n        if (this.running || this.callbacks.size === 0) return;\n        this.running = true;\n        // Schedule the first frame rather than invoking immediately\n        this._rafId = requestAnimationFrame(this._loop);\n    }\n\n    /**\n     * Stops the animation loop and cancels the next frame.\n     * Private method to ensure controlled access.\n     */\n    private stop(): void {\n        this.running = false;\n        if (this._rafId !== null) cancelAnimationFrame(this._rafId);\n        this._rafId = null;\n    }\n\n    /**\n     * The main loop function, executed on each animation frame.\n     * Iterates over a snapshot of callbacks to allow safe modification during execution.\n     */\n    private _loop = (): void => {\n        if (!this.running) return;\n        for (const cb of Array.from(this.callbacks)) {\n            try {\n                cb();\n            } catch (err) {\n                this.errorHandler(err);\n            }\n        }\n        this._rafId = requestAnimationFrame(this._loop);\n    };\n}\n\n/**\n * A shared instance of the AnimationLoop class for global use.\n */\nexport const animationLoop = new AnimationLoop();\n", "// src/spaceface/features/SlidePlayer/SlidePlayer.ts\n\nexport const VERSION = 'nextworld-1.2.0';\n\nimport { eventBus } from '../../bin/EventBus.js';\nimport { EventBinder } from '../../bin/EventBinder.js';\nimport { AsyncImageLoader } from '../bin/AsyncImageLoader.js';\nimport { animationLoop } from '../bin/AnimationLoop.js';\nimport type { LogPayload } from '../../types/bin.js';\n\ninterface ISlidePlayerOptions {\n  interval?: number;\n  includePicture?: boolean;\n  dotsSelector?: string;\n  autoCreateDots?: boolean;\n  startPaused?: boolean;\n  enableBusEvents?: boolean;\n  autoplay?: boolean;\n  debug?: boolean;\n}\n\ntype PauseReason = 'manual' | 'hover' | 'hidden' | 'inactivity';\n\nexport class SlidePlayer {\n  static readonly SWIPE_THRESHOLD = 50;\n  static readonly VERTICAL_TOLERANCE = 30;\n  static readonly DEFAULT_INTERVAL = 5000;\n\n  private container: HTMLElement;\n  private interval: number;\n  private includePicture: boolean;\n  private dotsSelector: string;\n  private autoCreateDots: boolean;\n  private enableBusEvents: boolean;\n  private autoplay: boolean;\n  private debug: boolean;\n\n  private slides: HTMLElement[] = [];\n  private dots: HTMLDivElement[] = [];\n  private dotsWrapper: HTMLElement | null = null;\n  private currentIndex = 0;\n\n  private lastTickTime = 0;\n  private isDestroyed = false;\n\n  private isPointerDown = false;\n  private pointerStartX = 0;\n  private pointerStartY = 0;\n  private pointerEndX = 0;\n  private pointerEndY = 0;\n\n  private pauseReasons = new Set<PauseReason>();\n  private loader: AsyncImageLoader;\n  private binder: EventBinder;\n  private animateCallback: () => void;\n\n  private lastPauseState: boolean = false;\n  public readonly ready: Promise<void>;\n  public initError: unknown = null;\n\n  constructor(\n    containerOrSelector: string | HTMLElement,\n    {\n      interval = SlidePlayer.DEFAULT_INTERVAL,\n      includePicture = false,\n      dotsSelector = '.dots',\n      autoCreateDots = false,\n      startPaused = false,\n      enableBusEvents = true,\n      autoplay = true,\n      debug = false\n    }: ISlidePlayerOptions = {}\n  ) {\n    this.container = this.resolveContainer(containerOrSelector);\n    this.interval = interval > 0 ? interval : SlidePlayer.DEFAULT_INTERVAL;\n    this.includePicture = includePicture;\n    this.dotsSelector = dotsSelector;\n    this.autoCreateDots = autoCreateDots;\n    this.enableBusEvents = enableBusEvents;\n    this.autoplay = autoplay;\n    this.debug = debug;\n\n    this.loader = new AsyncImageLoader(this.container, { includePicture });\n    this.binder = new EventBinder(this.debug);\n\n    if (startPaused) this.pauseReasons.add('manual');\n\n    this.animateCallback = () => this.animate();\n    // Ensure init always resolves to avoid unhandled rejection.\n    // If init fails we capture the error in initError for callers to inspect.\n    this.ready = this.init()\n      .catch((err) => {\n        this.initError = err;\n        this.log('error', 'SlidePlayer init failed', err);\n      })\n      .then(() => {});\n\n    this.log('info', 'SlidePlayer initialized', { container: this.container, interval, autoplay, debug });\n  }\n\n  /** ---- Centralized logging ---- */\n  private log(level: 'debug' | 'info' | 'warn' | 'error', message: string, data?: unknown) {\n    if (!this.debug && level === 'debug') return;\n\n    const payload: LogPayload = { scope: 'SlidePlayer', level, message, data, time: Date.now() };\n    eventBus.emit('slideplayer:log', { level, message, data });\n    eventBus.emit('log', payload);\n    if (this.debug) {\n      const methodMap: Record<typeof level, keyof Console> = {\n        debug: 'debug',\n        info: 'info',\n        warn: 'warn',\n        error: 'error'\n      };\n      (console as any)[methodMap[level]]?.(`[SlidePlayer] [${level.toUpperCase()}]`, message, data);\n    }\n  }\n\n  private resolveContainer(containerOrSelector: string | HTMLElement): HTMLElement {\n    const container = typeof containerOrSelector === 'string'\n      ? document.querySelector<HTMLElement>(containerOrSelector)\n      : containerOrSelector;\n    if (!container) throw new Error('SlidePlayer: container element not found.');\n    return container;\n  }\n\n  /** ---- Initialization ---- */\n  private async init(): Promise<void> {\n    await this.loader.waitForImagesToLoad();\n\n    this.refreshSlides();\n    if (!this.slides.length) {\n      this.log('warn', 'No .slide elements found in container.');\n      return;\n    }\n\n    this.setupDots();\n    this.bindEvents();\n    this.setActiveSlide(0);\n    this.lastTickTime = performance.now();\n\n    // bus bindings handled by bindActivityEvents() to avoid duplication\n\n    if (!this.isPaused() && this.autoplay) {\n      animationLoop.add(this.animateCallback);\n    }\n  }\n\n  /** ---- RAF Animation ---- */\n  private animate(): void {\n    if (this.isDestroyed || !this.autoplay || this.isPaused() || this.slides.length < 2) return;\n\n    const now = performance.now();\n    const elapsed = now - this.lastTickTime;\n\n    if (elapsed >= this.interval) {\n      this.next(false);\n      this.lastTickTime = now;\n    }\n  }\n\n  /** ---- Pause / Resume ---- */\n  private togglePause(reason: PauseReason, shouldPause: boolean): void {\n    if (shouldPause) this.pauseReasons.add(reason);\n    else this.pauseReasons.delete(reason);\n\n    this.emitPauseResumeIfChanged();\n\n    if (this.isPaused()) {\n      if (animationLoop.has(this.animateCallback)) animationLoop.remove(this.animateCallback);\n      this.log('debug', `Paused due to: ${Array.from(this.pauseReasons).join(', ')}`);\n    } else {\n      if (!animationLoop.has(this.animateCallback)) animationLoop.add(this.animateCallback);\n      this.log('debug', 'Resumed playback');\n    }\n  }\n\n  private emitPauseResumeIfChanged(): void {\n    const nowPaused = this.isPaused();\n    if (nowPaused !== this.lastPauseState) {\n      this.lastPauseState = nowPaused;\n      const event = nowPaused ? 'slideplayer:paused' : 'slideplayer:resumed';\n      this.emit(event, { reasons: Array.from(this.pauseReasons) });\n    }\n  }\n\n  public play(): void { this.togglePause('manual', false); }\n  public pause(): void { this.togglePause('manual', true); }\n  public isPaused(): boolean { return this.pauseReasons.size > 0; }\n\n  /** ---- Slide Navigation ---- */\n  public goToSlide(index: number, restart: boolean = true): void {\n    if (index < 0 || index >= this.slides.length || index === this.currentIndex) return;\n    this.setActiveSlide(index);\n    if (restart) this.resetTimer();\n  }\n\n  public next(restart: boolean = true): void {\n    if (this.slides.length < 2) return;\n    this.goToSlide((this.currentIndex + 1) % this.slides.length, restart);\n  }\n\n  public prev(restart: boolean = true): void {\n    if (this.slides.length < 2) return;\n    const prevIndex = (this.currentIndex - 1 + this.slides.length) % this.slides.length;\n    this.goToSlide(prevIndex, restart);\n  }\n\n  /** ---- Slides / Dots ---- */\n  private refreshSlides(): void {\n    this.slides = Array.from(this.container.querySelectorAll<HTMLElement>('.slide'));\n  }\n\n  private setupDots(): void {\n    this.dotsWrapper = this.container.querySelector(this.dotsSelector);\n    if (!this.dotsWrapper && this.autoCreateDots) {\n      this.dotsWrapper = document.createElement('div');\n      this.dotsWrapper.className = 'dots';\n      this.container.appendChild(this.dotsWrapper);\n    }\n    if (!this.dotsWrapper) return;\n\n    this.dotsWrapper.innerHTML = '';\n    this.dots = this.slides.map((_, i) => {\n      const dot = document.createElement('div');\n      dot.className = 'dot';\n      dot.dataset.index = i.toString();\n      this.binder.bindDOM(dot, 'click', () => this.goToSlide(i));\n      this.dotsWrapper!.appendChild(dot);\n      return dot;\n    });\n  }\n\n  private updateDots(index: number): void {\n    this.dots.forEach((dot, i) => dot.classList.toggle('active', i === index));\n  }\n\n  private setActiveSlide(index: number): void {\n    const prev = this.currentIndex;\n    this.slides[this.currentIndex]?.classList.remove('active');\n    this.currentIndex = index;\n    this.slides[this.currentIndex]?.classList.add('active');\n    this.updateDots(index);\n\n    if (prev !== index) this.emit('slideplayer:slideChanged', { index }, 'slideplayer:slide-changed');\n  }\n\n  private resetTimer(): void { this.lastTickTime = performance.now(); }\n\n  /** ---- Event Binding ---- */\n  private bindEvents(): void {\n    this.bindPointerEvents();\n    this.bindKeyboardEvents();\n    this.bindVisibilityEvents();\n    this.bindActivityEvents();\n    this.bindUnloadEvent();\n  }\n\n  private bindPointerEvents(): void {\n    this.binder.bindDOM(this.container, 'pointerdown', (e) => {\n      const ev = e as PointerEvent;\n      this.isPointerDown = true;\n      this.pointerStartX = ev.clientX; this.pointerStartY = ev.clientY;\n      this.pointerEndX = ev.clientX; this.pointerEndY = ev.clientY;\n    });\n    this.binder.bindDOM(this.container, 'pointermove', (e) => {\n      if (!this.isPointerDown) return;\n      const ev = e as PointerEvent;\n      this.pointerEndX = ev.clientX; this.pointerEndY = ev.clientY;\n    });\n    // listen for pointerup/pointercancel on window so release outside container is handled\n    this.binder.bindDOM(window, 'pointerup', () => {\n      if (this.isPointerDown) { this.handleSwipe(); this.isPointerDown = false; }\n    });\n    this.binder.bindDOM(window, 'pointercancel', () => {\n      this.isPointerDown = false;\n    });\n    this.binder.bindDOM(this.container, 'pointerleave', () => this.isPointerDown = false);\n    this.binder.bindDOM(this.container, 'mouseenter', () => this.togglePause('hover', true));\n    this.binder.bindDOM(this.container, 'mouseleave', () => this.togglePause('hover', false));\n  }\n\n  private bindKeyboardEvents(): void {\n    this.binder.bindDOM(document, 'keydown', (e) => {\n      const ev = e as KeyboardEvent;\n      if (ev.key === 'ArrowRight') this.next();\n      else if (ev.key === 'ArrowLeft') this.prev();\n    });\n  }\n\n  private bindVisibilityEvents(): void {\n    this.binder.bindDOM(document, 'visibilitychange', () => {\n      this.togglePause('hidden', document.visibilityState === 'hidden');\n    });\n  }\n\n  private bindActivityEvents(): void {\n    if (this.enableBusEvents) {\n      this.binder.bindBus('user:inactive', () => this.togglePause('inactivity', true));\n      this.binder.bindBus('user:active', () => this.togglePause('inactivity', false));\n    }\n  }\n\n  private bindUnloadEvent(): void {\n    this.binder.bindDOM(window, 'beforeunload', () => this.destroy());\n  }\n\n  private handleSwipe(): void {\n    const dx = this.pointerEndX - this.pointerStartX;\n    const dy = this.pointerEndY - this.pointerStartY;\n    if (Math.abs(dx) >= SlidePlayer.SWIPE_THRESHOLD && Math.abs(dy) < SlidePlayer.VERTICAL_TOLERANCE) {\n      const direction = dx < 0 ? 'next' : 'prev';\n      this.log('debug', `Swipe detected`, { dx, dy, direction });\n      dx < 0 ? this.next() : this.prev();\n    }\n  }\n\n  private emit(type: string, detail: any, busEvent?: string): void {\n    this.container.dispatchEvent(new CustomEvent(type, { detail, bubbles: true }));\n    if (this.enableBusEvents && busEvent) eventBus.emit(busEvent, detail);\n  }\n\n  public destroy(): void {\n    if (this.isDestroyed) return;\n    this.isDestroyed = true;\n\n    animationLoop.remove(this.animateCallback);\n    this.binder.unbindAll();\n    this.loader.destroy();\n\n    this.slides = [];\n    this.dots = [];\n    this.dotsWrapper = null;\n    this.pauseReasons.clear();\n\n    this.log('info', 'SlidePlayer destroyed');\n  }\n\n  /** ---- Public getters ---- */\n  public get currentSlideIndex(): number { return this.currentIndex; }\n  public get slideCount(): number { return this.slides.length; }\n}\n", "// src/spaceface/system/features/bin/math.ts\n\nexport const VERSION = 'nextworld-1.3.0' as const;\n\n/**\n * Clamps a number within the inclusive range specified by the minimum and maximum values.\n *\n * @param value - The number to clamp.\n * @param min - The lower bound of the range.\n * @param max - The upper bound of the range.\n * @returns The clamped value.\n * @throws Will throw an error if `min` is greater than `max`.\n */\nexport const clamp = (value: number, min: number, max: number): number => {\n  if (min > max) {\n    throw new RangeError('The `min` value cannot be greater than the `max` value.');\n  }\n  return Math.max(min, Math.min(value, max));\n};\n\n/**\n * Performs a linear interpolation between two values.\n *\n * @param a - The start value.\n * @param b - The end value.\n * @param t - The interpolation factor (typically between 0 and 1).\n * @returns The interpolated value.\n * @throws Will throw an error if `t` is not between 0 and 1.\n */\nexport const lerp = (a: number, b: number, t: number): number => {\n  if (t < 0 || t > 1) {\n    throw new RangeError('The interpolation factor `t` must be between 0 and 1.');\n  }\n  return (1 - t) * a + t * b;\n};\n", "// src/spaceface/features/FloatingImages/FloatingImage.ts\n\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport { clamp } from '../bin/math.js';\n\nimport type {\n    ContainerDimensionsInterface,\n    FloatingImageOptionsInterface\n} from '../../types/features.js';\n\nconst DAMPING = 0.85;\nconst MIN_VELOCITY = 0.1;\nconst MAX_SPEED = 2.5;\nconst VELOCITY_JITTER = 0.02;\n\nexport class FloatingImage {\n    private element: HTMLElement | null;\n    private size: { width: number; height: number };\n    private x: number;\n    private y: number;\n    private vx: number;\n    private vy: number;\n    private options: Required<FloatingImageOptionsInterface>;\n\n    constructor(element: HTMLElement, dims: ContainerDimensionsInterface, options: FloatingImageOptionsInterface = {}) {\n        this.element = element;\n        this.options = { useSubpixel: true, debug: false, ...options };\n        this.size = { width: element.offsetWidth, height: element.offsetHeight };\n\n        // guard against negative ranges if container is smaller than image\n        this.x = Math.random() * Math.max(0, dims.width - this.size.width);\n        this.y = Math.random() * Math.max(0, dims.height - this.size.height);\n\n        this.vx = (Math.random() - 0.5) * 3;\n        this.vy = (Math.random() - 0.5) * 3;\n\n        element.style.willChange = 'transform';\n        element.style.backfaceVisibility = 'hidden';\n        element.style.perspective = '1000px';\n        element.style.opacity = '1';\n\n        this.updatePosition();\n    }\n\n    private logDebug(message: string, data?: unknown): void {\n        if (this.options.debug) {\n            console.debug(`[FloatingImage] ${message}`, data);\n        }\n    }\n\n    updatePosition(): boolean {\n        if (!this.element) {\n            this.logDebug(\"updatePosition called on destroyed element\");\n            return false;\n        }\n        const x = this.options.useSubpixel ? this.x : Math.round(this.x);\n        const y = this.options.useSubpixel ? this.y : Math.round(this.y);\n        this.element.style.transform = `translate3d(${x}px, ${y}px, 0)`;\n        this.logDebug(\"Position updated\", { x, y });\n        return true;\n    }\n\n    update(multiplier: number, dims: ContainerDimensionsInterface, applyPosition = true): boolean {\n        if (!this.element) {\n            this.logDebug(\"update called on destroyed element\");\n            return false;\n        }\n\n        this.x += this.vx * multiplier;\n        this.y += this.vy * multiplier;\n\n        this.handleCollisions(dims);\n        this.applyVelocityJitter();\n\n        if (applyPosition) return this.updatePosition();\n        return true;\n    }\n\n    private handleCollisions(dims: ContainerDimensionsInterface): void {\n        if (this.x <= 0 || this.x + this.size.width >= dims.width) {\n            this.vx = -this.vx * DAMPING;\n            const signX = this.vx >= 0 ? 1 : -1;\n            this.vx = Math.abs(this.vx) < MIN_VELOCITY ? signX * MIN_VELOCITY : this.vx;\n            this.x = clamp(this.x, 0, Math.max(0, dims.width - this.size.width));\n            this.logDebug(\"Horizontal collision handled\", { x: this.x, vx: this.vx });\n        }\n\n        if (this.y <= 0 || this.y + this.size.height >= dims.height) {\n            this.vy = -this.vy * DAMPING;\n            const signY = this.vy >= 0 ? 1 : -1;\n            this.vy = Math.abs(this.vy) < MIN_VELOCITY ? signY * MIN_VELOCITY : this.vy;\n            this.y = clamp(this.y, 0, Math.max(0, dims.height - this.size.height));\n            this.logDebug(\"Vertical collision handled\", { y: this.y, vy: this.vy });\n        }\n    }\n\n    private applyVelocityJitter(): void {\n        this.vx += (Math.random() - 0.5) * VELOCITY_JITTER;\n        this.vy += (Math.random() - 0.5) * VELOCITY_JITTER;\n\n        const speedSquared = this.vx ** 2 + this.vy ** 2;\n        if (speedSquared > MAX_SPEED ** 2) {\n            const scale = MAX_SPEED / Math.sqrt(speedSquared);\n            this.vx *= scale;\n            this.vy *= scale;\n            this.logDebug(\"Velocity clamped\", { vx: this.vx, vy: this.vy });\n        }\n    }\n\n    resetPosition(dims: ContainerDimensionsInterface) {\n        this.x = Math.random() * Math.max(0, dims.width - this.size.width);\n        this.y = Math.random() * Math.max(0, dims.height - this.size.height);\n        this.updatePosition(); // must be called\n    }\n\n\n    updateSize() {\n        if (!this.element) return;\n        this.size.width = this.element.offsetWidth;\n        this.size.height = this.element.offsetHeight;\n    }\n\n    clampPosition(dims: ContainerDimensionsInterface) {\n        this.x = clamp(this.x, 0, Math.max(0, dims.width - this.size.width));\n        this.y = clamp(this.y, 0, Math.max(0, dims.height - this.size.height));\n    }\n\n    destroy() {\n        if (!this.element) return;\n        this.element.style.willChange = 'auto';\n        this.element.style.backfaceVisibility = '';\n        this.element.style.perspective = '';\n        this.element = null;\n    }\n}\n", "// src/spaceface/system/features/bin/PerformanceMonitor.ts\n\nexport const VERSION = 'nextworld-1.0.0' as const;\n\nimport {\n  PerformanceLevel,\n  PerformanceSettingsInterface,\n} from '../../types/bin.js';\n\nexport class PerformanceMonitor {\n  private fps: number = 60;\n  private lastTime: number = performance.now();\n  private frameSkipThreshold: number = 30;\n  private shouldSkipFrame: boolean = false;\n  private frameCount: number = 0;\n\n  private cachedPerformanceLevel: PerformanceLevel = 'high';\n  private lastLevelUpdate: number = 0;\n  private levelUpdateInterval: number = 1000;\n  private cachedSettings: PerformanceSettingsInterface | null = null;\n\n  private lastLoggedFPS: number = 60;\n  private fpsLogThreshold: number = 5;\n\n  /** Updates FPS and returns whether to skip this frame */\n  public update(): boolean {\n    const now = performance.now();\n    const delta = now - this.lastTime;\n    if (delta < 1) return this.shouldSkipFrame;\n\n    const currentFPS = 1000 / delta;\n    this.fps = this.fps * 0.9 + currentFPS * 0.1; // smoothing\n    this.frameCount++;\n\n    this.shouldSkipFrame = this.fps < this.frameSkipThreshold;\n\n    if (Math.abs(this.fps - this.lastLoggedFPS) >= this.fpsLogThreshold) {\n      // eventBus.emit('performance:fps', { fps: this.getCurrentFPS(), frameSkip: this.shouldSkipFrame });\n      this.lastLoggedFPS = this.fps;\n    }\n\n    this.lastTime = now;\n    return this.shouldSkipFrame;\n  }\n\n  public getFrameCount(): number { return this.frameCount; }\n  public getCurrentFPS(): number { return Math.round(this.fps * 10) / 10; }\n\n  public getPerformanceLevel(): PerformanceLevel {\n    const now = performance.now();\n    if (now - this.lastLevelUpdate > this.levelUpdateInterval) {\n      this.cachedPerformanceLevel = this.fps >= 50 ? 'high' : this.fps >= 30 ? 'medium' : 'low';\n      this.lastLevelUpdate = now;\n      this.cachedSettings = null;\n      // eventBus.emit('performance:level', { level: this.cachedPerformanceLevel, fps: this.getCurrentFPS() });\n    }\n    return this.cachedPerformanceLevel;\n  }\n\n  public getRecommendedSettings(): PerformanceSettingsInterface {\n    if (this.cachedSettings) return this.cachedSettings;\n\n    const level = this.getPerformanceLevel();\n    const settingsMap: Record<PerformanceLevel, PerformanceSettingsInterface> = {\n      high: { maxImages: 50, speedMultiplier: 1.0, useSubpixel: true },\n      medium: { maxImages: 25, speedMultiplier: 0.8, useSubpixel: false },\n      low: { maxImages: 10, speedMultiplier: 0.5, useSubpixel: false },\n    };\n    this.cachedSettings = settingsMap[level];\n    return this.cachedSettings;\n  }\n\n  public reset(): void {\n    this.fps = 60;\n    this.lastTime = performance.now();\n    this.shouldSkipFrame = false;\n    this.frameCount = 0;\n    this.cachedPerformanceLevel = 'high';\n    this.lastLevelUpdate = 0;\n    this.cachedSettings = null;\n    this.lastLoggedFPS = 60;\n  }\n}\n", "// src/spaceface/system/features/bin/ResizeManager.ts\n\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport { debounce, throttle, CancellableFunction } from './timing.js';\n\ntype WindowResizeCallback = () => void;\ntype ElementResizeCallback = (entry: ResizeObserverEntry) => void;\n\ninterface ElementObserverEntryInterface {\n  observer: ResizeObserver;\n  callbacks: Set<CancellableFunction<ElementResizeCallback>>;\n}\n\ntype ElementSize = { width: number; height: number };\n\nexport class ResizeManager {\n  private windowCallbacks: Map<WindowResizeCallback, EventListener> = new Map();\n  private elementObservers: Map<Element, ElementObserverEntryInterface> = new Map();\n\n  private logDebug(message: string, data?: unknown): void {\n    // Disable debug output for resize events\n    // if (message.includes(\"resize\")) return;\n    console.debug(`[ResizeManager] ${message}`, data);\n  }\n\n  private wrapCallback<T extends (...args: any[]) => void>(\n    cb: T,\n    options?: { debounceMs?: number; throttleMs?: number }\n  ): CancellableFunction<T> {\n    if (options?.debounceMs != null) {\n      return debounce(cb as (...args: any[]) => void, options.debounceMs) as CancellableFunction<T>;\n    } else if (options?.throttleMs != null) {\n      return throttle(cb as (...args: any[]) => void, options.throttleMs) as CancellableFunction<T>;\n    } else {\n      const wrappedCb = cb as CancellableFunction<T>;\n      wrappedCb.cancel = () => {};\n      return wrappedCb;\n    }\n  }\n\n  /**\n   * Register a callback for window resize events.\n   * Optionally debounce or throttle the callback.\n   */\n  onWindow(\n    cb: WindowResizeCallback,\n    options: { debounceMs: number } = { debounceMs: 200 }\n  ): () => void {\n    const wrappedCb = debounce(cb, options.debounceMs);\n    const handler = () => wrappedCb();\n\n    this.windowCallbacks.set(cb, handler);\n    window.addEventListener(\"resize\", handler);\n\n    return (): void => {\n      window.removeEventListener(\"resize\", handler);\n      wrappedCb.cancel?.();\n      this.windowCallbacks.delete(cb);\n    };\n  }\n\n  /**\n   * Register a callback for an element's resize events.\n   * Optionally debounce or throttle the callback.\n   */\n  onElement(\n    el: Element,\n    cb: ElementResizeCallback,\n    options?: { debounceMs?: number; throttleMs?: number }\n  ): () => void {\n    this.logDebug(\"Registering element resize callback\", { el, cb, options });\n    let entry = this.elementObservers.get(el);\n\n    if (!entry) {\n      const callbacks = new Set<CancellableFunction<ElementResizeCallback>>();\n      const observer = new ResizeObserver((entries) => {\n        try {\n          const entry = entries[0];\n          callbacks.forEach(fn => fn(entry));\n        } catch (error) {\n          this.logDebug(\"ResizeObserver callback error\", { error });\n        }\n      });\n\n      entry = { observer, callbacks };\n      this.elementObservers.set(el, entry);\n      observer.observe(el);\n    }\n\n    const wrappedCb = this.wrapCallback(cb, options);\n    entry.callbacks.add(wrappedCb);\n\n    return (): void => {\n      this.logDebug(\"Removing element resize callback\", { el, cb });\n      entry!.callbacks.delete(wrappedCb);\n      wrappedCb.cancel?.();\n      if (entry!.callbacks.size === 0) {\n        entry!.observer.disconnect();\n        this.elementObservers.delete(el);\n      }\n    };\n  }\n\n  /**\n   * Get current size of an element.\n   */\n  getElement(el: Element): ElementSize {\n    try {\n      const rect = el.getBoundingClientRect();\n      // this.logDebug(\"Getting element size\", { el, rect });\n      return { width: rect.width, height: rect.height };\n    } catch (error) {\n      // this.logDebug(\"Error getting element size\", { el, error });\n      throw new Error(\"ResizeManager: Failed to get element size.\");\n    }\n  }\n\n  /**\n   * Cleanup all registered window and element callbacks.\n   */\n  destroy(): void {\n    this.logDebug(\"Destroying ResizeManager\");\n    for (const [cb, handler] of this.windowCallbacks.entries()) {\n      window.removeEventListener(\"resize\", handler);\n    }\n    this.windowCallbacks.clear();\n\n    for (const entry of this.elementObservers.values()) {\n      entry.observer.disconnect();\n      for (const fn of entry.callbacks) {\n        fn.cancel?.();\n      }\n    }\n    this.elementObservers.clear();\n    this.logDebug(\"ResizeManager destroyed\");\n  }\n}\n\n// Singleton instance\nexport const resizeManager = new ResizeManager();\n", "// src/spaceface/features/FloatingImages/FloatingImagesManager.ts\n\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport { FloatingImage } from './FloatingImage.js';\nimport { PerformanceMonitor } from '../bin/PerformanceMonitor.js';\nimport { resizeManager } from '../bin/ResizeManager.js';\nimport { AsyncImageLoader } from '../bin/AsyncImageLoader.js';\nimport { animationLoop } from '../bin/AnimationLoop.js';\nimport { eventBus } from '../../bin/EventBus.js';\nimport { debounce } from '../bin/timing.js';\nimport type { LogPayload } from '../../types/bin.js';\n\nimport type {\n    FloatingImagesManagerOptionsInterface,\n    ContainerDimensionsInterface,\n    FloatingImagesManagerInterface\n} from '../../types/features.js';\n\nexport class FloatingImagesManager implements FloatingImagesManagerInterface {\n    readonly container: HTMLElement;\n    performanceMonitor: PerformanceMonitor;\n    images: FloatingImage[] = [];\n    speedMultiplier: number = 1;\n    isInViewport: boolean = true;\n    private _destroyed: boolean = false;\n    private animateCallback: () => void;\n    maxImages: number;\n    intersectionObserver: IntersectionObserver;\n    unsubscribeWindow?: () => void;\n    unsubscribeElement?: () => void;\n    imageLoader: AsyncImageLoader;\n    containerWidth!: number;\n    containerHeight!: number;\n    debug: boolean;\n\n    constructor(container: HTMLElement, options: FloatingImagesManagerOptionsInterface = {}) {\n        this.container = container;\n        this.debug = options.debug ?? false;\n\n        this.performanceMonitor = new PerformanceMonitor();\n        const perfSettings = this.performanceMonitor.getRecommendedSettings();\n        this.maxImages = options.maxImages ?? perfSettings.maxImages;\n\n        this.intersectionObserver = new IntersectionObserver(entries => {\n            const entry = entries[0];\n            if (!entry) return;\n            this.isInViewport = !!entry.isIntersecting;\n        }, { threshold: 0 });\n        this.intersectionObserver.observe(this.container);\n\n        this.setupResizeHandling();\n        this.imageLoader = new AsyncImageLoader(this.container);\n        this.updateContainerDimensions();\n\n        this.animateCallback = () => this.animate();\n\n        // Only add callback if not already in AnimationLoop\n        if (!animationLoop.has(this.animateCallback)) {\n            animationLoop.add(this.animateCallback);\n        }\n\n        this.initializeImages();\n        this.log('info', 'FloatingImagesManager initialized', {\n            container: this.container,\n            maxImages: this.maxImages\n        });\n    }\n\n    private log(level: 'debug' | 'info' | 'warn' | 'error', message: string, data?: unknown) {\n        if (!this.debug && level === 'debug') return;\n\n        const payload: LogPayload = { scope: 'FloatingImagesManager', level, message, data, time: Date.now() };\n        eventBus.emit('floatingImages:log', { level, message, data });\n        eventBus.emit('log', payload);\n\n        if (this.debug) {\n            const consoleMethodMap: Record<'debug' | 'info' | 'warn' | 'error', keyof Console> = {\n                debug: 'debug',\n                info: 'info',\n                warn: 'warn',\n                error: 'error',\n            };\n            const method = consoleMethodMap[level] ?? 'log';\n            (console as any)[method](`[FloatingImagesManager] [${level.toUpperCase()}]`, message, data);\n        }\n    }\n\n    private setupResizeHandling() {\n        this.unsubscribeWindow = resizeManager.onWindow(() => this.handleResize());\n        this.unsubscribeElement = resizeManager.onElement(this.container, () => this.handleResize());\n    }\n\n    private updateContainerDimensions() {\n        if (!this.container.isConnected) {\n            this.containerWidth = 0;\n            this.containerHeight = 0;\n            this.log('warn', 'Container is not in the DOM, dimensions set to 0');\n            return;\n        }\n        const dims = resizeManager.getElement(this.container);\n        this.containerWidth = dims.width;\n        this.containerHeight = dims.height;\n    }\n\n    private async initializeImages() {\n        try {\n            const imgElements = await this.imageLoader.waitForImagesToLoad('.floating-image');\n            const dims = { width: this.containerWidth, height: this.containerHeight };\n            // if destroyed while awaiting, avoid adding images\n            imgElements.slice(0, this.maxImages).forEach(el => {\n                if (this._destroyed) return;\n                this.addExistingImage(el, dims);\n            });\n            this.log('info', 'Images initialized', { count: this.images.length });\n        } catch (err) {\n            this.log('error', 'Failed to initialize images', err);\n        }\n    }\n\n    private addExistingImage(el: HTMLElement, dims: ContainerDimensionsInterface) {\n        if (this.images.length >= this.maxImages) return;\n        const floatingImage = new FloatingImage(el, dims, { debug: this.debug });\n        this.images.push(floatingImage);\n    }\n\n    private handleResize = debounce(() => {\n        try {\n            if (this._destroyed) return;\n            if (!this.container.isConnected) {\n                this.log('warn', 'Resize event ignored, container not in DOM');\n                return;\n            }\n            this.updateContainerDimensions();\n            const dims = { width: this.containerWidth, height: this.containerHeight };\n            this.images.forEach(img => {\n                img.updateSize();\n                img.clampPosition(dims);\n                img.updatePosition();\n            });\n            this.log('debug', 'Container resized', dims);\n        } catch (error) {\n            this.log('error', 'Error during handleResize', error);\n        }\n    }, 200);\n\n    private animate() {\n        if (this._destroyed) return;\n\n        if (!this.isInViewport || this.speedMultiplier === 0) return;\n\n        const skipFrame = this.performanceMonitor.update();\n        if (skipFrame) return;\n\n        const multiplier = this.speedMultiplier;\n        const dims = { width: this.containerWidth, height: this.containerHeight };\n\n        this.images = this.images.filter(img => img.update(multiplier, dims));\n    }\n\n    public resetAllImagePositions() {\n        const dims = { width: this.containerWidth, height: this.containerHeight };\n        this.images.forEach(img => img.resetPosition(dims));\n        this.log('debug', 'All image positions reset', dims);\n    }\n\n    public reinitializeImages() {\n        try {\n            if (this._destroyed) return;\n            if (!this.container.isConnected) {\n                this.log('warn', 'reinitializeImages: container not in DOM, skipping');\n                return;\n            }\n\n            this.images.forEach(img => img.destroy());\n            this.images.length = 0;\n\n            const dims = { width: this.containerWidth, height: this.containerHeight };\n            const imgElements = Array.from(this.container.querySelectorAll<HTMLElement>('.floating-image'))\n                .slice(0, this.maxImages);\n\n            imgElements.forEach(el => {\n                const floatingImage = new FloatingImage(el, dims, { debug: this.debug });\n                this.images.push(floatingImage);\n            });\n\n            this.log('info', 'Images reinitialized', { count: this.images.length });\n        } catch (error) {\n            this.log('error', 'Error during reinitializeImages', error);\n        }\n    }\n\n    destroy() {\n        if (this._destroyed) return;\n\n        this._destroyed = true;\n\n        if (animationLoop.has(this.animateCallback)) {\n            animationLoop.remove(this.animateCallback);\n        }\n\n        this.unsubscribeWindow?.();\n        this.unsubscribeElement?.();\n        // clear unsubscribe refs to avoid keeping closures alive\n        this.unsubscribeWindow = undefined;\n        this.unsubscribeElement = undefined;\n\n        this.intersectionObserver.disconnect();\n        this.images.forEach(img => img.destroy());\n        this.images.length = 0;\n        this.imageLoader.destroy();\n\n        // reset container dims\n        this.containerWidth = 0;\n        this.containerHeight = 0;\n\n        this.log('info', 'FloatingImagesManager destroyed');\n    }\n}\n", "// src/spaceface/features/Screensaver/ScreensaverController.ts\n\nexport const VERSION = 'nextworld-1.2.0' as const;\n\nimport { eventBus } from \"../../bin/EventBus.js\";\nimport { EventBinder } from \"../../bin/EventBinder.js\";\nimport { InactivityWatcher } from \"../../bin/InactivityWatcher.js\";\nimport { PartialFetcher } from \"../../bin/PartialFetcher.js\";\nimport { FloatingImagesManager } from \"../FloatingImages/FloatingImagesManager.js\";\nimport type { LogPayload } from \"../../types/bin.js\";\n\nimport type {\n  ScreensaverControllerOptionsInterface,\n  FloatingImagesManagerInterface\n} from \"../../types/features.js\";\n\nexport class ScreensaverController {\n  private readonly partialUrl: string;\n  private readonly targetSelector: string;\n  private readonly inactivityDelay: number;\n  private readonly debug: boolean;\n  private readonly onError?: (message: string, error: unknown) => void;\n\n  private screensaverManager: FloatingImagesManagerInterface | null = null;\n  private watcher: InactivityWatcher | null = null;\n  private _destroyed = false;\n  private eventBinder: EventBinder;\n  private _partialLoaded = false;\n  private partialFetcher: typeof PartialFetcher;\n  // avoid duplicate concurrent partial loads\n  private _loadPromise?: Promise<void>;\n  private _hideTimeout: number | null = null;\n  private _bound = false;\n\n  private _onInactivity: () => void;\n  private _onActivity: () => void;\n\n  constructor(\n    options: ScreensaverControllerOptionsInterface & {\n      watcher?: InactivityWatcher;\n      partialFetcher?: typeof PartialFetcher;\n      debug?: boolean;\n    }\n  ) {\n    this.partialUrl = options.partialUrl;\n    this.targetSelector = options.targetSelector;\n    this.inactivityDelay = options.inactivityDelay ?? 12000;\n    this.debug = !!options.debug;\n\n    this.watcher = options.watcher ?? null;\n    this.partialFetcher = options.partialFetcher ?? PartialFetcher;\n    this.onError = options.onError;\n\n    this.eventBinder = new EventBinder(this.debug);\n    this._onInactivity = this.showScreensaver.bind(this);\n    this._onActivity = this.hideScreensaver.bind(this);\n\n    this.log('info', 'ScreensaverController initialized', {\n      partialUrl: this.partialUrl,\n      targetSelector: this.targetSelector,\n      inactivityDelay: this.inactivityDelay\n    });\n  }\n\n  /** Centralized logging with debug and level support */\n  private log(\n    level: 'debug' | 'info' | 'warn' | 'error',\n    message: string,\n    data?: unknown\n  ) {\n    if (!this.debug && level === 'debug') return;\n\n    const payload: LogPayload = { scope: 'ScreensaverController', level, message, data, time: Date.now() };\n    eventBus.emit(\"screensaver:log\", { level, message, data });\n    eventBus.emit(\"log\", payload);\n\n    if (this.debug) {\n      const consoleMethodMap: Record<'debug' | 'info' | 'warn' | 'error', keyof Console> = {\n        debug: 'debug',\n        info: 'info',\n        warn: 'warn',\n        error: 'error'\n      };\n      const method = consoleMethodMap[level] ?? 'log';\n      (console as any)[method](`[ScreensaverController] [${level.toUpperCase()}]`, message, data);\n    }\n  }\n\n  async init(): Promise<void> {\n    if (this._destroyed) return;\n    if (this._bound) return;\n\n    try {\n      if (!this.watcher) {\n        this.watcher = InactivityWatcher.getInstance({\n          inactivityDelay: this.inactivityDelay\n        });\n      }\n\n      this.eventBinder.bindBus(\"user:inactive\", this._onInactivity);\n      this.eventBinder.bindBus(\"user:active\", this._onActivity);\n      this._bound = true;\n\n      this.log('info', 'Bound user inactivity/active events');\n    } catch (error) {\n      this.handleError('Failed to initialize inactivity watcher', error);\n    }\n  }\n\n  async showScreensaver(): Promise<void> {\n    if (this._destroyed) return;\n\n    try {\n      if (!this._partialLoaded) {\n        if (!this._loadPromise) {\n          this._loadPromise = this.partialFetcher\n            .load(this.partialUrl, this.targetSelector)\n            .then(() => { this._partialLoaded = true; })\n            .finally(() => { this._loadPromise = undefined; });\n        }\n        await this._loadPromise;\n      }\n\n      const container = document.querySelector<HTMLElement>(this.targetSelector);\n      if (!container) {\n        this.handleError(`Target selector \"${this.targetSelector}\" not found`, null);\n        return;\n      }\n\n      container.style.opacity = '0';\n      container.style.display = '';\n      void container.offsetWidth; // force reflow\n      container.style.transition = 'opacity 0.5s ease';\n      container.style.opacity = '1';\n\n      if (!this.screensaverManager) {\n        this.screensaverManager = new FloatingImagesManager(container, { debug: this.debug });\n      } else {\n        this.screensaverManager.destroy();\n        this.screensaverManager = new FloatingImagesManager(container, { debug: this.debug });\n      }\n\n      this.log('info', 'Screensaver displayed');\n    } catch (error) {\n      this.handleError('Failed to load or show screensaver', error);\n    }\n  }\n\n  hideScreensaver(): void {\n    if (this._destroyed) return;\n\n    try {\n      const container = document.querySelector<HTMLElement>(this.targetSelector);\n      if (container) {\n        container.style.transition = 'opacity 0.5s ease';\n        container.style.opacity = '0';\n        if (this._hideTimeout) {\n          clearTimeout(this._hideTimeout);\n        }\n        this._hideTimeout = window.setTimeout(() => {\n          container.style.display = 'none';\n          this._hideTimeout = null;\n        }, 500);\n      }\n\n      this.log('debug', 'Screensaver hidden');\n    } catch (error) {\n      this.handleError('Failed to hide screensaver', error);\n    }\n  }\n\n  destroy(): void {\n    if (this._destroyed) return;\n    this._destroyed = true;\n\n    this.hideScreensaver();\n    try { this.screensaverManager?.destroy(); } catch (err) { this.log('warn', 'screensaverManager.destroy() failed', err); }\n    this.eventBinder.unbindAll();\n    this._partialLoaded = false;\n    if (this._hideTimeout) {\n      clearTimeout(this._hideTimeout);\n      this._hideTimeout = null;\n    }\n    // clear pending load ref to avoid holding Promise after destroy\n    this._loadPromise = undefined;\n    this._bound = false;\n\n    this.log('info', 'ScreensaverController destroyed');\n  }\n\n  private handleError(message: string, error: unknown): void {\n    eventBus.emit(\"screensaver:error\", { message, error });\n    this.onError?.(message, error);\n    this.log('error', message, error);\n  }\n}\n", "// src/spaceface/system/bin/DomReadyPromise.ts\n\nexport const VERSION = 'nextworld-1.3.0' as const;\n\nimport { WaitForElementOptions } from '../types/bin.js';\n\n/**\n * Utility class for DOM readiness and waiting for elements to appear.\n * Provides:\n * - A promise for when the DOM is ready (`DOMContentLoaded`).\n * - A helper to wait until specific elements are present in the DOM.\n */\nexport class DomReadyPromise {\n    /** Cached promise that resolves once the DOM is ready */\n    static #readyPromise: Promise<void> | null = null;\n\n    /**\n     * Returns a promise that resolves when the DOM is fully loaded.\n     */\n    static ready(): Promise<void> {\n        if (!this.#readyPromise) {\n            this.#readyPromise = document.readyState !== 'loading'\n                ? Promise.resolve()\n                : new Promise<void>(resolve => {\n                    document.addEventListener('DOMContentLoaded', () => resolve(), { once: true });\n                });\n        }\n        return this.#readyPromise;\n    }\n\n    /**\n     * Waits for one or more DOM elements to appear in the document.\n     */\n    static waitForElement<T extends Element>(\n        selectors: string | string[],\n        options: WaitForElementOptions = {}\n    ): Promise<T | T[]> {\n        const { timeout = 5000, root = document, signal } = options;\n        if (timeout <= 0) {\n            return Promise.reject(new TypeError('Timeout must be greater than 0'));\n        }\n\n        const selectorList = Array.isArray(selectors) ? selectors : [selectors];\n        const foundElements: Map<string, T> = new Map();\n\n        return new Promise((resolve, reject) => {\n            let timeoutId: number | undefined;\n            const checkForElements = () => {\n                for (const selector of selectorList) {\n                    if (!foundElements.has(selector)) {\n                        const el = root.querySelector<T>(selector);\n                        if (el) foundElements.set(selector, el);\n                    }\n                }\n                if (foundElements.size === selectorList.length) {\n                    cleanup();\n                    resolve(selectorList.length === 1\n                        ? foundElements.get(selectorList[0])!\n                        : Array.from(foundElements.values()));\n                }\n            };\n\n            const observer = new MutationObserver(checkForElements);\n\n            const cleanup = () => {\n                observer.disconnect();\n                if (timeoutId !== undefined) clearTimeout(timeoutId);\n                signal?.removeEventListener('abort', onAbort);\n            };\n\n            const onAbort = () => {\n                cleanup();\n                reject(new DOMException('waitForElement aborted', 'AbortError'));\n            };\n\n            if (signal?.aborted) return onAbort();\n            signal?.addEventListener('abort', onAbort, { once: true });\n\n            observer.observe(root, { childList: true, subtree: true });\n            // Check immediately in case elements already exist\n            checkForElements();\n\n            timeoutId = window.setTimeout(() => {\n                cleanup();\n                const missing = selectorList.filter(s => !foundElements.has(s));\n                reject(new DOMException(\n                    `Element(s) \"${missing.join(', ')}\" not found within ${timeout}ms in root: ${root.nodeName}`,\n                    'TimeoutError'\n                ));\n            }, timeout);\n        });\n    }\n}\n", "// src/spaceface/app/bin/symlinks.ts\n\nexport { DomReadyPromise } from \"../system/bin/DomReadyPromise.js\";\nexport { InactivityWatcher } from \"../system/bin/InactivityWatcher.js\";\nexport { eventBus } from \"../system/bin/EventBus.js\";\nexport { EventBinder } from \"../system/bin/EventBinder.js\";\nexport { EventWatcher } from \"../system/bin/EventWatcher.js\";\nexport { PartialFetcher } from \"../system/bin/PartialFetcher.js\";\nexport { PartialLoader } from \"../system/bin/PartialLoader.js\";\nexport { generateId } from \"../system/bin/generateId.js\";\nexport { ServiceWorkerManager } from \"../system/bin/ServiceWorkerManager.js\";\n\nexport type { FloatingImagesManagerInterface } from '../system/types/features.js';\n", "// src/spaceface/system/bin/generateId.ts\n\nexport const VERSION = 'nextworld-1.3.0' as const;\n\n/**\n * Generates a unique ID string with an optional prefix and length.\n *\n * @param prefix - The prefix for the ID (default: 'id').\n * @param length - The length of the random portion of the ID (default: 9).\n * @param useCrypto - Whether to use cryptographically secure random values (default: false).\n * @returns A unique ID string.\n */\nexport function generateId(prefix: string = 'id', length: number = 9, useCrypto: boolean = false): string {\n  if (!Number.isInteger(length) || length <= 0) {\n    throw new Error('Length must be a positive integer.');\n  }\n\n  const randomString = useCrypto\n    ? Array.from(crypto.getRandomValues(new Uint8Array(length)))\n        .map((byte) => (byte % 36).toString(36))\n        .join('')\n    : Math.random().toString(36).slice(2, 2 + length);\n\n  return `${prefix}-${randomString}`;\n}\n", "// src/spaceface/app/bin/spaceface.core.ts\n\nimport {\n    generateId,\n    eventBus,\n    DomReadyPromise,\n    InactivityWatcher,\n    ServiceWorkerManager,\n    FloatingImagesManagerInterface\n} from './symlink.js';\nimport type { LogPayload } from '../system/types/bin.js';\n\nexport interface AppConfigOptions {\n    features?: Record<string, any>;\n    debug?: boolean;\n    [key: string]: any;\n}\n\nexport class AppConfig {\n    public config: Record<string, any>;\n\n    constructor(options: AppConfigOptions = {}) {\n        this.config = {\n            hostname: window.location.hostname,\n            production:\n                window.location.hostname !== 'localhost' &&\n                !window.location.hostname.includes('127.0.0.1'),\n            features: options.features ?? {},\n            ...options,\n        };\n    }\n\n    public get(key: string): any {\n        return key.split('.').reduce((value: any, k: string) => {\n            if (value?.[k] === undefined) {\n                console.log(`[spaceface] Config key \"${key}\" is undefined`);\n                return undefined;\n            }\n            return value[k];\n        }, this.config);\n    }\n}\n\nexport class SpacefaceCore {\n    static EVENT_LOG = 'log';\n    static EVENT_TELEMETRY = 'telemetry';\n\n    public appConfig: AppConfig;\n    public debug: boolean;\n    public pageType: string;\n    public startTime: number;\n\n    private featureModules: Record<string, () => Promise<any>>;\n    private featureCache = new Map<string, any>();\n    private inactivityWatcher: InactivityWatcher | null = null;\n    private screensaverController: FloatingImagesManagerInterface | null = null;\n    private slideshows: any[] = [];\n    private swManager?: ServiceWorkerManager;\n    private _partialUnsub?: () => void;\n    private _partialObserver?: any;\n    private pjaxFeatures = new Map<string, { init: () => Promise<void> | void; when?: (pageType: string) => boolean }>();\n\n    constructor(options: AppConfigOptions = {}) {\n        this.appConfig = new AppConfig(options);\n        this.debug = !!this.appConfig.config.debug;\n        this.pageType = this.resolvePageType();\n        this.startTime = performance.now();\n\n        this.featureModules = {\n            partialLoader: () => import('../system/bin/PartialLoader.js'),\n            slideplayer: () => import('../system/features/SlidePlayer/SlidePlayer.js'),\n            screensaver: () => import('../system/features/Screensaver/ScreensaverController.js'),\n            serviceWorker: () => import('../system/bin/ServiceWorkerManager.js'),\n        };\n\n        if (!this.appConfig.config.features) {\n            this.log('warn', 'No features specified in config');\n        }\n    }\n\n    public log(level: 'debug' | 'info' | 'warn' | 'error', ...args: any[]): void {\n        if (!this.debug && level === 'debug') return;\n        const [first, ...rest] = args;\n        const message = typeof first === 'string' ? first : '';\n        const data = typeof first === 'string' ? (rest.length ? rest : undefined) : (args.length ? args : undefined);\n        const payload: LogPayload & { args: any[] } = {\n            level,\n            args,\n            scope: 'Spaceface',\n            message,\n            data,\n            time: Date.now(),\n        };\n        eventBus.emit(SpacefaceCore.EVENT_LOG, payload);\n        if (this.debug) {\n            console[level]?.(`[spaceface] [${level.toUpperCase()}]`, ...args);\n        }\n    }\n\n    private resolvePageType(): string {\n        const body = document.body;\n        if (body.dataset.page) return body.dataset.page;\n        const path = window.location.pathname;\n        return path === '/' ? 'home' : path === '/app' ? 'app' : 'default';\n    }\n\n    private async loadFeatureModule(name: string): Promise<any> {\n        if (this.featureCache.has(name)) return this.featureCache.get(name);\n        try {\n            const module = await this.featureModules[name]?.();\n            if (!module) {\n                throw new Error(`Module \"${name}\" could not be loaded.`);\n            }\n            this.featureCache.set(name, module);\n            return module;\n        } catch (err) {\n            this.log('error', `Failed to load module \"${name}\"`, err);\n            this.featureCache.set(name, null);\n            return null;\n        }\n    }\n\n    public async initBase(): Promise<void> {\n        this.log('info', `App initialization started (Page: ${this.pageType})`);\n        document.documentElement.classList.add('js-enabled', `page-${this.pageType}`);\n        await DomReadyPromise.ready();\n        this.log('info', 'DOM ready');\n    }\n\n    public finishInit(): void {\n        const duration = (performance.now() - this.startTime).toFixed(2);\n        this.log('info', `App initialized in ${duration}ms`);\n        eventBus.emit(SpacefaceCore.EVENT_TELEMETRY, {\n            type: 'init:duration',\n            value: duration,\n            page: this.pageType,\n        });\n    }\n\n    public async initInactivityWatcher(): Promise<void> {\n        const start = performance.now();\n        const screensaver = this.appConfig.config.features?.screensaver;\n        if (!screensaver || this.inactivityWatcher) {\n            this.emitFeatureTelemetry('inactivityWatcher', start, 'skipped');\n            return;\n        }\n        try {\n            this.inactivityWatcher = InactivityWatcher.getInstance({\n                inactivityDelay: screensaver.delay ?? 3000,\n            });\n            this.log('debug', `InactivityWatcher initialized with delay=${screensaver.delay ?? 3000}ms`);\n            this.emitFeatureTelemetry('inactivityWatcher', start, 'success');\n        } catch (error) {\n            this.emitFeatureTelemetry('inactivityWatcher', start, 'error', error);\n            throw error;\n        }\n    }\n\n    public async initSlidePlayer(): Promise<void> {\n        const start = performance.now();\n        const slideplayer = this.appConfig.config.features?.slideplayer;\n        if (!slideplayer) {\n            this.emitFeatureTelemetry('slideplayer', start, 'skipped');\n            return;\n        }\n        try {\n            const module = await this.loadFeatureModule('slideplayer');\n            const SlidePlayer = module?.SlidePlayer;\n            if (!SlidePlayer) {\n                this.emitFeatureTelemetry('slideplayer', start, 'skipped');\n                return;\n            }\n            this.slideshows = Array.from(document.querySelectorAll('.slideshow-container')).map(node => {\n                const slideshow = new SlidePlayer(node, {\n                    interval: slideplayer.interval ?? 5000,\n                    includePicture: slideplayer.includePicture ?? false,\n                });\n                slideshow.ready?.then?.(() => {});\n                return slideshow;\n            });\n            this.log('info', `${this.slideshows.length} SlidePlayer instance(s) loaded`);\n            this.emitFeatureTelemetry('slideplayer', start, 'success');\n        } catch (error) {\n            this.emitFeatureTelemetry('slideplayer', start, 'error', error);\n            throw error;\n        }\n    }\n\n    public async initScreensaver(): Promise<void> {\n        const start = performance.now();\n        const screensaver = this.appConfig.config.features?.screensaver;\n        if (!screensaver?.partialUrl) {\n            this.log('error', \"Screensaver configuration is missing or incomplete\");\n            this.emitFeatureTelemetry('screensaver', start, 'skipped');\n            return;\n        }\n        try {\n            const module = await this.loadFeatureModule('screensaver');\n            const ScreensaverController = module?.ScreensaverController;\n            if (!ScreensaverController) {\n                throw new Error('ScreensaverController module is unavailable.');\n            }\n            const id = generateId('screensaver', 9);\n            const container = Object.assign(document.createElement('div'), {\n                id,\n                style: 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 999; display: none;',\n            });\n            document.body.appendChild(container);\n            this.screensaverController = new ScreensaverController({\n                partialUrl: screensaver.partialUrl,\n                targetSelector: `#${id}`,\n                ...(screensaver.delay !== undefined && { inactivityDelay: screensaver.delay }),\n            });\n            await this.screensaverController?.init?.();\n            eventBus.emit('screensaver:initialized', id);\n            this.log('info', 'Screensaver initialized:', id);\n            this.emitFeatureTelemetry('screensaver', start, 'success');\n        } catch (error) {\n            this.log('error', 'Failed to initialize screensaver:', error);\n            this.emitFeatureTelemetry('screensaver', start, 'error', error);\n        }\n    }\n\n    public async initServiceWorker(): Promise<void> {\n        const start = performance.now();\n        if (!this.appConfig.config.features?.serviceWorker) {\n            this.emitFeatureTelemetry('serviceWorker', start, 'skipped');\n            return;\n        }\n        try {\n            const module = await this.loadFeatureModule('serviceWorker');\n            const Manager = module?.default;\n            if (!Manager) {\n                this.emitFeatureTelemetry('serviceWorker', start, 'skipped');\n                return;\n            }\n            this.swManager = new Manager('/sw.js', {}, {\n                strategy: { images: 'cache-first', others: 'network-first' },\n            });\n            if (this.swManager) {\n                await this.swManager.register();\n                this.swManager.configure();\n                this.log('info', 'Service Worker registered and configured');\n                this.emitFeatureTelemetry('serviceWorker', start, 'success');\n            }\n        } catch (error) {\n            this.emitFeatureTelemetry('serviceWorker', start, 'error', error);\n            throw error;\n        }\n    }\n\n    public async initPartialLoader(): Promise<any> {\n        const start = performance.now();\n        const config = this.appConfig.config.features?.partialLoader;\n        if (!config?.enabled) {\n            this.emitFeatureTelemetry('partialLoader', start, 'skipped');\n            return null;\n        }\n        try {\n            const module = await this.loadFeatureModule('partialLoader');\n            const PartialLoader = module?.PartialLoader;\n            if (!PartialLoader) {\n                this.emitFeatureTelemetry('partialLoader', start, 'skipped');\n                return null;\n            }\n            const loader = new PartialLoader({\n                debug: config.debug ?? this.debug,\n                baseUrl: config.baseUrl ?? '/',\n                cacheEnabled: config.cacheEnabled ?? true,\n            });\n            await loader.loadContainer(document);\n            const watchResult = loader.watch?.(document);\n            if (typeof watchResult === 'function') {\n                this._partialUnsub = watchResult;\n            } else {\n                this._partialObserver = watchResult;\n            }\n            this.log('info', 'PartialLoader initialized');\n            this.emitFeatureTelemetry('partialLoader', start, 'success');\n            return loader;\n        } catch (error) {\n            this.emitFeatureTelemetry('partialLoader', start, 'error', error);\n            throw error;\n        }\n    }\n\n    public async initDomFeatures(): Promise<void> {\n        await this.initSlidePlayer();\n    }\n\n    public async initOnceFeatures(): Promise<void> {\n        const initTasks = [\n            this.initInactivityWatcher(),\n            this.initScreensaver(),\n            this.initServiceWorker(),\n        ];\n        await Promise.allSettled(initTasks);\n        this.log('info', `Page features initialized for: ${this.pageType}`);\n    }\n\n    public registerPjaxFeature(\n        name: string,\n        init: () => Promise<void> | void,\n        when?: (pageType: string) => boolean\n    ): void {\n        if (this.pjaxFeatures.has(name)) return;\n        this.pjaxFeatures.set(name, { init, when });\n    }\n\n    public async handlePjaxComplete(): Promise<void> {\n        this.pageType = this.resolvePageType();\n        document.documentElement.classList.add(`page-${this.pageType}`);\n\n        this.slideshows.forEach(slideshow => slideshow.destroy?.());\n        this.slideshows = [];\n\n        for (const { init, when } of this.pjaxFeatures.values()) {\n            if (when && !when(this.pageType)) continue;\n            await init();\n        }\n    }\n\n    public destroy(): void {\n        this._partialUnsub?.();\n        this._partialObserver?.disconnect?.();\n        this.slideshows.forEach(slideshow => slideshow.destroy?.());\n        this.inactivityWatcher?.destroy?.();\n        this.screensaverController?.destroy?.();\n        this.featureCache.clear();\n        document.querySelector('[id^=\"screensaver\"]')?.remove();\n        this.log('info', 'Spaceface destroyed, all resources released.');\n    }\n\n    private emitFeatureTelemetry(\n        feature: string,\n        startTime: number,\n        status: 'success' | 'skipped' | 'error',\n        error?: unknown\n    ): void {\n        const duration = (performance.now() - startTime).toFixed(2);\n        eventBus.emit(SpacefaceCore.EVENT_TELEMETRY, {\n            type: 'feature:init',\n            feature,\n            status,\n            duration,\n            page: this.pageType,\n            error,\n        });\n    }\n}\n", "// Minimal PJAX implementation (no dependencies)\n\ntype PjaxOptions = {\n    containerSelector?: string;\n    linkSelector?: string;\n    scrollToTop?: boolean;\n    cache?: boolean;\n};\n\ntype CachedEntry = {\n    title: string;\n    html: string;\n    url: string;\n};\n\nexport class Pjax {\n    private containerSelector: string;\n    private linkSelector: string;\n    private scrollToTop: boolean;\n    private cacheEnabled: boolean;\n    private cache = new Map<string, CachedEntry>();\n    private currentRequest?: AbortController;\n\n    constructor(options: PjaxOptions = {}) {\n        this.containerSelector = options.containerSelector ?? '[data-pjax=\"container\"]';\n        this.linkSelector = options.linkSelector ?? 'a[href]';\n        this.scrollToTop = options.scrollToTop ?? true;\n        this.cacheEnabled = options.cache ?? true;\n    }\n\n    init(): void {\n        document.addEventListener('click', this.onClick, true);\n        window.addEventListener('popstate', this.onPopState);\n    }\n\n    destroy(): void {\n        document.removeEventListener('click', this.onClick, true);\n        window.removeEventListener('popstate', this.onPopState);\n        this.currentRequest?.abort();\n        this.currentRequest = undefined;\n    }\n\n    private onClick = (event: MouseEvent) => {\n        if (event.defaultPrevented) return;\n        if (event.button !== 0) return;\n        if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) return;\n\n        const target = event.target as Element | null;\n        const link = target?.closest?.(this.linkSelector) as HTMLAnchorElement | null;\n        if (!link) return;\n        if (link.hasAttribute('download')) return;\n        if (link.getAttribute('rel') === 'external') return;\n        if (link.target && link.target !== '_self') return;\n        if (link.dataset.noPjax !== undefined) return;\n\n        const href = link.href;\n        if (!href) return;\n\n        const url = new URL(href, window.location.href);\n        if (url.origin !== window.location.origin) return;\n\n        // Same-page hash only: let browser handle\n        if (url.pathname === window.location.pathname && url.search === window.location.search && url.hash) {\n            return;\n        }\n\n        event.preventDefault();\n        void this.load(url.toString(), true);\n    };\n\n    private onPopState = () => {\n        void this.load(window.location.href, false);\n    };\n\n    async load(url: string, pushState: boolean): Promise<void> {\n        const container = document.querySelector<HTMLElement>(this.containerSelector);\n        if (!container) {\n            document.dispatchEvent(new CustomEvent('pjax:error', { detail: { url, error: new Error('PJAX container not found') } }));\n            window.location.href = url;\n            return;\n        }\n\n        this.currentRequest?.abort();\n        const controller = new AbortController();\n        this.currentRequest = controller;\n        const requestToken = controller;\n\n        container.setAttribute('data-pjax-loading', 'true');\n        document.dispatchEvent(new CustomEvent('pjax:before', { detail: { url } }));\n\n        try {\n            const cached = this.cacheEnabled ? this.cache.get(url) : undefined;\n            let title: string;\n            let html: string;\n\n            if (cached) {\n                ({ title, html } = cached);\n            } else {\n                const res = await fetch(url, {\n                    method: 'GET',\n                    headers: { 'X-PJAX': 'true' },\n                    signal: controller.signal,\n                    credentials: 'same-origin',\n                });\n                if (!res.ok) throw new Error(`PJAX HTTP ${res.status}`);\n                const text = await res.text();\n                const parsed = new DOMParser().parseFromString(text, 'text/html');\n                const nextContainer = parsed.querySelector<HTMLElement>(this.containerSelector);\n                if (!nextContainer) throw new Error(`PJAX container \"${this.containerSelector}\" not found`);\n\n                title = parsed.title || document.title;\n                html = nextContainer.innerHTML;\n\n                if (this.cacheEnabled) {\n                    this.cache.set(url, { title, html, url });\n                }\n            }\n\n            // Ensure only the latest request can update the DOM\n            if (this.currentRequest !== requestToken) return;\n\n            // Note: scripts inside the swapped HTML will not execute automatically.\n            container.innerHTML = html;\n            document.title = title;\n\n            if (pushState) {\n                history.pushState({ pjax: true }, '', url);\n            }\n\n            if (this.scrollToTop) {\n                window.scrollTo({ top: 0, left: 0, behavior: 'auto' });\n            }\n\n            document.dispatchEvent(new CustomEvent('pjax:complete', { detail: { url } }));\n        } catch (error) {\n            if ((error as any)?.name !== 'AbortError') {\n                document.dispatchEvent(new CustomEvent('pjax:error', { detail: { url, error } }));\n                window.location.href = url;\n            }\n        } finally {\n            container.removeAttribute('data-pjax-loading');\n        }\n    }\n}\n\nexport function initPjax(options: PjaxOptions = {}): Pjax {\n    const pjax = new Pjax(options);\n    pjax.init();\n    return pjax;\n}\n", "// src/spaceface/app/bin/main.pjax.ts\n\nimport { SpacefaceCore } from './spaceface.core.js';\nimport { initPjax } from './pjax.js';\n\n// Initialize App (PJAX-enabled)\nconst app = new SpacefaceCore({\n    features: {\n        partialLoader: { enabled: true, debug: true, baseUrl: '/', cacheEnabled: true },\n        slideplayer: { interval: 5000, includePicture: false },\n        screensaver: { delay: 4500, partialUrl: 'content/feature/screensaver/index.html' },\n        serviceWorker: true,\n    },\n});\n\napp.initBase().then(async () => {\n    // Register DOM-dependent features to re-run after PJAX swaps\n    app.registerPjaxFeature('slideplayer', () => app.initSlidePlayer());\n\n    await app.initPartialLoader();\n    await app.initDomFeatures();\n    await app.initOnceFeatures();\n    app.finishInit();\n\n    initPjax({ containerSelector: '[data-pjax=\"container\"]' });\n    document.addEventListener('pjax:complete', () => {\n        void app.handlePjaxComplete();\n    });\n});\n\nwindow.addEventListener('beforeunload', () => {\n    app.destroy();\n    app.log('info', 'App destroyed on beforeunload');\n});\n"],
  "mappings": "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",
  "names": ["EventBus", "eventBus", "init_EventBus", "__esmMin", "enable", "event", "fn", "priority", "list", "listener", "i", "wrapper", "payload", "l", "err", "anyList", "results", "message", "error", "EventWatcher", "init_EventWatcher", "__esmMin", "init_EventBus", "target", "debug", "levelOrMessage", "messageOrData", "data", "level", "message", "payload", "logPayload", "eventBus", "method", "logKey", "sanitizedPayload", "error", "err", "type", "handler", "options", "e", "createTimeout", "id", "fn", "ms", "debounce", "func", "delay", "immediate", "timer", "debounced", "args", "callNow", "throttle", "options", "leading", "trailing", "lastCall", "lastArgs", "lastThis", "invoke", "throttled", "now", "remaining", "init_timing", "__esmMin", "InactivityWatcher", "init_InactivityWatcher", "__esmMin", "init_EventWatcher", "init_EventBus", "init_timing", "_InactivityWatcher", "EventWatcher", "target", "options", "throttle", "now", "eventBus", "EventLogger", "init_EventLogger", "__esmMin", "init_EventBus", "scope", "devMode", "level", "levels", "currentLevelIndex", "message", "data", "entry", "eventBus", "error", "method", "prefix", "msg", "EventBinder", "eventBinder", "init_EventBinder", "__esmMin", "init_EventBus", "init_EventLogger", "_EventBinder", "debug", "EventLogger", "method", "details", "payload", "error", "signal", "listener", "enable", "event", "handler", "b", "unsubscribe", "eventBus", "err", "target", "options", "controller", "normalizedOptions", "optionsEqual", "a", "i", "callback", "binder", "result", "PartialLoader_exports", "__export", "PartialLoader", "VERSION", "init_PartialLoader", "__esmMin", "init_timing", "init_EventBus", "options", "msg", "data", "logKey", "payload", "eventBus", "input", "items", "results", "item", "error", "url", "link", "src", "info", "container", "id", "fetchPromise", "html", "attempt", "controller", "timeoutId", "res", "err", "template", "div", "base", "resolvedUrl", "ms", "resolve", "links", "observer", "debounce", "PartialFetcher", "init_PartialFetcher", "__esmMin", "init_EventBus", "init_PartialLoader", "PartialLoader", "message", "data", "payload", "eventBus", "url", "targetSelector", "options", "loader", "container", "error", "urls", "activeLoader", "dummyContainer", "ServiceWorkerManager_exports", "__export", "ServiceWorkerManager", "VERSION", "init_ServiceWorkerManager", "__esmMin", "swPath", "options", "customConfig", "error", "newWorker", "message", "transfer", "sw", "timeout", "resolve", "reject", "timer", "handler", "event", "config", "AsyncImageLoader", "init_AsyncImageLoader", "__esmMin", "container", "options", "message", "data", "methodName", "selector", "images", "el", "includeFailed", "timeout", "results", "img", "resolve", "onLoad", "timer", "onError", "r", "sources", "picture", "source", "AnimationLoop", "animationLoop", "init_AnimationLoop", "__esmMin", "errorHandler", "callback", "cb", "err", "SlidePlayer_exports", "__export", "SlidePlayer", "VERSION", "init_SlidePlayer", "__esmMin", "init_EventBus", "init_EventBinder", "init_AsyncImageLoader", "init_AnimationLoop", "_SlidePlayer", "containerOrSelector", "interval", "includePicture", "dotsSelector", "autoCreateDots", "startPaused", "enableBusEvents", "autoplay", "debug", "AsyncImageLoader", "EventBinder", "err", "level", "message", "data", "payload", "eventBus", "container", "animationLoop", "now", "reason", "shouldPause", "nowPaused", "event", "index", "restart", "prevIndex", "_", "i", "dot", "prev", "ev", "dx", "dy", "direction", "type", "detail", "busEvent", "clamp", "init_math", "__esmMin", "value", "min", "max", "DAMPING", "MIN_VELOCITY", "MAX_SPEED", "VELOCITY_JITTER", "FloatingImage", "init_FloatingImage", "__esmMin", "init_math", "element", "dims", "options", "message", "data", "x", "y", "multiplier", "applyPosition", "signX", "clamp", "signY", "speedSquared", "scale", "PerformanceMonitor", "init_PerformanceMonitor", "__esmMin", "now", "delta", "currentFPS", "level", "settingsMap", "ResizeManager", "resizeManager", "init_ResizeManager", "__esmMin", "init_timing", "message", "data", "cb", "options", "debounce", "throttle", "wrappedCb", "handler", "el", "entry", "callbacks", "observer", "entries", "fn", "error", "rect", "FloatingImagesManager", "init_FloatingImagesManager", "__esmMin", "init_FloatingImage", "init_PerformanceMonitor", "init_ResizeManager", "init_AsyncImageLoader", "init_AnimationLoop", "init_EventBus", "init_timing", "container", "options", "PerformanceMonitor", "perfSettings", "entries", "entry", "AsyncImageLoader", "animationLoop", "level", "message", "data", "payload", "eventBus", "method", "resizeManager", "dims", "imgElements", "el", "err", "floatingImage", "FloatingImage", "debounce", "img", "error", "multiplier", "ScreensaverController_exports", "__export", "ScreensaverController", "VERSION", "init_ScreensaverController", "__esmMin", "init_EventBus", "init_EventBinder", "init_InactivityWatcher", "init_PartialFetcher", "init_FloatingImagesManager", "options", "PartialFetcher", "EventBinder", "level", "message", "data", "payload", "eventBus", "method", "InactivityWatcher", "error", "container", "FloatingImagesManager", "err", "DomReadyPromise", "#readyPromise", "resolve", "selectors", "options", "timeout", "root", "signal", "selectorList", "foundElements", "reject", "timeoutId", "checkForElements", "selector", "el", "cleanup", "observer", "onAbort", "missing", "s", "init_InactivityWatcher", "init_EventBus", "init_EventBinder", "init_EventWatcher", "init_PartialFetcher", "init_PartialLoader", "generateId", "prefix", "length", "useCrypto", "randomString", "byte", "init_ServiceWorkerManager", "AppConfig", "options", "key", "value", "k", "SpacefaceCore", "_SpacefaceCore", "level", "args", "first", "rest", "message", "data", "payload", "eventBus", "body", "path", "name", "module", "err", "DomReadyPromise", "duration", "start", "screensaver", "InactivityWatcher", "error", "slideplayer", "SlidePlayer", "node", "slideshow", "ScreensaverController", "id", "generateId", "container", "Manager", "config", "PartialLoader", "loader", "watchResult", "initTasks", "init", "when", "feature", "startTime", "status", "Pjax", "options", "event", "link", "href", "url", "pushState", "container", "controller", "requestToken", "cached", "title", "html", "res", "text", "parsed", "nextContainer", "error", "initPjax", "pjax", "app", "SpacefaceCore", "initPjax"]
}
