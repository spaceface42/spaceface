{
  "version": 3,
  "sources": ["../../src/system/bin/EventBus.ts", "../../src/system/bin/EventWatcher.ts", "../../src/system/features/bin/timing.ts", "../../src/system/types/events.ts", "../../src/system/bin/InactivityWatcher.ts", "../../src/system/bin/EventLogger.ts", "../../src/system/bin/EventBinder.ts", "../../src/system/bin/PartialLoader.ts", "../../src/system/bin/PartialFetcher.ts", "../../src/system/features/bin/AsyncImageLoader.ts", "../../src/system/features/bin/AnimationLoop.ts", "../../src/system/features/bin/AnimationPolicy.ts", "../../src/system/features/SlidePlayer/SlidePlayer.ts", "../../src/system/features/bin/ResizeManager.ts", "../../src/system/features/ScrollDeck/ScrollDeck.ts", "../../src/system/features/bin/math.ts", "../../src/system/features/FloatingImages/FloatingImage.ts", "../../src/system/features/bin/PerformanceMonitor.ts", "../../src/system/features/FloatingImages/FloatingImagesManager.ts", "../../src/system/features/Screensaver/ScreensaverController.ts", "../../src/app/pjax.ts", "../../src/app/config/features.ts", "../../src/system/bin/DomReadyPromise.ts", "../../src/app/symlink.ts", "../../src/system/bin/generateId.ts", "../../src/app/dev/devEventLogger.ts", "../../src/app/spaceface.core.ts", "../../src/app/startup.ts", "../../src/app/main.pjax.ts"],
  "sourcesContent": ["\nimport {\n    UnsubscribeFn,\n    ListenerInterface,\n    AnyListenerInterface,\n    EventBusInterface\n} from '../types/bin.js';\nimport type { SpacefaceEventMap } from '../types/events.js';\n\nexport class EventBus<TEvents extends Record<string, unknown> = Record<string, unknown>> implements EventBusInterface<TEvents> {\n    private listeners: Map<string, ListenerInterface[]> = new Map();\n    private anyListeners: AnyListenerInterface[] = [];\n    private onceWrappers = new WeakMap<(...args: unknown[]) => unknown, (...args: unknown[]) => unknown>();\n    private emittingError = false;\n    private debugMode = false; // Debug mode flag\n\n    /**\n     * Enable or disable debug mode.\n     * @param enable Set to true to enable debug mode, false to disable.\n     */\n    setDebugMode(enable: boolean): void {\n        this.debugMode = enable;\n        if (this.debugMode) {\n            console.debug(\"[EventBus] Debug mode enabled\");\n        }\n    }\n\n    /**\n     * Register an event listener.\n     * @param event The event name.\n     * @param fn The listener function.\n     * @param priority The priority of the listener.\n     * @returns A function to unsubscribe the listener.\n     */\n    on<K extends keyof TEvents>(event: K, fn: (payload: TEvents[K]) => unknown, priority?: number): UnsubscribeFn;\n    on<T = unknown>(event: string, fn: (payload: T) => unknown, priority?: number): UnsubscribeFn;\n    on<T = unknown>(event: string, fn: (payload: T) => unknown, priority = 0): UnsubscribeFn {\n        const list = this.listeners.get(event) ?? [];\n        const listener: ListenerInterface = { fn: fn as (...args: unknown[]) => unknown, priority };\n        let i = list.length;\n        while (i > 0 && list[i - 1].priority < priority) i--;\n        list.splice(i, 0, listener);\n        this.listeners.set(event, list);\n\n        if (this.debugMode) {\n            console.debug(`[EventBus] Listener added for event: ${event}`, { priority });\n        }\n\n        return () => this.off(event, fn as (...args: unknown[]) => unknown);\n    }\n\n    /**\n     * Register a one-time event listener.\n     * @param event The event name.\n     * @param fn The listener function.\n     * @param priority The priority of the listener.\n     * @returns A function to unsubscribe the listener.\n     */\n    once<K extends keyof TEvents>(event: K, fn: (payload: TEvents[K]) => unknown, priority?: number): UnsubscribeFn;\n    once<T = unknown>(event: string, fn: (payload: T) => unknown, priority?: number): UnsubscribeFn;\n    once<T = unknown>(event: string, fn: (payload: T) => unknown, priority = 0): UnsubscribeFn {\n        const wrapper = (payload: T) => {\n            this.off(event, wrapper as (...args: unknown[]) => unknown);\n            fn(payload);\n        };\n        this.onceWrappers.set(fn as (...args: unknown[]) => unknown, wrapper as (...args: unknown[]) => unknown);\n        this.on(event, wrapper, priority);\n        return () => this.off(event, fn as (...args: unknown[]) => unknown);\n    }\n\n    /**\n     * Remove an event listener.\n     * @param event The event name.\n     * @param fn The listener function to remove.\n     */\n    off(event: string, fn: (...args: unknown[]) => unknown): void {\n        const list = this.listeners.get(event);\n        if (!list) return;\n        const wrapper = this.onceWrappers.get(fn) ?? fn;\n        this.listeners.set(event, list.filter(l => l.fn !== wrapper));\n\n        if (this.debugMode) {\n            console.debug(`[EventBus] Listener removed for event: ${event}`);\n        }\n    }\n\n    /**\n     * Check if there are listeners for a specific event.\n     * @param event The event name.\n     * @returns True if there are listeners, false otherwise.\n     */\n    hasListeners(event: string): boolean {\n        return event === \"any\"\n            ? this.anyListeners.length > 0\n            : (this.listeners.get(event)?.length ?? 0) > 0;\n    }\n\n    /**\n     * Register a listener for any event.\n     * @param fn The listener function.\n     * @param priority The priority of the listener.\n     * @returns A function to unsubscribe the listener.\n     */\n    onAny(fn: (event: keyof TEvents & string, payload: TEvents[keyof TEvents]) => unknown, priority = 0): UnsubscribeFn {\n        const listener: AnyListenerInterface = { fn: fn as (...args: unknown[]) => unknown, priority };\n        let i = this.anyListeners.length;\n        while (i > 0 && this.anyListeners[i - 1].priority < priority) i--;\n        this.anyListeners.splice(i, 0, listener);\n\n        if (this.debugMode) {\n            console.debug(\"[EventBus] Listener added for any event\", { priority });\n        }\n\n        return () => this.offAny(fn as (...args: unknown[]) => unknown);\n    }\n\n    /**\n     * Remove a listener for any event.\n     * @param fn The listener function to remove.\n     */\n    offAny(fn: (...args: unknown[]) => unknown): void {\n        this.anyListeners = this.anyListeners.filter(l => l.fn !== fn);\n\n        if (this.debugMode) {\n            console.debug(\"[EventBus] Listener removed for any event\");\n        }\n    }\n\n    /**\n     * Emit an event to all registered listeners.\n     * @param event The event name.\n     * @param payload The event payload.\n     */\n    emit<K extends keyof TEvents>(event: K, payload?: TEvents[K]): void;\n    emit<T = unknown>(event: string, payload?: T): void;\n    emit<T = unknown>(event: string, payload?: T): void {\n        if (!event) {\n            this._handleError(\"Event name is undefined or empty\", new Error());\n            return;\n        }\n\n        if (this.debugMode) {\n            console.debug(`[EventBus] Emitting event: ${event}`, payload);\n        }\n\n        const list = [...(this.listeners.get(event) ?? [])];\n        for (const l of list) {\n            try {\n                l.fn(payload);\n            } catch (err) {\n                this._handleError(`Error in listener for \"${event}\"`, err);\n            }\n        }\n\n        const anyList = [...this.anyListeners];\n        for (const l of anyList) {\n            try {\n                l.fn(event, payload);\n            } catch (err) {\n                this._handleError(`Error in any-listener for \"${event}\"`, err);\n            }\n        }\n    }\n\n    /**\n     * Emit an event asynchronously to all registered listeners.\n     * @param event The event name.\n     * @param payload The event payload.\n     * @returns A promise that resolves with the results of all listeners.\n     */\n    async emitAsync<K extends keyof TEvents>(event: K, payload?: TEvents[K]): Promise<unknown[]>;\n    async emitAsync<T = unknown>(event: string, payload?: T): Promise<unknown[]>;\n    async emitAsync<T = unknown>(event: string, payload?: T): Promise<unknown[]> {\n        if (!event) {\n            this._handleError(\"Event name is undefined or empty\", new Error());\n            return [];\n        }\n\n        const results: unknown[] = [];\n        const list = [...(this.listeners.get(event) ?? [])];\n        for (const l of list) {\n            try {\n                results.push(await l.fn(payload));\n            } catch (err) {\n                this._handleError(`Async error in listener for \"${event}\"`, err);\n            }\n        }\n\n        const anyList = [...this.anyListeners];\n        for (const l of anyList) {\n            try {\n                results.push(await l.fn(event, payload));\n            } catch (err) {\n                this._handleError(`Async error in any-listener for \"${event}\"`, err);\n            }\n        }\n\n        return results;\n    }\n\n    /**\n     * Remove all listeners for a specific event or all events.\n     * @param event The event name. If omitted, all listeners are removed.\n     */\n    removeAllListeners(event?: string): void {\n        if (!event) {\n            this.listeners.clear();\n            this.anyListeners = [];\n        } else if (event === \"any\") {\n            this.anyListeners = [];\n        } else {\n            this.listeners.delete(event);\n        }\n\n        if (this.debugMode) {\n            console.debug(`[EventBus] All listeners removed for event: ${event ?? \"all\"}`);\n        }\n    }\n\n    /**\n     * Get the number of listeners for a specific event.\n     * @param event The event name.\n     * @returns The number of listeners.\n     */\n    listenerCount(event: string): number {\n        return event === \"any\"\n            ? this.anyListeners.length\n            : (this.listeners.get(event)?.length ?? 0);\n    }\n\n    /**\n     * Get the names of all events with registered listeners.\n     * @returns An array of event names.\n     */\n    eventNames(): string[] {\n        return Array.from(this.listeners.keys()).filter(event => (this.listeners.get(event)?.length ?? 0) > 0);\n    }\n\n    /**\n     * Get all listeners for a specific event.\n     * @param event The event name.\n     * @returns An array of listener functions.\n     */\n    getListeners(event: string): Array<(...args: unknown[]) => unknown> {\n        return event === \"any\"\n            ? this.anyListeners.map(l => l.fn)\n            : (this.listeners.get(event) ?? []).map(l => l.fn);\n    }\n\n    /**\n     * Handle errors during event emission.\n     * @param message The error message.\n     * @param error The error object.\n     */\n    private _handleError(message: string, error: unknown): void {\n        if (this.emittingError) return;\n        this.emittingError = true;\n\n        console.error(`[EventBus] ${message}`, error);\n\n        this.emittingError = false;\n    }\n}\n\nexport const eventBus = new EventBus<SpacefaceEventMap>();\n", "// src/spaceface/system/bin/EventWatcher.ts\n\nimport { eventBus } from \"./EventBus.js\";\nimport type { LogPayload } from \"../types/bin.js\";\n\ntype EventTargetLike = EventTarget & {\n    addEventListener: (type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions) => void;\n    removeEventListener: (type: string, listener: EventListenerOrEventListenerObject, options?: boolean | EventListenerOptions) => void;\n};\n\nexport abstract class EventWatcher {\n    protected readonly target: EventTarget;\n    protected readonly debug: boolean;\n    protected destroyed = false;\n\n    // DOM listeners storage (use Set to avoid duplicates)\n    private domListeners = new Set<{\n        type: string;\n        handler: EventListenerOrEventListenerObject;\n        options?: boolean | AddEventListenerOptions;\n    }>();\n\n    // To deduplicate log:debug messages\n    private loggedMessages = new Set<string>();\n\n    constructor(target: EventTarget, debug: boolean = false) {\n        // Use duck-typing so code runs in environments where EventTarget isn't constructible\n        const maybeTarget = target as Partial<EventTargetLike>;\n        if (!target || typeof maybeTarget.addEventListener !== \"function\" || typeof maybeTarget.removeEventListener !== \"function\") {\n            throw new Error(`${this.constructor.name}: target must be a valid EventTarget.`);\n        }\n        this.target = target;\n        this.debug = debug;\n    }\n\n    /**\n     * Centralized logging with support for debug mode.\n     */\n    protected log(levelOrMessage: 'debug' | 'info' | 'warn' | 'error' | string, messageOrData?: unknown, data?: unknown) {\n        // If first arg is a recognized level and second arg is a string -> new form\n        const levels = ['debug', 'info', 'warn', 'error'];\n        if (typeof levelOrMessage === 'string' && levels.includes(levelOrMessage) && typeof messageOrData === 'string') {\n            const level = levelOrMessage as 'debug' | 'info' | 'warn' | 'error';\n            const message = messageOrData as string;\n            const payload = data;\n            if (!this.debug && level === 'debug') return;\n            try {\n                const logPayload: LogPayload = {\n                    scope: this.constructor.name,\n                    level,\n                    message,\n                    data: payload,\n                    time: Date.now(),\n                };\n                eventBus.emit(\"log\", logPayload);\n            } catch { /* ignore eventBus errors */ }\n            if (this.debug) {\n                switch (level) {\n                    case 'debug':\n                        console.debug(`[${this.constructor.name}] [${level.toUpperCase()}]`, message, payload);\n                        break;\n                    case 'info':\n                        console.info(`[${this.constructor.name}] [${level.toUpperCase()}]`, message, payload);\n                        break;\n                    case 'warn':\n                        console.warn(`[${this.constructor.name}] [${level.toUpperCase()}]`, message, payload);\n                        break;\n                    case 'error':\n                        console.error(`[${this.constructor.name}] [${level.toUpperCase()}]`, message, payload);\n                        break;\n                }\n            }\n            return;\n        }\n\n        // Backward-compatible form: log(message, data?)\n        const message = levelOrMessage as string;\n        const payload = messageOrData;\n        if (!this.debug) return;\n        let logKey: string;\n        try {\n            logKey = `${message}-${JSON.stringify(payload)}`;\n        } catch {\n            logKey = `${message}-[unserializable]`;\n        }\n        if (!this.loggedMessages.has(logKey)) {\n            this.loggedMessages.add(logKey);\n            try {\n                const sanitizedPayload = payload && typeof payload === 'object' ? JSON.parse(JSON.stringify(payload)) : payload;\n                const logPayload: LogPayload = {\n                    scope: this.constructor.name,\n                    level: 'debug',\n                    message,\n                    data: sanitizedPayload,\n                    time: Date.now(),\n                };\n                eventBus.emit(\"log:debug\", logPayload);\n            } catch (error) {\n                console.warn(\"Failed to log debug event\", { message, payload, error });\n            }\n        }\n        console.debug(`[${this.constructor.name}] [DEBUG]`, message, payload);\n    }\n\n    protected checkDestroyed() {\n        if (this.destroyed) {\n            throw new Error(`${this.constructor.name} has been destroyed.`);\n        }\n    }\n\n    public destroy() {\n        if (this.destroyed) return;\n        this.log('info', \"Destroying watcher\");\n        try {\n            this.removeAllDomListeners();\n            this.removeEventListeners();\n        } catch (err) {\n            // ensure we mark destroyed and surface debug info without throwing\n            this.log('error', \"Error while destroying watcher\", err);\n        } finally {\n            this.destroyed = true;\n        }\n    }\n\n    /**\n     * Add a DOM listener and store it for later removal.\n     */\n    protected addDomListener(type: string, handler: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions) {\n        if (this.destroyed) return;\n        this.target.addEventListener(type, handler, options);\n        this.domListeners.add({ type, handler, options });\n        if (this.debug) {\n            this.log('debug', `Added DOM listener`, { type, handler, options });\n        }\n    }\n\n    /**\n     * Remove all stored DOM listeners.\n     */\n    protected removeAllDomListeners() {\n        for (const { type, handler, options } of this.domListeners) {\n            try {\n                this.target.removeEventListener(type, handler, options as boolean | EventListenerOptions | undefined);\n                if (this.debug) {\n                    this.log('debug', `Removed DOM listener`, { type, handler });\n                }\n            } catch (e) {\n                this.log('warn', `Failed to remove DOM listener`, { type, handler, error: e });\n            }\n        }\n        this.domListeners.clear();\n    }\n\n    /** Must be implemented by subclasses */\n    protected abstract addEventListeners(): void;\n    protected abstract removeEventListeners(): void;\n}\n", "// src/spaceface/system/features/bin/timing.ts\n\n\n/** Generic type: function with cancel method */\nexport type CancellableFunction<T> = T & { cancel: () => void };\n\n/** Internal helper: manages a timeout with cancel support */\nfunction createTimeout(): { id: number | null; set: (fn: () => void, ms: number) => void; cancel: () => void } {\n  let id: number | null = null;\n\n  return {\n    get id() { return id; },\n    set(fn: () => void, ms: number) {\n      if (id !== null) clearTimeout(id);\n      id = window.setTimeout(() => {\n        id = null;\n        fn();\n      }, ms);\n    },\n    cancel() {\n      if (id !== null) {\n        clearTimeout(id);\n        id = null;\n      }\n    },\n  };\n}\n\n/**\n * Creates a debounced function that delays invoking `func` until after `delay` ms\n * have elapsed since the last call. Includes error handling for invalid inputs.\n *\n * @param func - The function to debounce.\n * @param delay - The number of milliseconds to delay.\n * @param immediate - If `true`, trigger the function on the leading edge.\n * @returns A debounced function with a `cancel` method.\n */\nexport function debounce<Args extends unknown[]>(\n  func: (...args: Args) => void,\n  delay = 300,\n  immediate = false\n): CancellableFunction<(...args: Args) => void> {\n  if (typeof func !== 'function') {\n    throw new TypeError('Expected a function for debounce');\n  }\n  if (typeof delay !== 'number' || delay < 0) {\n    throw new TypeError('Expected a non-negative number for delay');\n  }\n\n  const timer = createTimeout();\n\n  function debounced(...args: Args) {\n    const callNow = immediate && timer.id === null;\n\n    timer.set(() => {\n      if (!immediate) func(...args);\n    }, delay);\n\n    if (callNow) func(...args);\n  }\n\n  debounced.cancel = () => timer.cancel();\n\n  return debounced;\n}\n\n/**\n * Creates a throttled function that invokes `func` at most once per `delay` ms.\n * Includes error handling for invalid inputs.\n *\n * @param func - The function to throttle.\n * @param delay - The number of milliseconds to throttle calls.\n * @param options - Options to control leading and trailing edge calls.\n * @returns A throttled function with a `cancel` method.\n */\nexport function throttle<Args extends unknown[]>(\n  func: (...args: Args) => void,\n  delay = 100,\n  options: { leading?: boolean; trailing?: boolean } = {}\n): CancellableFunction<(...args: Args) => void> {\n  if (typeof func !== 'function') {\n    throw new TypeError('Expected a function for throttle');\n  }\n  if (typeof delay !== 'number' || delay < 0) {\n    throw new TypeError('Expected a non-negative number for delay');\n  }\n\n  const { leading = true, trailing = true } = options;\n  let lastCall = 0;\n  let lastArgs: Args | null = null;\n  const timer = createTimeout();\n\n  function invoke() {\n    lastCall = leading ? Date.now() : 0;\n    if (!lastArgs) return;\n    func(...lastArgs);\n    lastArgs = null;\n  }\n\n  function throttled(...args: Args) {\n    const now = Date.now();\n    if (lastCall === 0 && !leading) lastCall = now;\n\n    lastArgs = args;\n\n    const remaining = delay - (now - lastCall);\n\n    if (remaining <= 0 || remaining > delay) {\n      timer.cancel();\n      invoke();\n    } else if (timer.id === null && trailing) {\n      timer.set(() => {\n        if (trailing && lastArgs) invoke();\n      }, remaining);\n    }\n  }\n\n  throttled.cancel = () => {\n    timer.cancel();\n    lastCall = 0;\n    lastArgs = null;\n  };\n\n  return throttled;\n}\n", "import type { LogPayload, PartialEventPayload } from './bin.js';\n\nexport const EVENTS = {\n  LOG: 'log',\n  LOG_DEBUG: 'log:debug',\n  LOG_ERROR: 'log:error',\n  TELEMETRY: 'telemetry',\n  USER_ACTIVE: 'user:active',\n  USER_INACTIVE: 'user:inactive',\n  SCREENSAVER_INITIALIZED: 'screensaver:initialized',\n  SCREENSAVER_SHOWN: 'screensaver:shown',\n  SCREENSAVER_HIDDEN: 'screensaver:hidden',\n  SCREENSAVER_ERROR: 'screensaver:error',\n  SCREENSAVER_LOG: 'screensaver:log',\n  SLIDEPLAYER_LOG: 'slideplayer:log',\n  FLOATING_IMAGES_LOG: 'floatingImages:log',\n  PARTIAL_LOADED: 'partial:loaded',\n  PARTIAL_ERROR: 'partial:error',\n  PARTIAL_LOAD_COMPLETE: 'partial:load:complete',\n  PARTIALS_ALL_LOADED: 'partials:allLoaded',\n} as const;\n\nexport interface TelemetryPayload {\n  type: string;\n  feature?: string;\n  status?: 'success' | 'skipped' | 'error';\n  duration?: string;\n  value?: string;\n  page?: string;\n  error?: unknown;\n}\n\nexport interface UserActivityPayload {\n  lastActiveAt: number;\n  inactivityDelay: number;\n  visible: boolean;\n  inactiveAt?: number;\n}\n\nexport interface ScreensaverVisibilityPayload {\n  targetSelector: string;\n}\n\nexport interface ScreensaverErrorPayload {\n  message: string;\n  error: unknown;\n}\n\nexport interface SpacefaceEventMap {\n  log: LogPayload;\n  'log:debug': LogPayload;\n  'log:error': unknown;\n  telemetry: TelemetryPayload;\n  'user:active': UserActivityPayload;\n  'user:inactive': UserActivityPayload;\n  'screensaver:initialized': string;\n  'screensaver:shown': ScreensaverVisibilityPayload;\n  'screensaver:hidden': ScreensaverVisibilityPayload;\n  'screensaver:error': ScreensaverErrorPayload;\n  'screensaver:log': { level: 'debug' | 'info' | 'warn' | 'error'; message: string; data?: unknown };\n  'slideplayer:log': { level: 'debug' | 'info' | 'warn' | 'error'; message: string; data?: unknown };\n  'floatingImages:log': { level: 'debug' | 'info' | 'warn' | 'error'; message: string; data?: unknown };\n  'partial:loaded': PartialEventPayload;\n  'partial:error': PartialEventPayload;\n  'partial:load:complete': PartialEventPayload;\n  'partials:allLoaded': PartialEventPayload;\n  [event: string]: unknown;\n}\n", "// src/spaceface/system/bin/InactivityWatcher.ts\n\n\nimport { EventWatcher } from './EventWatcher.js';\nimport { eventBus } from './EventBus.js';\nimport { throttle } from '../features/bin/timing.js';\nimport { EVENTS } from '../types/events.js';\n\nexport interface InactivityWatcherOptionsInterface {\n    inactivityDelay: number;\n    debug?: boolean;\n    target?: EventTarget;\n}\n\nexport class InactivityWatcher extends EventWatcher {\n    private static _instance: InactivityWatcher | null = null;\n\n    private inactivityDelay: number;\n    private lastActiveAt: number;\n    private timer?: number;\n    private userIsInactive: boolean = false;\n    private throttledReset: () => void;\n\n    /**\n     * Private constructor to enforce singleton pattern.\n     * @param target The target to monitor for activity.\n     * @param options Configuration options for the watcher.\n     */\n    private constructor(target: EventTarget, options: InactivityWatcherOptionsInterface) {\n        super(target, options.debug ?? false);\n        this.inactivityDelay = options.inactivityDelay;\n        this.lastActiveAt = Date.now();\n        this.throttledReset = throttle(() => this.resetTimer(), 200);\n\n        this.log(`Initialized with inactivityDelay=${this.inactivityDelay}ms`);\n        this.addEventListeners();\n    }\n\n    /**\n     * Get the singleton instance of the InactivityWatcher.\n     * @param options Configuration options for the watcher.\n     * @returns The singleton instance.\n     */\n    static getInstance(options: InactivityWatcherOptionsInterface): InactivityWatcher {\n        if (!this._instance) {\n            this._instance = new InactivityWatcher(options.target ?? document, options);\n        }\n        return this._instance;\n    }\n\n    /**\n     * Add event listeners to monitor user activity.\n     */\n    protected addEventListeners(): void {\n        this.addDomListener('mousemove', this.throttledReset);\n        this.addDomListener('keydown', this.throttledReset);\n        this.addDomListener('scroll', this.throttledReset);\n        this.addDomListener('visibilitychange', this.throttledReset);\n\n        this.resetTimer();\n    }\n\n    /**\n     * Remove all event listeners and clear the timer.\n     */\n    protected removeEventListeners(): void {\n        this.removeAllDomListeners();\n\n        if (this.timer) {\n            clearTimeout(this.timer);\n            this.timer = undefined;\n        }\n    }\n\n    /**\n     * Reset the inactivity timer and emit an active event if the user was inactive.\n     */\n    private resetTimer(): void {\n        const now = Date.now();\n        this.lastActiveAt = now;\n\n        if (this.userIsInactive) {\n            this.userIsInactive = false;\n            eventBus.emit(EVENTS.USER_ACTIVE, {\n                lastActiveAt: this.lastActiveAt,\n                inactivityDelay: this.inactivityDelay,\n                visible: document.visibilityState === 'visible',\n            });\n            this.log('User is active');\n        }\n\n        if (this.timer) clearTimeout(this.timer);\n        this.timer = window.setTimeout(() => this.setInactive(), this.inactivityDelay);\n    }\n\n    /**\n     * Mark the user as inactive and emit an inactive event.\n     */\n    private setInactive(): void {\n        this.userIsInactive = true;\n        const now = Date.now();\n        eventBus.emit(EVENTS.USER_INACTIVE, {\n            lastActiveAt: this.lastActiveAt,\n            inactiveAt: now,\n            inactivityDelay: this.inactivityDelay,\n            visible: document.visibilityState === 'visible',\n        });\n        this.log('User is inactive');\n    }\n}\n", "// src/system/bin/EventLogger.ts\n\nimport { eventBus } from '../bin/EventBus.js';\n\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error' | 'event';\n\nexport interface LogEntry {\n  level: LogLevel;\n  scope: string;\n  message: string;\n  data?: unknown;\n  time: number;\n}\n\nexport class EventLogger {\n  private scope: string;\n  private devMode: boolean;\n  private fallbackLogs: LogEntry[] = []; // Fallback storage for logs\n\n  constructor(scope: string, devMode: boolean = true) {\n    this.scope = scope;\n    this.devMode = devMode;\n  }\n\n  /**\n   * Filters logs based on the configured log level.\n   * Suppresses logs below the specified level in production.\n   */\n  private shouldLog(level: LogLevel): boolean {\n    const levels = ['debug', 'info', 'event', 'warn', 'error'];\n    const currentLevelIndex = levels.indexOf(this.devMode ? 'debug' : 'warn');\n    const logLevelIndex = levels.indexOf(level);\n    return logLevelIndex >= currentLevelIndex;\n  }\n\n  /**\n   * Log a message with the specified level.\n   * @param level The log level (e.g., debug, info, warn, error).\n   * @param message The log message.\n   * @param data Optional additional data to log.\n   */\n  private log(level: LogLevel, message: string, data?: unknown) {\n    if (!this.shouldLog(level)) return;\n\n    const entry: LogEntry = {\n      level,\n      scope: this.scope,\n      message,\n      data,\n      time: Date.now()\n    };\n\n    try {\n      // Attempt to emit structured log event\n      eventBus.emit('log', entry);\n    } catch (error) {\n      // Fallback to in-memory storage if eventBus fails\n      this.fallbackLogs.push(entry);\n      if (this.devMode) {\n        console.error(`[EventLogger][ERROR] Failed to emit log event`, { entry, error });\n      }\n    }\n\n    // Console output only in devMode (except errors are always useful in dev)\n    if (this.devMode) {\n      console.debug(`[EventLogger][DEBUG] Logging to console`, { level, message, data }); // Debug log for visibility\n      this.consoleOutput(level, message, data);\n    }\n  }\n\n  /**\n   * Output log to the console based on the log level.\n   * @param level The log level.\n   * @param message The log message.\n   * @param data Optional additional data to log.\n   */\n  private consoleOutput(level: LogLevel, message: string, data?: unknown) {\n    let method: 'log' | 'warn' | 'error';\n    switch (level) {\n      case 'warn': method = 'warn'; break;\n      case 'error': method = 'error'; break;\n      default: method = 'log'; // debug, info, event \u2192 log\n    }\n\n    const prefix = `[${this.scope}][${level.toUpperCase()}]`;\n    if (data !== undefined) {\n      console[method](prefix, message, data);\n    } else {\n      console[method](prefix, message);\n    }\n  }\n\n  /**\n   * Retrieve fallback logs stored in memory.\n   * @returns An array of fallback log entries.\n   */\n  getFallbackLogs(): LogEntry[] {\n    return this.fallbackLogs;\n  }\n\n  debug(msg: string, data?: unknown) { this.log('debug', msg, data); }\n  info(msg: string, data?: unknown) { this.log('info', msg, data); }\n  warn(msg: string, data?: unknown) { this.log('warn', msg, data); }\n  event(msg: string, data?: unknown) { this.log('event', msg, data); }\n  error(msg: string, data?: unknown) { this.log('error', msg, data); }\n}\n", "// src/spaceface/system/bin/EventBinder.ts\n\n/**\n * EventBinder v1.2.2\n *\n * Manages the lifecycle of EventBus and DOM event bindings with\n * support for auto-unbinding, debugging, and scoped lifetimes.\n *\n * Provides a single utility class for safely attaching and\n * detaching event handlers in a structured way.\n */\n\nimport {\n  DomBinding,\n  EventBinderStats,\n  EventBinderInterface,\n  BusBindingInterface\n} from \"../types/bin.js\";\n\nimport { eventBus } from \"./EventBus.js\";\nimport { EventLogger } from \"./EventLogger.js\";\n\ninterface IEventBinderDebugPayload {\n  method: string;\n  details: unknown;\n}\n\ntype EventTargetLike = EventTarget & {\n  addEventListener: (type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions) => void;\n  removeEventListener: (type: string, listener: EventListenerOrEventListenerObject, options?: boolean | EventListenerOptions) => void;\n};\n\n/**\n * EventBinder\n *\n * A utility for managing event bindings across EventBus and DOM.\n * Keeps track of all active bindings and supports automatic cleanup.\n */\nexport class EventBinder implements EventBinderInterface {\n  private IBusBindings: BusBindingInterface[] = [];\n  private domBindings: DomBinding[] = [];\n  private debugMode: boolean;\n  private logger: EventLogger;\n\n  /**\n   * Create a new EventBinder.\n   * @param debug Enable debug logging (emits `debug:EventBinder` events)\n   */\n  constructor(debug = false) {\n    this.debugMode = debug;\n    this.logger = new EventLogger(\"eventbinder\");\n  }\n\n  /**\n   * Emit debug info via EventBus if debug mode is enabled.\n   * @param method The method name where the debug is called.\n   * @param details Additional details to log.\n   */\n  private debug(method: string, details: unknown): void {\n    if (!this.debugMode) return;\n    try {\n      const payload: IEventBinderDebugPayload = { method, details };\n      this.logger.debug(method, payload);\n    } catch (error) {\n      console.error(`Debugging failed in method: ${method}`, error);\n    }\n  }\n\n  /**\n   * Attach binder lifetime to an AbortSignal.\n   * All bindings will be unbound automatically when the signal aborts.\n   * @param signal AbortSignal to link binder lifetime to.\n   * @returns Unsubscribe function that removes the abort listener.\n   */\n  attachTo(signal: AbortSignal): () => void {\n    if (signal.aborted) {\n      this.unbindAll();\n      return () => {};\n    }\n    const listener = () => this.unbindAll();\n    signal.addEventListener(\"abort\", listener, { once: true });\n    // return an unsubscribe so callers (eg tests) can remove the attachment without aborting the signal\n    return () => {\n      try {\n        signal.removeEventListener(\"abort\", listener);\n      } catch (error) {\n        console.warn(\"Failed to remove abort listener\", error);\n      }\n    };\n  }\n\n  /**\n   * Toggle debug mode at runtime.\n   * @param enable Set to true to enable debug mode, false to disable.\n   */\n  public setDebugMode(enable: boolean): void {\n    this.debugMode = enable;\n    this.logger.info(`Debug mode ${enable ? 'enabled' : 'disabled'}`);\n  }\n\n  /**\n   * Bind a handler to an EventBus event.\n   * @param event Event name\n   * @param handler Event handler function\n   */\n  bindBus(event: string, handler: (...args: unknown[]) => void): void {\n    if (this.IBusBindings.find(b => b.event === event && b.handler === handler)) {\n      this.debug(\"bus:bind:duplicate\", { event, handler });\n      return;\n    }\n    try {\n      const unsubscribe = eventBus.on(event, handler);\n      this.IBusBindings.push({ event, handler, unsubscribe });\n      this.debug(\"bus:bind\", { event, handler });\n    } catch (err) {\n      this.logger.error(`Failed to bind bus event \"${event}\": ${err instanceof Error ? err.message : String(err)}`);\n    }\n  }\n\n  /**\n   * Bind a DOM event handler with automatic tracking and unbind support.\n   * @param target Target element or EventTarget\n   * @param event Event name\n   * @param handler Event listener\n   * @param options Optional event listener options\n   */\n  bindDOM(\n    target: EventTarget,\n    event: string,\n    handler: EventListenerOrEventListenerObject,\n    options: AddEventListenerOptions | boolean = false\n  ): void {\n    // Duck-typing check so this works in non-browser/test runtimes where EventTarget instanceof may fail\n    const maybeTarget = target as Partial<EventTargetLike>;\n    if (!target || typeof maybeTarget.addEventListener !== \"function\" || typeof maybeTarget.removeEventListener !== \"function\") {\n      this.logger.warn(`Invalid DOM target for bindDOM: ${String(target)}`);\n      return;\n    }\n\n    const controller = new AbortController();\n    const normalizedOptions: AddEventListenerOptions =\n      typeof options === \"boolean\"\n        ? { capture: options, signal: controller.signal }\n        : { ...options, signal: controller.signal };\n\n    // simple options equality (compare capture/passive/once) to avoid duplicate bindings with identical semantics\n    const optionsEqual = (a?: AddEventListenerOptions, b?: AddEventListenerOptions) =>\n      (!!a === !!b) &&\n      ((a?.capture ?? false) === (b?.capture ?? false)) &&\n      ((a?.passive ?? false) === (b?.passive ?? false)) &&\n      ((a?.once ?? false) === (b?.once ?? false));\n\n    if (this.domBindings.find(b => b.target === target && b.event === event && b.handler === handler && optionsEqual(b.options, normalizedOptions))) {\n      this.debug(\"dom:bind:duplicate\", { event, handler, target, options: normalizedOptions });\n      return;\n    }\n\n    try {\n      (target as EventTargetLike).addEventListener(event, handler, normalizedOptions);\n      this.domBindings.push({ target, event, handler, options: normalizedOptions, controller });\n      this.debug(\"dom:bind\", { event, handler, target, options: normalizedOptions });\n    } catch (err) {\n      this.logger.error(`Failed to bind DOM event \"${event}\": ${err instanceof Error ? err.message : String(err)}`);\n    }\n  }\n\n  /**\n   * Unbind all EventBus and DOM event handlers managed by this binder.\n   */\n  unbindAll(): void {\n    this.debug(\"unbindAll\", {\n      bus: this.IBusBindings.length,\n      dom: this.domBindings.length,\n    });\n\n    for (const b of this.IBusBindings) {\n      try {\n        b.unsubscribe();\n        this.debug(\"bus:unbind\", { event: b.event });\n      } catch (err) {\n        this.logger.error(`Failed to unbind bus \"${b.event}\": ${err instanceof Error ? err.message : String(err)}`);\n      }\n    }\n\n    for (const b of this.domBindings) {\n      try {\n        b.controller.abort();\n        this.debug(\"dom:unbind\", { event: b.event, target: b.target });\n      } catch (err) {\n        this.logger.error(`Failed to unbind DOM \"${b.event}\": ${err instanceof Error ? err.message : String(err)}`);\n      }\n    }\n\n    this.IBusBindings = [];\n    this.domBindings = [];\n  }\n\n  /**\n   * Unbind a specific EventBus handler.\n   * @param event Event name\n   * @param handler Event handler\n   * @returns True if successfully unbound, false otherwise\n   */\n  unbindBus(event: string, handler: (...args: unknown[]) => void): boolean {\n    const i = this.IBusBindings.findIndex(b => b.event === event && b.handler === handler);\n    if (i === -1) return false;\n\n    try {\n      this.IBusBindings[i].unsubscribe();\n      this.IBusBindings.splice(i, 1);\n      this.debug(\"bus:unbind:single\", { event, handler });\n      return true;\n    } catch (err) {\n      this.logger.error(`Failed to unbind bus \"${event}\": ${err instanceof Error ? err.message : String(err)}`);\n      return false;\n    }\n  }\n\n  /**\n   * Unbind a specific DOM event handler.\n   * @param target Target element\n   * @param event Event name\n   * @param handler Event listener\n   * @returns True if successfully unbound, false otherwise\n   */\n  unbindDOM(target: EventTarget, event: string, handler: EventListenerOrEventListenerObject): boolean {\n    const i = this.domBindings.findIndex(b => b.target === target && b.event === event && b.handler === handler);\n    if (i === -1) return false;\n\n    try {\n      this.domBindings[i].controller.abort();\n      this.domBindings.splice(i, 1);\n      this.debug(\"dom:unbind:single\", { event, target });\n      return true;\n    } catch (err) {\n      this.logger.error(`Failed to unbind DOM \"${event}\": ${err instanceof Error ? err.message : String(err)}`);\n      return false;\n    }\n  }\n\n  /**\n   * Get binding statistics.\n   * @returns Number of bus and DOM events currently bound\n   */\n  getStats(): EventBinderStats {\n    return {\n      busEvents: this.IBusBindings.length,\n      domEvents: this.domBindings.length,\n      totalEvents: this.IBusBindings.length + this.domBindings.length,\n    };\n  }\n\n  /**\n   * Check if there are any active bindings.\n   * @returns True if any EventBus or DOM bindings exist\n   */\n  hasBindings(): boolean {\n    return this.IBusBindings.length > 0 || this.domBindings.length > 0;\n  }\n\n  /**\n   * Get details of all active bindings.\n   * @returns Object with arrays of bus and DOM binding info\n   */\n  getBindingDetails(): { bus: string[]; dom: string[] } {\n    return {\n      bus: this.IBusBindings.map(b => b.event),\n      dom: this.domBindings.map(b => `${b.event}@${b.target.constructor.name}`),\n    };\n  }\n\n  /**\n   * Utility wrapper for scoped binding lifetimes.\n   * Automatically unbinds after callback execution (sync or async).\n   *\n   * @param callback Function that receives a temporary EventBinder\n   * @param debug Enable debug mode\n   * @returns The callback result\n   */\n  static withAutoUnbind<T>(\n    callback: (binder: EventBinder) => T | Promise<T>,\n    debug = false\n  ): Promise<T> | T {\n    const binder = new EventBinder(debug);\n    try {\n      const result = callback(binder);\n      if (result instanceof Promise) {\n        return result.finally(() => binder.unbindAll());\n      } else {\n        binder.unbindAll();\n        return result;\n      }\n    } catch (err) {\n      binder.unbindAll();\n      throw err;\n    }\n  }\n}\n\n/** Default shared EventBinder instance */\nexport const eventBinder = new EventBinder();\n", "// src/spaceface/system/bin/PartialLoader.ts\n\nimport { debounce } from \"../features/bin/timing.js\";\nimport { eventBus } from \"./EventBus.js\";\n\nimport {\n    PartialLoaderOptionsInterface,\n    PartialLoadResultInterface,\n    PartialInfoInterface,\n    PartialEventPayload,\n    LogPayload\n} from \"../types/bin.js\";\n\nexport class PartialLoader {\n    private cache = new Map<string, string>();\n    private loadingPromises = new Map<string, Promise<string>>();\n    private loadedPartials = new Map<string, boolean>();\n    private options: Required<PartialLoaderOptionsInterface>;\n\n    constructor(options: PartialLoaderOptionsInterface = {}) {\n        this.options = {\n            debug: false,\n            baseUrl: \"/\",\n            cacheEnabled: true,\n            timeout: 10000,\n            retryAttempts: 3,\n            ...options,\n        };\n    }\n\n    /** Emit debug events instead of console.debug */\n    private logDebug(msg: string, data?: unknown) {\n        if (this.options.debug) {\n            const logKey = `${msg}-${JSON.stringify(data)}`;\n            if (!this.loadedPartials.has(logKey)) {\n                this.loadedPartials.set(logKey, true);\n                const payload: LogPayload = {\n                    scope: \"PartialLoader\",\n                    level: \"debug\",\n                    message: msg,\n                    data,\n                    time: Date.now(),\n                };\n                eventBus.emit(\"log:debug\", payload);\n                eventBus.emit(\"log\", payload);\n            }\n        }\n    }\n\n    /** Load partials from links or info objects */\n    async load(\n        input: HTMLLinkElement | PartialInfoInterface | (HTMLLinkElement | PartialInfoInterface)[]\n    ): Promise<PartialLoadResultInterface[]> {\n        const items = Array.isArray(input) ? input : [input];\n        const results: PartialLoadResultInterface[] = [];\n\n        for (const item of items) {\n            try {\n                if (item instanceof HTMLLinkElement) {\n                    results.push(await this.loadLink(item));\n                } else {\n                    results.push(await this.loadInfo(item));\n                }\n            } catch (error) {\n                const url = item instanceof HTMLLinkElement\n                    ? item.getAttribute(\"src\") || \"\"\n                    : item.url;\n                this.logDebug(\"Failed to load partial\", { url, error });\n                results.push({ success: false, url, cached: false });\n            }\n        }\n\n        eventBus.emit<PartialEventPayload>(\"partials:allLoaded\", { url: \"\", cached: false });\n        this.logDebug(\"All partials loaded\", { count: results.length });\n        return results;\n    }\n\n    private loadLink(link: HTMLLinkElement) {\n        const src = link.getAttribute(\"src\");\n        if (!src) throw new Error(\"Partial link missing src\");\n        return this.loadUrl(this.resolveUrl(src), link);\n    }\n\n    private loadInfo(info: PartialInfoInterface) {\n        return this.loadUrl(this.resolveUrl(info.url), info.container, info.id);\n    }\n\n    private async loadUrl(url: string, container: Element | ParentNode, id?: string): Promise<PartialLoadResultInterface> {\n        try {\n            if (this.options.cacheEnabled && this.cache.has(url)) {\n                this.insertHTML(container, this.cache.get(url)!);\n                this.loadedPartials.set(id || url, true);\n\n                eventBus.emit<PartialEventPayload>(\"partial:loaded\", { url, html: this.cache.get(url)!, cached: true });\n                this.logDebug(\"Partial loaded from cache\", { url, id });\n                return { success: true, url, cached: true };\n            }\n\n            let fetchPromise = this.loadingPromises.get(url);\n            if (!fetchPromise) {\n                fetchPromise = this.fetchWithRetry(url);\n                this.loadingPromises.set(url, fetchPromise);\n            }\n\n            const html = await fetchPromise;\n            if (this.options.cacheEnabled) this.cache.set(url, html);\n\n            this.insertHTML(container, html);\n            this.loadedPartials.set(id || url, true);\n\n            eventBus.emit<PartialEventPayload>(\"partial:loaded\", { url, html, cached: false });\n            this.logDebug(\"Partial loaded\", { url, id });\n            return { success: true, url, cached: false };\n        } catch (error) {\n            this.showError(container, error as Error);\n            eventBus.emit<PartialEventPayload>(\"partial:error\", { url, error });\n            this.logDebug(\"Partial load failed\", { url, id, error });\n            throw error;\n        } finally {\n            this.loadingPromises.delete(url);\n            eventBus.emit<PartialEventPayload>(\"partial:load:complete\", { url });\n            this.logDebug(\"Partial load complete\", { url, id });\n        }\n    }\n\n    private async fetchWithRetry(url: string, attempt = 1): Promise<string> {\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), this.options.timeout);\n\n        try {\n            const res = await fetch(url, { signal: controller.signal, headers: { Accept: \"text/html\" } });\n            if (!res.ok) throw new Error(`HTTP ${res.status}`);\n            const html = (await res.text()).trim();\n            if (!html) throw new Error(\"Empty response\");\n            return html;\n        } catch (err) {\n            if (attempt < this.options.retryAttempts) {\n                this.logDebug(\"Retrying fetch\", { url, attempt });\n                await this.delay(Math.min(2 ** attempt * 100, 5000));\n                return this.fetchWithRetry(url, attempt + 1);\n            }\n            throw err;\n        } finally {\n            clearTimeout(timeoutId);\n        }\n    }\n\n    private async fetchPartial(url: string, attempt = 1): Promise<string> {\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), this.options.timeout);\n\n        try {\n            const res = await fetch(url, { signal: controller.signal, headers: { Accept: \"text/html\" } });\n            if (!res.ok) throw new Error(`HTTP ${res.status}`);\n            const html = (await res.text()).trim();\n            if (!html) throw new Error(\"Empty response\");\n            return html;\n        } catch (err) {\n            if (attempt < this.options.retryAttempts) {\n                this.logDebug(\"Retrying fetch\", { url, attempt });\n                await this.delay(Math.min(2 ** attempt * 100, 5000));\n                return this.fetchPartial(url, attempt + 1);\n            }\n            throw err;\n        } finally {\n            clearTimeout(timeoutId);\n        }\n    }\n\n    private insertHTML(container: ParentNode | Element, html: string) {\n        const template = document.createElement(\"template\");\n        template.innerHTML = html;\n\n        if (container instanceof HTMLLinkElement) {\n            container.replaceWith(...template.content.childNodes);\n        } else if (container instanceof Element) {\n            container.innerHTML = \"\";\n            container.append(...template.content.childNodes);\n        } else {\n            container.append(...template.content.childNodes);\n        }\n\n        this.logDebug(\"Inserted HTML into container\", { container });\n    }\n\n    private showError(container: ParentNode | Element, error: Error) {\n        const div = document.createElement(\"div\");\n        div.className = \"partial-error\";\n        div.textContent = \"Partial load failed\";\n        if (this.options.debug) div.textContent += `: ${error.message}`;\n\n        if (container instanceof HTMLLinkElement) {\n            container.replaceWith(div);\n        } else if (container instanceof Element) {\n            container.innerHTML = \"\";\n            container.appendChild(div);\n        } else {\n            container.appendChild(div);\n        }\n\n        eventBus.emit(\"log:error\", {\n            scope: \"PartialLoader\",\n            message: \"Partial load failed\",\n            error,\n            context: {\n                url: container instanceof HTMLLinkElement ? container.href : undefined,\n                retryAttempts: this.options.retryAttempts,\n            },\n        });\n        this.logDebug(\"Error displayed in container\", { container, error });\n    }\n\n    isPartialLoaded(id: string) {\n        return this.loadedPartials.has(id);\n    }\n\n    private resolveUrl(src: string): string {\n        if (/^[a-zA-Z][a-zA-Z\\d+\\-.]*:/.test(src) || src.startsWith(\"//\")) {\n            this.logDebug(\"URL is already absolute\", { src });\n            return src;\n        }\n\n        try {\n            const base = this.options.baseUrl || window.location.origin + \"/\";\n            const url = new URL(src, base).toString();\n            const resolvedUrl = url.startsWith(window.location.origin)\n                ? url.slice(window.location.origin.length) || \"/\"\n                : url;\n            this.logDebug(\"Resolved relative URL\", { src, resolvedUrl });\n            return resolvedUrl;\n        } catch (error) {\n            this.logDebug(\"Failed to resolve URL\", { src, error });\n            return src;\n        }\n    }\n\n    private delay(ms: number): Promise<void> {\n        this.logDebug(\"Delaying execution\", { ms });\n        return new Promise(resolve => setTimeout(resolve, ms));\n    }\n\n    async loadContainer(container: ParentNode = document): Promise<PartialLoadResultInterface[]> {\n        const links = container.querySelectorAll<HTMLLinkElement>('link[rel=\"partial\"][src]');\n        if (!links.length) return [];\n        return this.load(Array.from(links));\n    }\n\n    watch(container: HTMLElement | Document = document.body) {\n        if (!window.MutationObserver) return;\n        const observer = new MutationObserver(\n            debounce(() => this.loadContainer(container), 100)\n        );\n        observer.observe(container, { childList: true, subtree: true });\n        this.logDebug(\"Watching container for partials\", { container });\n        return observer;\n    }\n\n    /** Exposed method so PartialFetcher can reuse loader's cache + retry */\n    async fetchWithLoaderCache(url: string): Promise<string> {\n        if (this.options.cacheEnabled && this.cache.has(url)) {\n            this.logDebug(\"Fetching from cache\", { url });\n            return this.cache.get(url)!;\n        }\n        const html = await this.fetchPartial(url);\n        if (this.options.cacheEnabled) this.cache.set(url, html);\n        this.logDebug(\"Fetched and cached partial\", { url });\n        return html;\n    }\n}\n", "// src/system/bin/PartialFetcher.ts\n\nimport { eventBus } from \"./EventBus.js\";\nimport { PartialLoader } from \"./PartialLoader.js\";\nimport type { PartialFetchOptionsInterface, PartialEventPayload, PartialLoaderLike, LogPayload } from \"../types/bin.js\";\n\nexport class PartialFetcher {\n    /** Default internal loader instance */\n    private static loader: PartialLoaderLike;\n\n    /**\n     * Get or create the default loader instance.\n     * @returns The default loader instance.\n     */\n    private static getLoader(): PartialLoaderLike {\n        return this.loader ?? (this.loader = new PartialLoader());\n    }\n\n    /**\n     * Emit debug logs via EventBus.\n     * @param message The debug message.\n     * @param data Additional data to log.\n     */\n    private static logDebug(message: string, data?: unknown): void {\n        const payload: LogPayload = {\n            scope: \"PartialFetcher\",\n            level: \"debug\",\n            message,\n            data,\n            time: Date.now(),\n        };\n        eventBus.emit(\"log\", payload);\n    }\n\n    /**\n     * Load a partial HTML into a target container.\n     * @param url The URL of the partial to load.\n     * @param targetSelector The CSS selector of the target container.\n     * @param options Additional options for the loader.\n     */\n    static async load(\n        url: string,\n        targetSelector: string,\n        options: PartialFetchOptionsInterface = {}\n    ): Promise<void> {\n        const loader = options.loader ?? this.getLoader();\n        const container = document.querySelector<HTMLElement>(targetSelector);\n        if (!container) throw new Error(`Target ${targetSelector} not found`);\n\n        try {\n            this.logDebug(\"Fetching partial\", { url, targetSelector });\n            await loader.load([{ url, container }]);\n            eventBus.emit<PartialEventPayload>(\"partial:loaded\", { url, targetSelector, cached: false });\n            this.logDebug(\"Partial loaded successfully\", { url, targetSelector });\n        } catch (error) {\n            eventBus.emit<PartialEventPayload>(\"partial:error\", { url, error });\n            this.logDebug(\"Partial load error\", { url, error });\n            throw error;\n        } finally {\n            eventBus.emit<PartialEventPayload>(\"partial:load:complete\", { url, targetSelector, error: false });\n        }\n    }\n\n    /**\n     * Preload multiple partials without rendering them.\n     * @param urls The URLs of the partials to preload.\n     * @param loader Optional custom loader instance.\n     * @returns A promise that resolves when all partials are preloaded.\n     */\n    static async preload(urls: string[], loader?: PartialLoaderLike): Promise<void[]> {\n        const activeLoader = loader ?? this.getLoader();\n        const dummyContainer = document.createElement(\"div\");\n\n        return Promise.all(\n            urls.map(async (url) => {\n                try {\n                    this.logDebug(\"Preloading partial\", { url });\n                    await activeLoader.load([{ url, container: dummyContainer }]);\n                    eventBus.emit<PartialEventPayload>(\"partial:loaded\", { url, cached: true });\n                } catch (error) {\n                    eventBus.emit<PartialEventPayload>(\"partial:error\", { url, error });\n                    this.logDebug(\"Preload error\", { url, error });\n                } finally {\n                    eventBus.emit<PartialEventPayload>(\"partial:load:complete\", { url, error: false });\n                }\n            })\n        );\n    }\n\n    /**\n     * Watch a container for dynamic partial loading.\n     * @param container The container to watch.\n     * @param loader Optional custom loader instance.\n     * @returns The result of the loader's watch method.\n     */\n    static watch(container: HTMLElement | Document = document.body, loader?: PartialLoaderLike): unknown {\n        const activeLoader = loader ?? this.getLoader();\n        this.logDebug(\"Watching container for partials\", { container });\n        return activeLoader.watch?.(container);\n    }\n}\n", "// src/spaceface/system/features/bin/AsyncImageLoader.ts\n\n\nimport {\n  AsyncImageLoaderOptions,\n  SourceDataInterface,\n  ImageMetadataInterface,\n  ImageLoadResultInterface\n} from '../../types/bin.js';\n\nexport class AsyncImageLoader {\n  private container: Element | null;\n  private includePicture: boolean;\n  private debug: boolean;\n  private cache = new WeakMap<HTMLImageElement, boolean>();\n  private destroyed = false;\n\n  constructor(container: Element, options: AsyncImageLoaderOptions = {}) {\n    if (!(container instanceof Element)) {\n      throw new Error(\"AsyncImageLoader: container must be a DOM Element.\");\n    }\n    this.container = container;\n    this.includePicture = options.includePicture ?? false;\n    this.debug = options.debug ?? false;\n  }\n\n  private logDebug(message: string, data?: unknown): void {\n    if (!this.debug) return;\n    console.debug(`[AsyncImageLoader] ${message}`, data);\n  }\n\n  private ensureActive(methodName: string): void {\n    if (this.destroyed || !this.container) {\n      throw new Error(`AsyncImageLoader: Instance destroyed. Method: ${methodName}`);\n    }\n  }\n\n  public getImages(selector = \"img\"): HTMLImageElement[] {\n    this.ensureActive(\"getImages\");\n    if (!selector.trim()) return [];\n\n    const images = new Set<HTMLImageElement>();\n\n    this.container!.querySelectorAll(selector).forEach(el => {\n      if (el instanceof HTMLImageElement) {\n        if (!this.includePicture && el.closest(\"picture\")) return;\n        images.add(el);\n      }\n    });\n\n    return [...images];\n  }\n\n  // ---------- Overloads ----------\n  public async waitForImagesToLoad(\n    selector?: string,\n    includeFailed?: false\n  ): Promise<HTMLImageElement[]>;\n\n  public async waitForImagesToLoad(\n    selector: string,\n    includeFailed: true\n  ): Promise<ImageLoadResultInterface[]>;\n\n  // ---------- Implementation ----------\n  public async waitForImagesToLoad(\n    selector = \"img\",\n    includeFailed = false,\n    timeout = 10000\n  ): Promise<HTMLImageElement[] | ImageLoadResultInterface[]> {\n    this.logDebug(\"Waiting for images to load\", { selector, includeFailed, timeout });\n    const images = this.getImages(selector);\n\n    const results = await Promise.all(\n      images.map(img => {\n        if (this.cache.has(img)) {\n          this.logDebug(\"Image already cached\", { img });\n          return { element: img, loaded: true };\n        }\n\n        if (img.complete && img.naturalWidth > 0) {\n          this.cache.set(img, true);\n          this.logDebug(\"Image already loaded\", { img });\n          return { element: img, loaded: true };\n        }\n\n        return new Promise<ImageLoadResultInterface>(resolve => {\n          const onLoad = () => {\n            clearTimeout(timer);\n            this.cache.set(img, true);\n            this.logDebug(\"Image loaded successfully\", { img });\n            resolve({ element: img, loaded: true });\n          };\n\n          const onError = () => {\n            clearTimeout(timer);\n            this.logDebug(\"Image failed to load\", { img });\n            resolve({ element: img, loaded: false });\n          };\n\n          const timer = setTimeout(() => {\n            img.removeEventListener(\"load\", onLoad);\n            img.removeEventListener(\"error\", onError);\n            this.logDebug(\"Image load timeout\", { img });\n            resolve({ element: img, loaded: false });\n          }, timeout);\n\n          img.addEventListener(\"load\", onLoad, { once: true });\n          img.addEventListener(\"error\", onError, { once: true });\n        });\n      })\n    );\n\n    return includeFailed\n      ? results\n      : results.filter(r => r.loaded).map(r => r.element);\n  }\n\n  public getImageData(selector = \"img\"): ImageMetadataInterface[] {\n    return this.getImages(selector).map(img => {\n      const sources: SourceDataInterface[] = [];\n\n      if (this.includePicture) {\n        const picture = img.closest(\"picture\");\n        if (picture) {\n          picture.querySelectorAll(\"source\").forEach(source => {\n            sources.push({\n              srcset: source.srcset || \"\",\n              type: source.type || \"\",\n              media: source.media || \"\"\n            });\n          });\n        }\n      }\n\n      return {\n        element: img,\n        src: img.src || \"\",\n        alt: img.alt || \"\",\n        href: img.closest(\"a\")?.href ?? null,\n        sources\n      };\n    });\n  }\n\n  public clearCache(): void {\n    this.logDebug(\"Clearing image cache\");\n    this.cache = new WeakMap();\n  }\n\n  public destroy(): void {\n    this.container = null;\n    this.destroyed = true;\n  }\n}\n", "// src/spaceface/system/features/bin/AnimationLoop.ts\n\n\ntype FrameCallback = () => void;\n\n/**\n * Manages a loop of animation frames, allowing callbacks to be added and removed dynamically.\n * Ensures safe execution of callbacks and handles errors gracefully.\n */\nexport class AnimationLoop {\n    private callbacks: Set<FrameCallback> = new Set();\n    private running = false;\n    private _rafId: number | null = null;\n    private errorHandler: (error: unknown) => void;\n\n    constructor(errorHandler: (error: unknown) => void = console.error) {\n        this.errorHandler = errorHandler;\n    }\n\n    /**\n     * Adds a callback to the animation loop.\n     * Starts the loop if it is not already running.\n     *\n     * @param callback - The function to be called on each animation frame.\n     */\n    add(callback: FrameCallback): void {\n        if (typeof callback !== 'function') {\n            throw new TypeError('AnimationLoop.add: Callback must be a function');\n        }\n        if (!this.callbacks.has(callback)) this.callbacks.add(callback);\n        this.start();\n    }\n\n    /**\n     * Removes a callback from the animation loop.\n     * Stops the loop if no callbacks remain.\n     *\n     * @param callback - The function to be removed.\n     */\n    remove(callback: FrameCallback): void {\n        this.callbacks.delete(callback);\n        if (this.callbacks.size === 0) this.stop();\n    }\n\n    /**\n     * Removes all callbacks from the animation loop.\n     * Stops the loop if it is running.\n     */\n    clear(): void {\n        this.callbacks.clear();\n        this.stop();\n    }\n\n    /**\n     * Checks if a callback is currently in the animation loop.\n     *\n     * @param callback - The function to check.\n     * @returns True if the callback is in the loop, false otherwise.\n     */\n    has(callback: FrameCallback): boolean {\n        return this.callbacks.has(callback);\n    }\n\n    /**\n     * Pauses the animation loop, stopping all callbacks temporarily.\n     * This is equivalent to calling `stop` but does not clear callbacks.\n     */\n    pause(): void {\n        this.stop();\n    }\n\n    /**\n     * Resumes the animation loop if there are callbacks to execute.\n     */\n    resume(): void {\n        if (this.callbacks.size > 0) this.start();\n    }\n\n    /**\n     * Starts the animation loop if it is not already running.\n     * Private method to ensure controlled access.\n     */\n    private start(): void {\n        if (this.running || this.callbacks.size === 0) return;\n        this.running = true;\n        // Schedule the first frame rather than invoking immediately\n        this._rafId = requestAnimationFrame(this._loop);\n    }\n\n    /**\n     * Stops the animation loop and cancels the next frame.\n     * Private method to ensure controlled access.\n     */\n    private stop(): void {\n        this.running = false;\n        if (this._rafId !== null) cancelAnimationFrame(this._rafId);\n        this._rafId = null;\n    }\n\n    /**\n     * The main loop function, executed on each animation frame.\n     * Iterates over a snapshot of callbacks to allow safe modification during execution.\n     */\n    private _loop = (): void => {\n        if (!this.running) return;\n        for (const cb of Array.from(this.callbacks)) {\n            try {\n                cb();\n            } catch (err) {\n                this.errorHandler(err);\n            }\n        }\n        this._rafId = requestAnimationFrame(this._loop);\n    };\n}\n\n/**\n * A shared instance of the AnimationLoop class for global use.\n */\nexport const animationLoop = new AnimationLoop();\n", "export type AnimationPauseReason = 'manual' | 'hover' | 'hidden' | 'inactivity' | 'screensaver';\n\nexport class AnimationPolicy {\n  private pausedReasons = new Set<AnimationPauseReason>();\n\n  set(reason: AnimationPauseReason, paused: boolean): void {\n    if (paused) this.pausedReasons.add(reason);\n    else this.pausedReasons.delete(reason);\n  }\n\n  has(reason: AnimationPauseReason): boolean {\n    return this.pausedReasons.has(reason);\n  }\n\n  isPaused(): boolean {\n    return this.pausedReasons.size > 0;\n  }\n\n  list(): AnimationPauseReason[] {\n    return Array.from(this.pausedReasons);\n  }\n\n  clear(): void {\n    this.pausedReasons.clear();\n  }\n}\n", "// src/spaceface/features/SlidePlayer/SlidePlayer.ts\n\n\nimport { eventBus } from '../../bin/EventBus.js';\nimport { EventBinder } from '../../bin/EventBinder.js';\nimport { AsyncImageLoader } from '../bin/AsyncImageLoader.js';\nimport { animationLoop } from '../bin/AnimationLoop.js';\nimport { AnimationPolicy, AnimationPauseReason } from '../bin/AnimationPolicy.js';\nimport type { LogPayload } from '../../types/bin.js';\nimport { EVENTS } from '../../types/events.js';\n\ninterface ISlidePlayerOptions {\n  interval?: number;\n  includePicture?: boolean;\n  dotsSelector?: string;\n  autoCreateDots?: boolean;\n  startPaused?: boolean;\n  enableBusEvents?: boolean;\n  autoplay?: boolean;\n  debug?: boolean;\n}\n\nexport class SlidePlayer {\n  static readonly SWIPE_THRESHOLD = 50;\n  static readonly VERTICAL_TOLERANCE = 30;\n  static readonly DEFAULT_INTERVAL = 5000;\n\n  private container: HTMLElement;\n  private interval: number;\n  private includePicture: boolean;\n  private dotsSelector: string;\n  private autoCreateDots: boolean;\n  private enableBusEvents: boolean;\n  private autoplay: boolean;\n  private debug: boolean;\n\n  private slides: HTMLElement[] = [];\n  private dots: HTMLDivElement[] = [];\n  private dotsWrapper: HTMLElement | null = null;\n  private currentIndex = 0;\n\n  private lastTickTime = 0;\n  private isDestroyed = false;\n\n  private isPointerDown = false;\n  private pointerStartX = 0;\n  private pointerStartY = 0;\n  private pointerEndX = 0;\n  private pointerEndY = 0;\n\n  private animationPolicy = new AnimationPolicy();\n  private loader: AsyncImageLoader;\n  private binder: EventBinder;\n  private animateCallback: () => void;\n\n  private lastPauseState: boolean = false;\n  public readonly ready: Promise<void>;\n  public initError: unknown = null;\n\n  constructor(\n    containerOrSelector: string | HTMLElement,\n    {\n      interval = SlidePlayer.DEFAULT_INTERVAL,\n      includePicture = false,\n      dotsSelector = '.dots',\n      autoCreateDots = false,\n      startPaused = false,\n      enableBusEvents = true,\n      autoplay = true,\n      debug = false\n    }: ISlidePlayerOptions = {}\n  ) {\n    this.container = this.resolveContainer(containerOrSelector);\n    this.interval = interval > 0 ? interval : SlidePlayer.DEFAULT_INTERVAL;\n    this.includePicture = includePicture;\n    this.dotsSelector = dotsSelector;\n    this.autoCreateDots = autoCreateDots;\n    this.enableBusEvents = enableBusEvents;\n    this.autoplay = autoplay;\n    this.debug = debug;\n\n    this.loader = new AsyncImageLoader(this.container, { includePicture });\n    this.binder = new EventBinder(this.debug);\n\n    if (startPaused) this.animationPolicy.set('manual', true);\n\n    this.animateCallback = () => this.animate();\n    // Ensure init always resolves to avoid unhandled rejection.\n    // If init fails we capture the error in initError for callers to inspect.\n    this.ready = this.init()\n      .catch((err) => {\n        this.initError = err;\n        this.log('error', 'SlidePlayer init failed', err);\n      })\n      .then(() => {});\n\n    this.log('info', 'SlidePlayer initialized', { container: this.container, interval, autoplay, debug });\n  }\n\n  /** ---- Centralized logging ---- */\n  private log(level: 'debug' | 'info' | 'warn' | 'error', message: string, data?: unknown) {\n    if (!this.debug && level === 'debug') return;\n\n    const payload: LogPayload = { scope: 'SlidePlayer', level, message, data, time: Date.now() };\n    eventBus.emit(EVENTS.SLIDEPLAYER_LOG, { level, message, data });\n    eventBus.emit(EVENTS.LOG, payload);\n    if (this.debug) {\n      switch (level) {\n        case 'debug':\n          console.debug(`[SlidePlayer] [${level.toUpperCase()}]`, message, data);\n          break;\n        case 'info':\n          console.info(`[SlidePlayer] [${level.toUpperCase()}]`, message, data);\n          break;\n        case 'warn':\n          console.warn(`[SlidePlayer] [${level.toUpperCase()}]`, message, data);\n          break;\n        case 'error':\n          console.error(`[SlidePlayer] [${level.toUpperCase()}]`, message, data);\n          break;\n      }\n    }\n  }\n\n  private resolveContainer(containerOrSelector: string | HTMLElement): HTMLElement {\n    const container = typeof containerOrSelector === 'string'\n      ? document.querySelector<HTMLElement>(containerOrSelector)\n      : containerOrSelector;\n    if (!container) throw new Error('SlidePlayer: container element not found.');\n    return container;\n  }\n\n  /** ---- Initialization ---- */\n  private async init(): Promise<void> {\n    await this.loader.waitForImagesToLoad();\n\n    this.refreshSlides();\n    if (!this.slides.length) {\n      this.log('warn', 'No .slide elements found in container.');\n      return;\n    }\n\n    this.setupDots();\n    this.bindEvents();\n    this.setActiveSlide(0);\n    this.lastTickTime = performance.now();\n\n    // bus bindings handled by bindActivityEvents() to avoid duplication\n\n    if (!this.isPaused() && this.autoplay) {\n      animationLoop.add(this.animateCallback);\n    }\n  }\n\n  /** ---- RAF Animation ---- */\n  private animate(): void {\n    if (this.isDestroyed || !this.autoplay || this.isPaused() || this.slides.length < 2) return;\n\n    const now = performance.now();\n    const elapsed = now - this.lastTickTime;\n\n    if (elapsed >= this.interval) {\n      this.next(false);\n      this.lastTickTime = now;\n    }\n  }\n\n  /** ---- Pause / Resume ---- */\n  private togglePause(reason: AnimationPauseReason, shouldPause: boolean): void {\n    this.animationPolicy.set(reason, shouldPause);\n\n    this.emitPauseResumeIfChanged();\n\n    if (this.isPaused()) {\n      if (animationLoop.has(this.animateCallback)) animationLoop.remove(this.animateCallback);\n      this.log('debug', `Paused due to: ${this.animationPolicy.list().join(', ')}`);\n    } else {\n      if (!animationLoop.has(this.animateCallback)) animationLoop.add(this.animateCallback);\n      this.log('debug', 'Resumed playback');\n    }\n  }\n\n  private emitPauseResumeIfChanged(): void {\n      const nowPaused = this.isPaused();\n    if (nowPaused !== this.lastPauseState) {\n      this.lastPauseState = nowPaused;\n      const event = nowPaused ? 'slideplayer:paused' : 'slideplayer:resumed';\n      this.emit(event, { reasons: this.animationPolicy.list() });\n    }\n  }\n\n  public play(): void { this.togglePause('manual', false); }\n  public pause(): void { this.togglePause('manual', true); }\n  public isPaused(): boolean { return this.animationPolicy.isPaused(); }\n\n  /** ---- Slide Navigation ---- */\n  public goToSlide(index: number, restart: boolean = true): void {\n    if (index < 0 || index >= this.slides.length || index === this.currentIndex) return;\n    this.setActiveSlide(index);\n    if (restart) this.resetTimer();\n  }\n\n  public next(restart: boolean = true): void {\n    if (this.slides.length < 2) return;\n    this.goToSlide((this.currentIndex + 1) % this.slides.length, restart);\n  }\n\n  public prev(restart: boolean = true): void {\n    if (this.slides.length < 2) return;\n    const prevIndex = (this.currentIndex - 1 + this.slides.length) % this.slides.length;\n    this.goToSlide(prevIndex, restart);\n  }\n\n  /** ---- Slides / Dots ---- */\n  private refreshSlides(): void {\n    this.slides = Array.from(this.container.querySelectorAll<HTMLElement>('.slide'));\n  }\n\n  private setupDots(): void {\n    this.dotsWrapper = this.container.querySelector(this.dotsSelector);\n    if (!this.dotsWrapper && this.autoCreateDots) {\n      this.dotsWrapper = document.createElement('div');\n      this.dotsWrapper.className = 'dots';\n      this.container.appendChild(this.dotsWrapper);\n    }\n    if (!this.dotsWrapper) return;\n\n    this.dotsWrapper.innerHTML = '';\n    this.dots = this.slides.map((_, i) => {\n      const dot = document.createElement('div');\n      dot.className = 'dot';\n      dot.dataset.index = i.toString();\n      this.binder.bindDOM(dot, 'click', () => this.goToSlide(i));\n      this.dotsWrapper!.appendChild(dot);\n      return dot;\n    });\n  }\n\n  private updateDots(index: number): void {\n    this.dots.forEach((dot, i) => dot.classList.toggle('active', i === index));\n  }\n\n  private setActiveSlide(index: number): void {\n    const prev = this.currentIndex;\n    this.slides[this.currentIndex]?.classList.remove('active');\n    this.currentIndex = index;\n    this.slides[this.currentIndex]?.classList.add('active');\n    this.updateDots(index);\n\n    if (prev !== index) this.emit('slideplayer:slideChanged', { index }, 'slideplayer:slide-changed');\n  }\n\n  private resetTimer(): void { this.lastTickTime = performance.now(); }\n\n  /** ---- Event Binding ---- */\n  private bindEvents(): void {\n    this.bindPointerEvents();\n    this.bindKeyboardEvents();\n    this.bindVisibilityEvents();\n    this.bindActivityEvents();\n    this.bindUnloadEvent();\n  }\n\n  private bindPointerEvents(): void {\n    this.binder.bindDOM(this.container, 'pointerdown', (e) => {\n      const ev = e as PointerEvent;\n      this.isPointerDown = true;\n      this.pointerStartX = ev.clientX; this.pointerStartY = ev.clientY;\n      this.pointerEndX = ev.clientX; this.pointerEndY = ev.clientY;\n    });\n    this.binder.bindDOM(this.container, 'pointermove', (e) => {\n      if (!this.isPointerDown) return;\n      const ev = e as PointerEvent;\n      this.pointerEndX = ev.clientX; this.pointerEndY = ev.clientY;\n    });\n    // listen for pointerup/pointercancel on window so release outside container is handled\n    this.binder.bindDOM(window, 'pointerup', () => {\n      if (this.isPointerDown) { this.handleSwipe(); this.isPointerDown = false; }\n    });\n    this.binder.bindDOM(window, 'pointercancel', () => {\n      this.isPointerDown = false;\n    });\n    this.binder.bindDOM(this.container, 'pointerleave', () => this.isPointerDown = false);\n    this.binder.bindDOM(this.container, 'mouseenter', () => this.togglePause('hover', true));\n    this.binder.bindDOM(this.container, 'mouseleave', () => this.togglePause('hover', false));\n  }\n\n  private bindKeyboardEvents(): void {\n    this.binder.bindDOM(document, 'keydown', (e) => {\n      const ev = e as KeyboardEvent;\n      if (ev.key === 'ArrowRight') this.next();\n      else if (ev.key === 'ArrowLeft') this.prev();\n    });\n  }\n\n  private bindVisibilityEvents(): void {\n    this.binder.bindDOM(document, 'visibilitychange', () => {\n      this.togglePause('hidden', document.visibilityState === 'hidden');\n    });\n  }\n\n  private bindActivityEvents(): void {\n    if (this.enableBusEvents) {\n      this.binder.bindBus(EVENTS.USER_INACTIVE, () => this.togglePause('inactivity', true));\n      this.binder.bindBus(EVENTS.USER_ACTIVE, () => this.togglePause('inactivity', false));\n      this.binder.bindBus(EVENTS.SCREENSAVER_SHOWN, () => this.togglePause('screensaver', true));\n      this.binder.bindBus(EVENTS.SCREENSAVER_HIDDEN, () => this.togglePause('screensaver', false));\n    }\n  }\n\n  private bindUnloadEvent(): void {\n    this.binder.bindDOM(window, 'beforeunload', () => this.destroy());\n  }\n\n  private handleSwipe(): void {\n    const dx = this.pointerEndX - this.pointerStartX;\n    const dy = this.pointerEndY - this.pointerStartY;\n    if (Math.abs(dx) >= SlidePlayer.SWIPE_THRESHOLD && Math.abs(dy) < SlidePlayer.VERTICAL_TOLERANCE) {\n      const direction = dx < 0 ? 'next' : 'prev';\n      this.log('debug', `Swipe detected`, { dx, dy, direction });\n      if (dx < 0) this.next();\n      else this.prev();\n    }\n  }\n\n  private emit(type: string, detail: unknown, busEvent?: string): void {\n    this.container.dispatchEvent(new CustomEvent(type, { detail, bubbles: true }));\n    if (this.enableBusEvents && busEvent) eventBus.emit(busEvent, detail);\n  }\n\n  public destroy(): void {\n    if (this.isDestroyed) return;\n    this.isDestroyed = true;\n\n    animationLoop.remove(this.animateCallback);\n    this.binder.unbindAll();\n    this.loader.destroy();\n\n    this.slides = [];\n    this.dots = [];\n    this.dotsWrapper = null;\n    this.animationPolicy.clear();\n\n    this.log('info', 'SlidePlayer destroyed');\n  }\n\n  /** ---- Public getters ---- */\n  public get currentSlideIndex(): number { return this.currentIndex; }\n  public get slideCount(): number { return this.slides.length; }\n}\n", "// src/spaceface/system/features/bin/ResizeManager.ts\n\n\nimport { debounce, throttle, CancellableFunction } from './timing.js';\n\ntype WindowResizeCallback = () => void;\ntype ElementResizeCallback = (entry: ResizeObserverEntry) => void;\n\ninterface ElementObserverEntryInterface {\n  observer: ResizeObserver;\n  callbacks: Set<CancellableFunction<ElementResizeCallback>>;\n}\n\ntype ElementSize = { width: number; height: number };\n\nexport class ResizeManager {\n  private windowCallbacks: Map<WindowResizeCallback, EventListener> = new Map();\n  private elementObservers: Map<Element, ElementObserverEntryInterface> = new Map();\n  private debug = false;\n\n  setDebugMode(enabled: boolean): void {\n    this.debug = enabled;\n  }\n\n  private logDebug(message: string, data?: unknown): void {\n    if (!this.debug) return;\n    console.debug(`[ResizeManager] ${message}`, data);\n  }\n\n  private wrapCallback<T extends (...args: never[]) => void>(\n    cb: T,\n    options?: { debounceMs?: number; throttleMs?: number }\n  ): CancellableFunction<T> {\n    if (options?.debounceMs != null) {\n      return debounce(cb as (...args: never[]) => void, options.debounceMs) as CancellableFunction<T>;\n    } else if (options?.throttleMs != null) {\n      return throttle(cb as (...args: never[]) => void, options.throttleMs) as CancellableFunction<T>;\n    } else {\n      const wrappedCb = cb as CancellableFunction<T>;\n      wrappedCb.cancel = () => {};\n      return wrappedCb;\n    }\n  }\n\n  /**\n   * Register a callback for window resize events.\n   * Optionally debounce or throttle the callback.\n   */\n  onWindow(\n    cb: WindowResizeCallback,\n    options: { debounceMs: number } = { debounceMs: 200 }\n  ): () => void {\n    const wrappedCb = debounce(cb, options.debounceMs);\n    const handler = () => wrappedCb();\n\n    this.windowCallbacks.set(cb, handler);\n    window.addEventListener(\"resize\", handler);\n\n    return (): void => {\n      window.removeEventListener(\"resize\", handler);\n      wrappedCb.cancel?.();\n      this.windowCallbacks.delete(cb);\n    };\n  }\n\n  /**\n   * Register a callback for an element's resize events.\n   * Optionally debounce or throttle the callback.\n   */\n  onElement(\n    el: Element,\n    cb: ElementResizeCallback,\n    options?: { debounceMs?: number; throttleMs?: number }\n  ): () => void {\n    this.logDebug(\"Registering element resize callback\", { el, cb, options });\n    let entry = this.elementObservers.get(el);\n\n    if (!entry) {\n      const callbacks = new Set<CancellableFunction<ElementResizeCallback>>();\n      const observer = new ResizeObserver((entries) => {\n        try {\n          const entry = entries[0];\n          if (!entry) return;\n          callbacks.forEach(fn => fn(entry));\n        } catch (error) {\n          this.logDebug(\"ResizeObserver callback error\", { error });\n        }\n      });\n\n      entry = { observer, callbacks };\n      this.elementObservers.set(el, entry);\n      observer.observe(el);\n    }\n\n    const wrappedCb = this.wrapCallback(cb, options);\n    entry.callbacks.add(wrappedCb);\n\n    return (): void => {\n      this.logDebug(\"Removing element resize callback\", { el, cb });\n      entry!.callbacks.delete(wrappedCb);\n      wrappedCb.cancel?.();\n      if (entry!.callbacks.size === 0) {\n        entry!.observer.disconnect();\n        this.elementObservers.delete(el);\n      }\n    };\n  }\n\n  /**\n   * Get current size of an element.\n   */\n  getElement(el: Element): ElementSize {\n    try {\n      const rect = el.getBoundingClientRect();\n      // this.logDebug(\"Getting element size\", { el, rect });\n      return { width: rect.width, height: rect.height };\n    } catch {\n      // this.logDebug(\"Error getting element size\", { el, error });\n      throw new Error(\"ResizeManager: Failed to get element size.\");\n    }\n  }\n\n  /**\n   * Cleanup all registered window and element callbacks.\n   */\n  destroy(): void {\n    this.logDebug(\"Destroying ResizeManager\");\n    for (const [, handler] of this.windowCallbacks.entries()) {\n      window.removeEventListener(\"resize\", handler);\n    }\n    this.windowCallbacks.clear();\n\n    for (const entry of this.elementObservers.values()) {\n      entry.observer.disconnect();\n      for (const fn of entry.callbacks) {\n        fn.cancel?.();\n      }\n    }\n    this.elementObservers.clear();\n    this.logDebug(\"ResizeManager destroyed\");\n  }\n}\n\n// Singleton instance\nexport const resizeManager = new ResizeManager();\n", "// src/spaceface/system/features/ScrollDeck/ScrollDeck.ts\n\nimport { EventBinder } from '../../bin/EventBinder.js';\nimport { AsyncImageLoader } from '../bin/AsyncImageLoader.js';\nimport { resizeManager } from '../bin/ResizeManager.js';\n\ninterface ScrollDeckOptions {\n  slideSelector?: string;\n  trackSelector?: string;\n  hudSelector?: string;\n  hintSelector?: string;\n  autoCreateHud?: boolean;\n  includePicture?: boolean;\n  debug?: boolean;\n  topStripPx?: number;\n  gate?: number;\n  backZPx?: number;\n  backScaleEnd?: number;\n  scrollPerSegment?: number;\n  hideHintAfter?: number;\n}\n\nexport class ScrollDeck {\n  static readonly DEFAULT_SLIDE_SELECTOR = '.slide';\n  static readonly DEFAULT_TRACK_SELECTOR = '#track';\n  static readonly DEFAULT_HUD_SELECTOR = '#hud';\n  static readonly DEFAULT_HINT_SELECTOR = '#hint';\n  static readonly DEFAULT_TOP_STRIP_PX = 100;\n  static readonly DEFAULT_GATE = 0.12;\n  static readonly DEFAULT_BACK_Z_PX = -220;\n  static readonly DEFAULT_BACK_SCALE_END = 0.78;\n  static readonly DEFAULT_SCROLL_PER_SEGMENT = 1.6;\n  static readonly DEFAULT_HINT_HIDE_PROGRESS = 0.12;\n\n  private readonly container: HTMLElement;\n  private readonly binder: EventBinder;\n  private readonly loader: AsyncImageLoader;\n  private readonly debug: boolean;\n\n  private readonly slideSelector: string;\n  private readonly trackSelector: string;\n  private readonly hudSelector: string;\n  private readonly hintSelector: string;\n  private readonly autoCreateHud: boolean;\n\n  private readonly topStripPx: number;\n  private readonly gate: number;\n  private readonly backZPx: number;\n  private readonly backScaleEnd: number;\n  private readonly scrollPerSegment: number;\n  private readonly hideHintAfter: number;\n\n  private slides: HTMLElement[] = [];\n  private dots: HTMLElement[] = [];\n  private track: HTMLElement | null = null;\n  private hint: HTMLElement | null = null;\n  private hud: HTMLElement | null = null;\n\n  private unsubscribeWindowResize?: () => void;\n  private unsubscribeTrackResize?: () => void;\n\n  private rafPending = false;\n  private isDestroyed = false;\n\n  public initError: unknown = null;\n  public readonly ready: Promise<void>;\n\n  constructor(containerOrSelector: string | HTMLElement, options: ScrollDeckOptions = {}) {\n    this.container = this.resolveContainer(containerOrSelector);\n    this.debug = !!options.debug;\n    this.binder = new EventBinder(this.debug);\n    this.loader = new AsyncImageLoader(this.container, {\n      includePicture: options.includePicture ?? false,\n      debug: this.debug,\n    });\n\n    this.slideSelector = options.slideSelector ?? ScrollDeck.DEFAULT_SLIDE_SELECTOR;\n    this.trackSelector = options.trackSelector ?? ScrollDeck.DEFAULT_TRACK_SELECTOR;\n    this.hudSelector = options.hudSelector ?? ScrollDeck.DEFAULT_HUD_SELECTOR;\n    this.hintSelector = options.hintSelector ?? ScrollDeck.DEFAULT_HINT_SELECTOR;\n    this.autoCreateHud = options.autoCreateHud ?? true;\n\n    this.topStripPx = Math.max(0, options.topStripPx ?? ScrollDeck.DEFAULT_TOP_STRIP_PX);\n    this.gate = this.clamp(options.gate ?? ScrollDeck.DEFAULT_GATE, 0.01, 0.99);\n    this.backZPx = options.backZPx ?? ScrollDeck.DEFAULT_BACK_Z_PX;\n    this.backScaleEnd = this.clamp(options.backScaleEnd ?? ScrollDeck.DEFAULT_BACK_SCALE_END, 0.01, 1);\n    this.scrollPerSegment = Math.max(0.25, options.scrollPerSegment ?? ScrollDeck.DEFAULT_SCROLL_PER_SEGMENT);\n    this.hideHintAfter = this.clamp(options.hideHintAfter ?? ScrollDeck.DEFAULT_HINT_HIDE_PROGRESS, 0, 1);\n\n    this.ready = this.init()\n      .catch((err) => {\n        this.initError = err;\n        this.log('error', 'ScrollDeck init failed', err);\n      })\n      .then(() => {});\n  }\n\n  private log(level: 'debug' | 'info' | 'warn' | 'error', message: string, data?: unknown): void {\n    if (!this.debug && level === 'debug') return;\n    switch (level) {\n      case 'debug':\n        console.debug(`[ScrollDeck] [${level.toUpperCase()}] ${message}`, data);\n        break;\n      case 'info':\n        console.info(`[ScrollDeck] [${level.toUpperCase()}] ${message}`, data);\n        break;\n      case 'warn':\n        console.warn(`[ScrollDeck] [${level.toUpperCase()}] ${message}`, data);\n        break;\n      case 'error':\n        console.error(`[ScrollDeck] [${level.toUpperCase()}] ${message}`, data);\n        break;\n    }\n  }\n\n  private resolveContainer(containerOrSelector: string | HTMLElement): HTMLElement {\n    const container = typeof containerOrSelector === 'string'\n      ? document.querySelector<HTMLElement>(containerOrSelector)\n      : containerOrSelector;\n    if (!container) throw new Error('ScrollDeck: container element not found.');\n    return container;\n  }\n\n  private async init(): Promise<void> {\n    await this.loader.waitForImagesToLoad();\n    this.refreshElements();\n\n    if (!this.slides.length) {\n      this.log('warn', `No slides found with selector \"${this.slideSelector}\".`);\n      return;\n    }\n\n    this.setupDots();\n    this.setDeckHeight();\n    this.bindEvents();\n    this.render();\n    this.log('info', 'ScrollDeck initialized', { slides: this.slides.length });\n  }\n\n  private refreshElements(): void {\n    this.slides = Array.from(this.container.querySelectorAll<HTMLElement>(this.slideSelector));\n    this.track = this.container.querySelector<HTMLElement>(this.trackSelector);\n    this.hud = this.container.querySelector<HTMLElement>(this.hudSelector);\n    this.hint = this.container.querySelector<HTMLElement>(this.hintSelector);\n\n    if (!this.track) {\n      this.track = this.container;\n      this.log('warn', `Track not found with selector \"${this.trackSelector}\". Falling back to container.`);\n    }\n  }\n\n  private setupDots(): void {\n    if (!this.hud && this.autoCreateHud) {\n      this.hud = document.createElement('div');\n      this.hud.id = this.hudSelector.replace(/^#/, '') || 'hud';\n      this.container.appendChild(this.hud);\n    }\n\n    if (!this.hud) return;\n\n    this.hud.innerHTML = '';\n    this.dots = this.slides.map(() => {\n      const dot = document.createElement('div');\n      dot.className = 'hud-dot';\n      this.hud!.appendChild(dot);\n      return dot;\n    });\n  }\n\n  private bindEvents(): void {\n    this.binder.bindDOM(window, 'scroll', () => this.requestRender(), { passive: true });\n\n    this.unsubscribeWindowResize = resizeManager.onWindow(() => {\n      this.setDeckHeight();\n      this.requestRender();\n    });\n\n    if (this.track) {\n      this.unsubscribeTrackResize = resizeManager.onElement(this.track, () => {\n        this.requestRender();\n      }, { debounceMs: 50 });\n    }\n  }\n\n  private setDeckHeight(): void {\n    const vh = window.innerHeight;\n    this.container.style.height = `${(this.slides.length * this.scrollPerSegment + 1) * vh}px`;\n  }\n\n  private requestRender(): void {\n    if (this.isDestroyed || this.rafPending) return;\n    this.rafPending = true;\n    requestAnimationFrame(() => {\n      this.rafPending = false;\n      this.render();\n    });\n  }\n\n  private clamp(value: number, min = 0, max = 1): number {\n    return Math.max(min, Math.min(max, value));\n  }\n\n  private norm(value: number, start: number, end: number): number {\n    return this.clamp((value - start) / (end - start));\n  }\n\n  private easeOutQuart(t: number): number {\n    return 1 - Math.pow(1 - t, 4);\n  }\n\n  private easeInOutCubic(t: number): number {\n    return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;\n  }\n\n  private hideSlide(slide: HTMLElement): void {\n    const h = this.track?.clientHeight || window.innerHeight;\n    slide.style.visibility = 'hidden';\n    slide.style.zIndex = '0';\n    slide.style.transform = `translate3d(0, ${h}px, 0) scale(1)`;\n  }\n\n  private showSlide(slide: HTMLElement, ty: number, tz: number, scale: number, z: number): void {\n    slide.style.visibility = 'visible';\n    slide.style.zIndex = String(z);\n    slide.style.transform = `translate3d(0, ${ty}px, ${tz}px) scale(${scale})`;\n  }\n\n  private getProgress(): number {\n    const vh = window.innerHeight;\n    const yInDeck = -this.container.getBoundingClientRect().top;\n    const n = this.slides.length;\n    return this.clamp(yInDeck / (this.scrollPerSegment * vh), 0, n);\n  }\n\n  private renderDots(segment: number, local: number): void {\n    if (!this.dots.length) return;\n    let activeDot = segment;\n    if (segment > 0 && local < this.gate) activeDot = segment - 1;\n    this.dots.forEach((dot, index) => dot.classList.toggle('active', index === activeDot));\n  }\n\n  private renderHint(progress: number): void {\n    if (!this.hint) return;\n    this.hint.style.opacity = progress < this.hideHintAfter ? '1' : '0';\n  }\n\n  private render(): void {\n    if (this.isDestroyed || !this.slides.length) return;\n\n    const n = this.slides.length;\n    const progress = this.getProgress();\n    const segment = Math.min(Math.floor(progress), n - 1);\n    const local = this.clamp(progress - segment, 0, 1);\n\n    const cardH = this.track?.clientHeight || window.innerHeight;\n    const startY = Math.max(0, cardH - this.topStripPx);\n\n    this.slides.forEach((slide) => this.hideSlide(slide));\n    this.renderDots(segment, local);\n    this.renderHint(progress);\n\n    if (segment === 0) {\n      const t = this.easeOutQuart(local);\n      const ty = startY * (1 - t);\n      this.showSlide(this.slides[0], ty, 0, 1, 10);\n      return;\n    }\n\n    const prev = segment - 1;\n    const curr = segment;\n    const prevSlide = this.slides[prev];\n    const currSlide = this.slides[curr];\n    if (!prevSlide || !currSlide) return;\n\n    if (local < this.gate) {\n      const t = this.easeInOutCubic(this.norm(local, 0, this.gate));\n      const tz = this.backZPx * t;\n      const scale = 1 + (this.backScaleEnd - 1) * t;\n      this.showSlide(prevSlide, 0, tz, scale, 5);\n      return;\n    }\n\n    const t = this.easeOutQuart(this.norm(local, this.gate, 1));\n    const prevScale = this.backScaleEnd - 0.04 * t;\n    const currY = startY * (1 - t);\n\n    this.showSlide(prevSlide, 0, this.backZPx, prevScale, 4);\n    this.showSlide(currSlide, currY, 0, 1, 10);\n  }\n\n  public refresh(): void {\n    if (this.isDestroyed) return;\n    this.refreshElements();\n    this.setupDots();\n    this.setDeckHeight();\n    this.requestRender();\n  }\n\n  public destroy(): void {\n    if (this.isDestroyed) return;\n    this.isDestroyed = true;\n    this.unsubscribeWindowResize?.();\n    this.unsubscribeTrackResize?.();\n    this.binder.unbindAll();\n    this.loader.destroy();\n    this.slides = [];\n    this.dots = [];\n    this.track = null;\n    this.hud = null;\n    this.hint = null;\n    this.log('info', 'ScrollDeck destroyed');\n  }\n}\n", "// src/spaceface/system/features/bin/math.ts\n\n\n/**\n * Clamps a number within the inclusive range specified by the minimum and maximum values.\n *\n * @param value - The number to clamp.\n * @param min - The lower bound of the range.\n * @param max - The upper bound of the range.\n * @returns The clamped value.\n * @throws Will throw an error if `min` is greater than `max`.\n */\nexport const clamp = (value: number, min: number, max: number): number => {\n  if (min > max) {\n    throw new RangeError('The `min` value cannot be greater than the `max` value.');\n  }\n  return Math.max(min, Math.min(value, max));\n};\n\n/**\n * Performs a linear interpolation between two values.\n *\n * @param a - The start value.\n * @param b - The end value.\n * @param t - The interpolation factor (typically between 0 and 1).\n * @returns The interpolated value.\n * @throws Will throw an error if `t` is not between 0 and 1.\n */\nexport const lerp = (a: number, b: number, t: number): number => {\n  if (t < 0 || t > 1) {\n    throw new RangeError('The interpolation factor `t` must be between 0 and 1.');\n  }\n  return (1 - t) * a + t * b;\n};\n", "// src/spaceface/features/FloatingImages/FloatingImage.ts\n\n\nimport { clamp } from '../bin/math.js';\n\nimport type {\n    ContainerDimensionsInterface,\n    FloatingImageOptionsInterface\n} from './types.js';\n\nconst DAMPING = 0.85;\nconst MIN_VELOCITY = 0.1;\nconst MAX_SPEED = 2.5;\nconst VELOCITY_JITTER = 0.02;\n\nexport class FloatingImage {\n    private element: HTMLElement | null;\n    private size: { width: number; height: number };\n    private x: number;\n    private y: number;\n    private vx: number;\n    private vy: number;\n    private options: Required<FloatingImageOptionsInterface>;\n\n    constructor(element: HTMLElement, dims: ContainerDimensionsInterface, options: FloatingImageOptionsInterface = {}) {\n        this.element = element;\n        this.options = { useSubpixel: true, debug: false, ...options };\n        this.size = { width: element.offsetWidth, height: element.offsetHeight };\n\n        // guard against negative ranges if container is smaller than image\n        this.x = Math.random() * Math.max(0, dims.width - this.size.width);\n        this.y = Math.random() * Math.max(0, dims.height - this.size.height);\n\n        this.vx = (Math.random() - 0.5) * 3;\n        this.vy = (Math.random() - 0.5) * 3;\n\n        element.style.willChange = 'transform';\n        element.style.backfaceVisibility = 'hidden';\n        element.style.perspective = '1000px';\n        element.style.opacity = '1';\n\n        this.updatePosition();\n    }\n\n    private logDebug(message: string, data?: unknown): void {\n        if (this.options.debug) {\n            console.debug(`[FloatingImage] ${message}`, data);\n        }\n    }\n\n    updatePosition(): boolean {\n        if (!this.element) {\n            this.logDebug(\"updatePosition called on destroyed element\");\n            return false;\n        }\n        const x = this.options.useSubpixel ? this.x : Math.round(this.x);\n        const y = this.options.useSubpixel ? this.y : Math.round(this.y);\n        this.element.style.transform = `translate3d(${x}px, ${y}px, 0)`;\n        this.logDebug(\"Position updated\", { x, y });\n        return true;\n    }\n\n    getElement(): HTMLElement | null {\n        return this.element;\n    }\n\n    update(multiplier: number, dims: ContainerDimensionsInterface, applyPosition = true): boolean {\n        if (!this.element) {\n            this.logDebug(\"update called on destroyed element\");\n            return false;\n        }\n\n        this.x += this.vx * multiplier;\n        this.y += this.vy * multiplier;\n\n        this.handleCollisions(dims);\n        this.applyVelocityJitter();\n\n        if (applyPosition) return this.updatePosition();\n        return true;\n    }\n\n    private handleCollisions(dims: ContainerDimensionsInterface): void {\n        if (this.x <= 0 || this.x + this.size.width >= dims.width) {\n            this.vx = -this.vx * DAMPING;\n            const signX = this.vx >= 0 ? 1 : -1;\n            this.vx = Math.abs(this.vx) < MIN_VELOCITY ? signX * MIN_VELOCITY : this.vx;\n            this.x = clamp(this.x, 0, Math.max(0, dims.width - this.size.width));\n            this.logDebug(\"Horizontal collision handled\", { x: this.x, vx: this.vx });\n        }\n\n        if (this.y <= 0 || this.y + this.size.height >= dims.height) {\n            this.vy = -this.vy * DAMPING;\n            const signY = this.vy >= 0 ? 1 : -1;\n            this.vy = Math.abs(this.vy) < MIN_VELOCITY ? signY * MIN_VELOCITY : this.vy;\n            this.y = clamp(this.y, 0, Math.max(0, dims.height - this.size.height));\n            this.logDebug(\"Vertical collision handled\", { y: this.y, vy: this.vy });\n        }\n    }\n\n    private applyVelocityJitter(): void {\n        this.vx += (Math.random() - 0.5) * VELOCITY_JITTER;\n        this.vy += (Math.random() - 0.5) * VELOCITY_JITTER;\n\n        const speedSquared = this.vx ** 2 + this.vy ** 2;\n        if (speedSquared > MAX_SPEED ** 2) {\n            const scale = MAX_SPEED / Math.sqrt(speedSquared);\n            this.vx *= scale;\n            this.vy *= scale;\n            this.logDebug(\"Velocity clamped\", { vx: this.vx, vy: this.vy });\n        }\n    }\n\n    resetPosition(dims: ContainerDimensionsInterface) {\n        this.x = Math.random() * Math.max(0, dims.width - this.size.width);\n        this.y = Math.random() * Math.max(0, dims.height - this.size.height);\n        this.updatePosition(); // must be called\n    }\n\n\n    updateSize() {\n        if (!this.element) return;\n        this.size.width = this.element.offsetWidth;\n        this.size.height = this.element.offsetHeight;\n    }\n\n    clampPosition(dims: ContainerDimensionsInterface) {\n        this.x = clamp(this.x, 0, Math.max(0, dims.width - this.size.width));\n        this.y = clamp(this.y, 0, Math.max(0, dims.height - this.size.height));\n    }\n\n    destroy() {\n        if (!this.element) return;\n        this.element.style.willChange = 'auto';\n        this.element.style.backfaceVisibility = '';\n        this.element.style.perspective = '';\n        this.element = null;\n    }\n}\n", "// src/spaceface/system/features/bin/PerformanceMonitor.ts\n\n\nimport {\n  PerformanceLevel,\n  PerformanceSettingsInterface,\n} from '../../types/bin.js';\n\nexport class PerformanceMonitor {\n  private fps: number = 60;\n  private lastTime: number = performance.now();\n  private frameSkipThreshold: number = 30;\n  private shouldSkipFrame: boolean = false;\n  private frameCount: number = 0;\n\n  private cachedPerformanceLevel: PerformanceLevel = 'high';\n  private lastLevelUpdate: number = 0;\n  private levelUpdateInterval: number = 1000;\n  private cachedSettings: PerformanceSettingsInterface | null = null;\n\n  private lastLoggedFPS: number = 60;\n  private fpsLogThreshold: number = 5;\n\n  /** Updates FPS and returns whether to skip this frame */\n  public update(): boolean {\n    const now = performance.now();\n    const delta = now - this.lastTime;\n    if (delta < 1) return this.shouldSkipFrame;\n\n    const currentFPS = 1000 / delta;\n    this.fps = this.fps * 0.9 + currentFPS * 0.1; // smoothing\n    this.frameCount++;\n\n    this.shouldSkipFrame = this.fps < this.frameSkipThreshold;\n\n    if (Math.abs(this.fps - this.lastLoggedFPS) >= this.fpsLogThreshold) {\n      // eventBus.emit('performance:fps', { fps: this.getCurrentFPS(), frameSkip: this.shouldSkipFrame });\n      this.lastLoggedFPS = this.fps;\n    }\n\n    this.lastTime = now;\n    return this.shouldSkipFrame;\n  }\n\n  public getFrameCount(): number { return this.frameCount; }\n  public getCurrentFPS(): number { return Math.round(this.fps * 10) / 10; }\n\n  public getPerformanceLevel(): PerformanceLevel {\n    const now = performance.now();\n    if (now - this.lastLevelUpdate > this.levelUpdateInterval) {\n      this.cachedPerformanceLevel = this.fps >= 50 ? 'high' : this.fps >= 30 ? 'medium' : 'low';\n      this.lastLevelUpdate = now;\n      this.cachedSettings = null;\n      // eventBus.emit('performance:level', { level: this.cachedPerformanceLevel, fps: this.getCurrentFPS() });\n    }\n    return this.cachedPerformanceLevel;\n  }\n\n  public getRecommendedSettings(): PerformanceSettingsInterface {\n    if (this.cachedSettings) return this.cachedSettings;\n\n    const level = this.getPerformanceLevel();\n    const settingsMap: Record<PerformanceLevel, PerformanceSettingsInterface> = {\n      high: { maxImages: 50, speedMultiplier: 1.0, useSubpixel: true },\n      medium: { maxImages: 25, speedMultiplier: 0.8, useSubpixel: false },\n      low: { maxImages: 10, speedMultiplier: 0.5, useSubpixel: false },\n    };\n    this.cachedSettings = settingsMap[level];\n    return this.cachedSettings;\n  }\n\n  public reset(): void {\n    this.fps = 60;\n    this.lastTime = performance.now();\n    this.shouldSkipFrame = false;\n    this.frameCount = 0;\n    this.cachedPerformanceLevel = 'high';\n    this.lastLevelUpdate = 0;\n    this.cachedSettings = null;\n    this.lastLoggedFPS = 60;\n  }\n}\n", "// src/spaceface/features/FloatingImages/FloatingImagesManager.ts\n\n\nimport { FloatingImage } from './FloatingImage.js';\nimport { PerformanceMonitor } from '../bin/PerformanceMonitor.js';\nimport { resizeManager } from '../bin/ResizeManager.js';\nimport { AsyncImageLoader } from '../bin/AsyncImageLoader.js';\nimport { animationLoop } from '../bin/AnimationLoop.js';\nimport { eventBus } from '../../bin/EventBus.js';\nimport { debounce } from '../bin/timing.js';\nimport { AnimationPolicy } from '../bin/AnimationPolicy.js';\nimport type { LogPayload } from '../../types/bin.js';\nimport { EVENTS } from '../../types/events.js';\n\nimport type {\n    FloatingImagesManagerOptionsInterface,\n    ContainerDimensionsInterface\n} from './types.js';\nimport type { FloatingImagesManagerInterface } from '../../types/features.js';\n\nexport class FloatingImagesManager implements FloatingImagesManagerInterface {\n    readonly container: HTMLElement;\n    performanceMonitor: PerformanceMonitor;\n    images: FloatingImage[] = [];\n    speedMultiplier: number = 1;\n    isInViewport: boolean = true;\n    private _destroyed: boolean = false;\n    private animateCallback: () => void;\n    maxImages: number;\n    intersectionObserver: IntersectionObserver;\n    unsubscribeWindow?: () => void;\n    unsubscribeElement?: () => void;\n    imageLoader: AsyncImageLoader;\n    containerWidth!: number;\n    containerHeight!: number;\n    debug: boolean;\n    hoverBehavior: 'none' | 'slow' | 'stop';\n    hoverSlowMultiplier: number;\n    tapToFreeze: boolean;\n    pauseOnScreensaver: boolean;\n    private interactionCleanups: Array<() => void> = [];\n    private frozenElements = new WeakSet<HTMLElement>();\n    private imageSpeedOverrides = new WeakMap<HTMLElement, number>();\n    private unsubScreensaverShown?: () => void;\n    private unsubScreensaverHidden?: () => void;\n    private unbindVisibility?: () => void;\n    private pausedByScreensaver = false;\n    private speedBeforeScreensaver = 1;\n    private animationPolicy = new AnimationPolicy();\n\n    constructor(container: HTMLElement, options: FloatingImagesManagerOptionsInterface = {}) {\n        this.container = container;\n        this.debug = options.debug ?? false;\n        this.hoverBehavior = options.hoverBehavior ?? 'none';\n        this.hoverSlowMultiplier = options.hoverSlowMultiplier ?? 0.2;\n        this.tapToFreeze = options.tapToFreeze ?? true;\n        this.pauseOnScreensaver = options.pauseOnScreensaver ?? false;\n\n        this.performanceMonitor = new PerformanceMonitor();\n        const perfSettings = this.performanceMonitor.getRecommendedSettings();\n        this.maxImages = options.maxImages ?? perfSettings.maxImages;\n\n        this.intersectionObserver = new IntersectionObserver(entries => {\n            const entry = entries[0];\n            if (!entry) return;\n            this.isInViewport = !!entry.isIntersecting;\n        }, { threshold: 0 });\n        this.intersectionObserver.observe(this.container);\n\n        this.setupResizeHandling();\n        this.setupScreensaverHandling();\n        this.imageLoader = new AsyncImageLoader(this.container);\n        this.updateContainerDimensions();\n\n        this.animateCallback = () => this.animate();\n\n        // Only add callback if not already in AnimationLoop\n        if (!animationLoop.has(this.animateCallback)) {\n            animationLoop.add(this.animateCallback);\n        }\n\n        this.initializeImages();\n        this.log('info', 'FloatingImagesManager initialized', {\n            container: this.container,\n            maxImages: this.maxImages\n        });\n    }\n\n    private log(level: 'debug' | 'info' | 'warn' | 'error', message: string, data?: unknown) {\n        if (!this.debug && level === 'debug') return;\n\n        const payload: LogPayload = { scope: 'FloatingImagesManager', level, message, data, time: Date.now() };\n        eventBus.emit(EVENTS.FLOATING_IMAGES_LOG, { level, message, data });\n        eventBus.emit(EVENTS.LOG, payload);\n\n        if (this.debug) {\n            switch (level) {\n                case 'debug':\n                    console.debug(`[FloatingImagesManager] [${level.toUpperCase()}]`, message, data);\n                    break;\n                case 'info':\n                    console.info(`[FloatingImagesManager] [${level.toUpperCase()}]`, message, data);\n                    break;\n                case 'warn':\n                    console.warn(`[FloatingImagesManager] [${level.toUpperCase()}]`, message, data);\n                    break;\n                case 'error':\n                    console.error(`[FloatingImagesManager] [${level.toUpperCase()}]`, message, data);\n                    break;\n            }\n        }\n    }\n\n    private setupResizeHandling() {\n        this.unsubscribeWindow = resizeManager.onWindow(() => this.handleResize());\n        this.unsubscribeElement = resizeManager.onElement(this.container, () => this.handleResize());\n    }\n\n    private setupScreensaverHandling() {\n        if (!this.pauseOnScreensaver) return;\n\n        this.unsubScreensaverShown = eventBus.on(EVENTS.SCREENSAVER_SHOWN, () => {\n            if (this.pausedByScreensaver) return;\n            this.speedBeforeScreensaver = this.speedMultiplier;\n            this.speedMultiplier = 0;\n            this.pausedByScreensaver = true;\n            this.animationPolicy.set('screensaver', true);\n            this.log('debug', 'Paused due to screensaver');\n        });\n\n        this.unsubScreensaverHidden = eventBus.on(EVENTS.SCREENSAVER_HIDDEN, () => {\n            if (!this.pausedByScreensaver) return;\n            this.speedMultiplier = this.speedBeforeScreensaver;\n            this.pausedByScreensaver = false;\n            this.animationPolicy.set('screensaver', false);\n            this.log('debug', 'Resumed after screensaver');\n        });\n\n        const onVisibilityChange = () => {\n            this.animationPolicy.set('hidden', document.visibilityState === 'hidden');\n        };\n        document.addEventListener('visibilitychange', onVisibilityChange);\n        this.unbindVisibility = () => document.removeEventListener('visibilitychange', onVisibilityChange);\n    }\n\n    private updateContainerDimensions() {\n        if (!this.container.isConnected) {\n            this.containerWidth = 0;\n            this.containerHeight = 0;\n            this.log('warn', 'Container is not in the DOM, dimensions set to 0');\n            return;\n        }\n        const dims = resizeManager.getElement(this.container);\n        this.containerWidth = dims.width;\n        this.containerHeight = dims.height;\n    }\n\n    private async initializeImages() {\n        try {\n            const imgElements = await this.imageLoader.waitForImagesToLoad('.floating-image');\n            const dims = { width: this.containerWidth, height: this.containerHeight };\n            // if destroyed while awaiting, avoid adding images\n            imgElements.slice(0, this.maxImages).forEach(el => {\n                if (this._destroyed) return;\n                this.addExistingImage(el, dims);\n            });\n            this.log('info', 'Images initialized', { count: this.images.length });\n        } catch (err) {\n            this.log('error', 'Failed to initialize images', err);\n        }\n    }\n\n    private addExistingImage(el: HTMLElement, dims: ContainerDimensionsInterface) {\n        if (this.images.length >= this.maxImages) return;\n        const floatingImage = new FloatingImage(el, dims, { debug: this.debug });\n        this.images.push(floatingImage);\n        this.bindImageInteraction(el);\n    }\n\n    private handleResize = debounce(() => {\n        try {\n            if (this._destroyed) return;\n            if (!this.container.isConnected) {\n                this.log('warn', 'Resize event ignored, container not in DOM');\n                return;\n            }\n            this.updateContainerDimensions();\n            const dims = { width: this.containerWidth, height: this.containerHeight };\n            this.images.forEach(img => {\n                img.updateSize();\n                img.clampPosition(dims);\n                img.updatePosition();\n            });\n            this.log('debug', 'Container resized', dims);\n        } catch (error) {\n            this.log('error', 'Error during handleResize', error);\n        }\n    }, 200);\n\n    private animate() {\n        if (this._destroyed) return;\n\n        if (!this.isInViewport || this.speedMultiplier === 0 || this.animationPolicy.isPaused()) return;\n\n        const skipFrame = this.performanceMonitor.update();\n        if (skipFrame) return;\n\n        const multiplier = this.speedMultiplier;\n        const dims = { width: this.containerWidth, height: this.containerHeight };\n\n        this.images = this.images.filter(img => {\n            const el = img.getElement();\n            const imageMultiplier = el ? (this.imageSpeedOverrides.get(el) ?? multiplier) : multiplier;\n            if (imageMultiplier <= 0) {\n                return img.updatePosition();\n            }\n            return img.update(imageMultiplier, dims);\n        });\n    }\n\n    public resetAllImagePositions() {\n        const dims = { width: this.containerWidth, height: this.containerHeight };\n        this.images.forEach(img => img.resetPosition(dims));\n        this.log('debug', 'All image positions reset', dims);\n    }\n\n    public reinitializeImages() {\n        try {\n            if (this._destroyed) return;\n            if (!this.container.isConnected) {\n                this.log('warn', 'reinitializeImages: container not in DOM, skipping');\n                return;\n            }\n\n            this.images.forEach(img => img.destroy());\n            this.images.length = 0;\n            this.unbindImageInteractions();\n\n            const dims = { width: this.containerWidth, height: this.containerHeight };\n            const imgElements = Array.from(this.container.querySelectorAll<HTMLElement>('.floating-image'))\n                .slice(0, this.maxImages);\n\n            imgElements.forEach(el => {\n                const floatingImage = new FloatingImage(el, dims, { debug: this.debug });\n                this.images.push(floatingImage);\n                this.bindImageInteraction(el);\n            });\n\n            this.log('info', 'Images reinitialized', { count: this.images.length });\n        } catch (error) {\n            this.log('error', 'Error during reinitializeImages', error);\n        }\n    }\n\n    destroy() {\n        if (this._destroyed) return;\n\n        this._destroyed = true;\n\n        if (animationLoop.has(this.animateCallback)) {\n            animationLoop.remove(this.animateCallback);\n        }\n\n        this.unsubscribeWindow?.();\n        this.unsubscribeElement?.();\n        this.unsubScreensaverShown?.();\n        this.unsubScreensaverHidden?.();\n        this.unbindVisibility?.();\n        // clear unsubscribe refs to avoid keeping closures alive\n        this.unsubscribeWindow = undefined;\n        this.unsubscribeElement = undefined;\n        this.unsubScreensaverShown = undefined;\n        this.unsubScreensaverHidden = undefined;\n        this.unbindVisibility = undefined;\n\n        this.intersectionObserver.disconnect();\n        this.unbindImageInteractions();\n        this.images.forEach(img => img.destroy());\n        this.images.length = 0;\n        this.imageLoader.destroy();\n\n        // reset container dims\n        this.containerWidth = 0;\n        this.containerHeight = 0;\n\n        this.log('info', 'FloatingImagesManager destroyed');\n    }\n\n    private bindImageInteraction(el: HTMLElement): void {\n        const hoverEnabled = this.hoverBehavior !== 'none';\n        const touchEnabled = this.tapToFreeze;\n        if (!hoverEnabled && !touchEnabled) return;\n\n        const onPointerEnter = () => {\n            if (this.hoverBehavior === 'none') return;\n            if (this.frozenElements.has(el)) return;\n            if (this.hoverBehavior === 'stop') {\n                this.imageSpeedOverrides.set(el, 0);\n                return;\n            }\n            this.imageSpeedOverrides.set(el, this.hoverSlowMultiplier);\n        };\n\n        const onPointerLeave = () => {\n            if (this.frozenElements.has(el)) return;\n            this.imageSpeedOverrides.delete(el);\n        };\n\n        const onPointerUp = (event: PointerEvent) => {\n            if (!this.tapToFreeze || event.pointerType !== 'touch') return;\n            if (this.frozenElements.has(el)) {\n                this.frozenElements.delete(el);\n                this.imageSpeedOverrides.delete(el);\n                return;\n            }\n            this.frozenElements.add(el);\n            this.imageSpeedOverrides.set(el, 0);\n        };\n\n        el.addEventListener('pointerenter', onPointerEnter);\n        el.addEventListener('pointerleave', onPointerLeave);\n        el.addEventListener('pointerup', onPointerUp);\n\n        this.interactionCleanups.push(() => {\n            el.removeEventListener('pointerenter', onPointerEnter);\n            el.removeEventListener('pointerleave', onPointerLeave);\n            el.removeEventListener('pointerup', onPointerUp);\n            this.imageSpeedOverrides.delete(el);\n        });\n    }\n\n    private unbindImageInteractions(): void {\n        this.interactionCleanups.forEach(unsub => unsub());\n        this.interactionCleanups = [];\n        this.frozenElements = new WeakSet<HTMLElement>();\n        this.imageSpeedOverrides = new WeakMap<HTMLElement, number>();\n    }\n}\n", "// src/spaceface/features/Screensaver/ScreensaverController.ts\n\n\nimport { eventBus } from \"../../bin/EventBus.js\";\nimport { EventBinder } from \"../../bin/EventBinder.js\";\nimport { InactivityWatcher } from \"../../bin/InactivityWatcher.js\";\nimport { PartialFetcher } from \"../../bin/PartialFetcher.js\";\nimport { FloatingImagesManager } from \"../FloatingImages/FloatingImagesManager.js\";\nimport type { LogPayload } from \"../../types/bin.js\";\nimport { EVENTS } from \"../../types/events.js\";\n\nimport type {\n  ScreensaverControllerOptionsInterface,\n  FloatingImagesManagerInterface\n} from \"../../types/features.js\";\n\nexport class ScreensaverController {\n  private static readonly STATES = {\n    IDLE: 'idle',\n    LOADING: 'loading',\n    VISIBLE: 'visible',\n    HIDING: 'hiding',\n    DESTROYED: 'destroyed',\n  } as const;\n\n  private readonly partialUrl: string;\n  private readonly targetSelector: string;\n  private readonly inactivityDelay: number;\n  private readonly debug: boolean;\n  private readonly onError?: (message: string, error: unknown) => void;\n\n  private screensaverManager: FloatingImagesManagerInterface | null = null;\n  private watcher: InactivityWatcher | null = null;\n  private _destroyed = false;\n  private eventBinder: EventBinder;\n  private _partialLoaded = false;\n  private partialFetcher: typeof PartialFetcher;\n  // avoid duplicate concurrent partial loads\n  private _loadPromise?: Promise<void>;\n  private _hideTimeout: number | null = null;\n  private _bound = false;\n  private state: typeof ScreensaverController.STATES[keyof typeof ScreensaverController.STATES] = ScreensaverController.STATES.IDLE;\n\n  private _onInactivity: () => void;\n  private _onActivity: () => void;\n\n  constructor(\n    options: ScreensaverControllerOptionsInterface & {\n      watcher?: InactivityWatcher;\n      partialFetcher?: typeof PartialFetcher;\n      debug?: boolean;\n    }\n  ) {\n    this.partialUrl = options.partialUrl;\n    this.targetSelector = options.targetSelector;\n    this.inactivityDelay = options.inactivityDelay ?? 12000;\n    this.debug = !!options.debug;\n\n    this.watcher = options.watcher ?? null;\n    this.partialFetcher = options.partialFetcher ?? PartialFetcher;\n    this.onError = options.onError;\n\n    this.eventBinder = new EventBinder(this.debug);\n    this._onInactivity = this.showScreensaver.bind(this);\n    this._onActivity = this.hideScreensaver.bind(this);\n\n    this.log('info', 'ScreensaverController initialized', {\n      partialUrl: this.partialUrl,\n      targetSelector: this.targetSelector,\n      inactivityDelay: this.inactivityDelay\n    });\n  }\n\n  /** Centralized logging with debug and level support */\n  private log(\n    level: 'debug' | 'info' | 'warn' | 'error',\n    message: string,\n    data?: unknown\n  ) {\n    if (!this.debug && level === 'debug') return;\n\n    const payload: LogPayload = { scope: 'ScreensaverController', level, message, data, time: Date.now() };\n    eventBus.emit(EVENTS.SCREENSAVER_LOG, { level, message, data });\n    eventBus.emit(EVENTS.LOG, payload);\n\n    if (this.debug) {\n      switch (level) {\n        case 'debug':\n          console.debug(`[ScreensaverController] [${level.toUpperCase()}]`, message, data);\n          break;\n        case 'info':\n          console.info(`[ScreensaverController] [${level.toUpperCase()}]`, message, data);\n          break;\n        case 'warn':\n          console.warn(`[ScreensaverController] [${level.toUpperCase()}]`, message, data);\n          break;\n        case 'error':\n          console.error(`[ScreensaverController] [${level.toUpperCase()}]`, message, data);\n          break;\n      }\n    }\n  }\n\n  async init(): Promise<void> {\n    if (this._destroyed) return;\n    if (this._bound) return;\n\n    try {\n      if (!this.watcher) {\n        this.watcher = InactivityWatcher.getInstance({\n          inactivityDelay: this.inactivityDelay\n        });\n      }\n\n      this.eventBinder.bindBus(EVENTS.USER_INACTIVE, this._onInactivity);\n      this.eventBinder.bindBus(EVENTS.USER_ACTIVE, this._onActivity);\n      this._bound = true;\n\n      this.log('info', 'Bound user inactivity/active events');\n    } catch (error) {\n      this.handleError('Failed to initialize inactivity watcher', error);\n    }\n  }\n\n  async showScreensaver(): Promise<void> {\n    if (this._destroyed) return;\n    if (this.state === ScreensaverController.STATES.VISIBLE || this.state === ScreensaverController.STATES.LOADING) return;\n\n    try {\n      this.state = ScreensaverController.STATES.LOADING;\n      if (!this._partialLoaded) {\n        if (!this._loadPromise) {\n          this._loadPromise = this.partialFetcher\n            .load(this.partialUrl, this.targetSelector)\n            .then(() => { this._partialLoaded = true; })\n            .finally(() => { this._loadPromise = undefined; });\n        }\n        await this._loadPromise;\n      }\n\n      const container = document.querySelector<HTMLElement>(this.targetSelector);\n      if (!container) {\n        this.state = ScreensaverController.STATES.IDLE;\n        this.handleError(`Target selector \"${this.targetSelector}\" not found`, null);\n        return;\n      }\n\n      container.style.opacity = '0';\n      container.style.display = '';\n      void container.offsetWidth; // force reflow\n      container.style.transition = 'opacity 0.5s ease';\n      container.style.opacity = '1';\n\n      if (!this.screensaverManager) {\n        this.screensaverManager = new FloatingImagesManager(container, { debug: this.debug });\n      } else {\n        this.screensaverManager.destroy();\n        this.screensaverManager = new FloatingImagesManager(container, { debug: this.debug });\n      }\n\n      this.state = ScreensaverController.STATES.VISIBLE;\n      eventBus.emit(EVENTS.SCREENSAVER_SHOWN, { targetSelector: this.targetSelector });\n      this.log('info', 'Screensaver displayed');\n    } catch (error) {\n      this.state = ScreensaverController.STATES.IDLE;\n      this.handleError('Failed to load or show screensaver', error);\n    }\n  }\n\n  hideScreensaver(): void {\n    if (this._destroyed) return;\n    if (this.state === ScreensaverController.STATES.IDLE || this.state === ScreensaverController.STATES.HIDING) return;\n\n    try {\n      this.state = ScreensaverController.STATES.HIDING;\n      const container = document.querySelector<HTMLElement>(this.targetSelector);\n      if (container) {\n        container.style.transition = 'opacity 0.5s ease';\n        container.style.opacity = '0';\n        if (this._hideTimeout) {\n          clearTimeout(this._hideTimeout);\n        }\n        this._hideTimeout = window.setTimeout(() => {\n          container.style.display = 'none';\n          this.state = ScreensaverController.STATES.IDLE;\n          this._hideTimeout = null;\n        }, 500);\n      } else {\n        this.state = ScreensaverController.STATES.IDLE;\n      }\n\n      eventBus.emit(EVENTS.SCREENSAVER_HIDDEN, { targetSelector: this.targetSelector });\n      this.log('debug', 'Screensaver hidden');\n    } catch (error) {\n      this.state = ScreensaverController.STATES.IDLE;\n      this.handleError('Failed to hide screensaver', error);\n    }\n  }\n\n  destroy(): void {\n    if (this._destroyed) return;\n    this.hideScreensaver();\n    this._destroyed = true;\n    this.state = ScreensaverController.STATES.DESTROYED;\n    try { this.screensaverManager?.destroy(); } catch (err) { this.log('warn', 'screensaverManager.destroy() failed', err); }\n    this.eventBinder.unbindAll();\n    this._partialLoaded = false;\n    if (this._hideTimeout) {\n      clearTimeout(this._hideTimeout);\n      this._hideTimeout = null;\n    }\n    // clear pending load ref to avoid holding Promise after destroy\n    this._loadPromise = undefined;\n    this._bound = false;\n\n    this.log('info', 'ScreensaverController destroyed');\n  }\n\n  private handleError(message: string, error: unknown): void {\n    eventBus.emit(EVENTS.SCREENSAVER_ERROR, { message, error });\n    this.onError?.(message, error);\n    this.log('error', message, error);\n  }\n}\n", "// Minimal PJAX implementation (no dependencies)\n\ntype PjaxOptions = {\n    containerSelector?: string;\n    linkSelector?: string;\n    scrollToTop?: boolean;\n    cache?: boolean;\n    maxCacheEntries?: number;\n};\n\ntype CachedEntry = {\n    title: string;\n    html: string;\n    url: string;\n};\n\nconst isAbortError = (error: unknown): boolean =>\n    error instanceof DOMException && error.name === 'AbortError';\n\nexport class Pjax {\n    private containerSelector: string;\n    private linkSelector: string;\n    private scrollToTop: boolean;\n    private cacheEnabled: boolean;\n    private maxCacheEntries: number;\n    private cache = new Map<string, CachedEntry>();\n    private currentRequest?: AbortController;\n\n    constructor(options: PjaxOptions = {}) {\n        this.containerSelector = options.containerSelector ?? '[data-pjax=\"container\"]';\n        this.linkSelector = options.linkSelector ?? 'a[href]';\n        this.scrollToTop = options.scrollToTop ?? true;\n        this.cacheEnabled = options.cache ?? true;\n        this.maxCacheEntries = Math.max(1, options.maxCacheEntries ?? 30);\n    }\n\n    init(): void {\n        document.addEventListener('click', this.onClick, true);\n        window.addEventListener('popstate', this.onPopState);\n    }\n\n    destroy(): void {\n        document.removeEventListener('click', this.onClick, true);\n        window.removeEventListener('popstate', this.onPopState);\n        this.currentRequest?.abort();\n        this.currentRequest = undefined;\n    }\n\n    private onClick = (event: MouseEvent) => {\n        if (event.defaultPrevented) return;\n        if (event.button !== 0) return;\n        if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) return;\n\n        const target = event.target as Element | null;\n        const link = target?.closest?.(this.linkSelector) as HTMLAnchorElement | null;\n        if (!link) return;\n        if (link.hasAttribute('download')) return;\n        if (link.getAttribute('rel') === 'external') return;\n        if (link.target && link.target !== '_self') return;\n        if (link.dataset.noPjax !== undefined) return;\n\n        const href = link.href;\n        if (!href) return;\n\n        const url = new URL(href, window.location.href);\n        if (url.origin !== window.location.origin) return;\n\n        // Same-page hash only: let browser handle\n        if (url.pathname === window.location.pathname && url.search === window.location.search && url.hash) {\n            return;\n        }\n\n        event.preventDefault();\n        void this.load(url.toString(), true);\n    };\n\n    private onPopState = () => {\n        void this.load(window.location.href, false);\n    };\n\n    async load(url: string, pushState: boolean): Promise<void> {\n        const container = document.querySelector<HTMLElement>(this.containerSelector);\n        if (!container) {\n            document.dispatchEvent(new CustomEvent('pjax:error', { detail: { url, error: new Error('PJAX container not found') } }));\n            window.location.href = url;\n            return;\n        }\n\n        this.currentRequest?.abort();\n        const controller = new AbortController();\n        this.currentRequest = controller;\n        const requestToken = controller;\n\n        container.setAttribute('data-pjax-loading', 'true');\n        document.dispatchEvent(new CustomEvent('pjax:before', { detail: { url } }));\n\n        try {\n            const cached = this.cacheEnabled ? this.cache.get(url) : undefined;\n            let title: string;\n            let html: string;\n\n            if (cached) {\n                // Refresh insertion order so frequently used pages stay cached.\n                this.cache.delete(url);\n                this.cache.set(url, cached);\n                ({ title, html } = cached);\n            } else {\n                const res = await fetch(url, {\n                    method: 'GET',\n                    headers: { 'X-PJAX': 'true' },\n                    signal: controller.signal,\n                    credentials: 'same-origin',\n                });\n                if (!res.ok) throw new Error(`PJAX HTTP ${res.status}`);\n                const text = await res.text();\n                const parsed = new DOMParser().parseFromString(text, 'text/html');\n                const nextContainer = parsed.querySelector<HTMLElement>(this.containerSelector);\n                if (!nextContainer) throw new Error(`PJAX container \"${this.containerSelector}\" not found`);\n\n                title = parsed.title || document.title;\n                html = nextContainer.innerHTML;\n\n                if (this.cacheEnabled) {\n                    this.cache.set(url, { title, html, url });\n                    while (this.cache.size > this.maxCacheEntries) {\n                        const firstKey = this.cache.keys().next().value;\n                        if (!firstKey) break;\n                        this.cache.delete(firstKey);\n                    }\n                }\n            }\n\n            // Ensure only the latest request can update the DOM\n            if (this.currentRequest !== requestToken) return;\n\n            // Note: scripts inside the swapped HTML will not execute automatically.\n            container.innerHTML = html;\n            document.title = title;\n\n            if (pushState) {\n                history.pushState({ pjax: true }, '', url);\n            }\n\n            if (this.scrollToTop) {\n                window.scrollTo({ top: 0, left: 0, behavior: 'auto' });\n            }\n\n            document.dispatchEvent(new CustomEvent('pjax:complete', { detail: { url } }));\n        } catch (error) {\n            if (!isAbortError(error)) {\n                document.dispatchEvent(new CustomEvent('pjax:error', { detail: { url, error } }));\n                window.location.href = url;\n            }\n        } finally {\n            container.removeAttribute('data-pjax-loading');\n        }\n    }\n}\n\nexport function initPjax(options: PjaxOptions = {}): Pjax {\n    const pjax = new Pjax(options);\n    pjax.init();\n    return pjax;\n}\n", "import type { SpacefaceFeaturesConfig } from '../types.js';\n\nexport const defaultFeatures = {\n    slideplayer: { interval: 5000, includePicture: false },\n    floatingImages: {\n        selector: '.floating-images-container',\n        maxImages: 24,\n        debug: false,\n        hoverBehavior: 'slow',\n        hoverSlowMultiplier: 0.2,\n        tapToFreeze: true,\n    },\n    scrollDeck: {\n        selector: '.scroll-deck-container',\n        includePicture: false,\n        debug: false,\n    },\n    screensaver: { delay: 4500, partialUrl: 'content/feature/screensaver/index.html' },\n} satisfies SpacefaceFeaturesConfig;\n\nexport const devFeatures = {\n    ...defaultFeatures,\n    partialLoader: { enabled: true, debug: true, baseUrl: '/', cacheEnabled: true },\n} satisfies SpacefaceFeaturesConfig;\n", "// src/spaceface/system/bin/DomReadyPromise.ts\n\n\nimport { WaitForElementOptions } from '../types/bin.js';\n\n/**\n * Utility class for DOM readiness and waiting for elements to appear.\n * Provides:\n * - A promise for when the DOM is ready (`DOMContentLoaded`).\n * - A helper to wait until specific elements are present in the DOM.\n */\nexport class DomReadyPromise {\n    /** Cached promise that resolves once the DOM is ready */\n    static #readyPromise: Promise<void> | null = null;\n\n    /**\n     * Returns a promise that resolves when the DOM is fully loaded.\n     */\n    static ready(): Promise<void> {\n        if (!this.#readyPromise) {\n            this.#readyPromise = document.readyState !== 'loading'\n                ? Promise.resolve()\n                : new Promise<void>(resolve => {\n                    document.addEventListener('DOMContentLoaded', () => resolve(), { once: true });\n                });\n        }\n        return this.#readyPromise;\n    }\n\n    /**\n     * Waits for one or more DOM elements to appear in the document.\n     */\n    static waitForElement<T extends Element>(\n        selectors: string | string[],\n        options: WaitForElementOptions = {}\n    ): Promise<T | T[]> {\n        const { timeout = 5000, root = document, signal } = options;\n        if (timeout <= 0) {\n            return Promise.reject(new TypeError('Timeout must be greater than 0'));\n        }\n\n        const selectorList = Array.isArray(selectors) ? selectors : [selectors];\n        const foundElements: Map<string, T> = new Map();\n\n        return new Promise((resolve, reject) => {\n            const checkForElements = () => {\n                for (const selector of selectorList) {\n                    if (!foundElements.has(selector)) {\n                        const el = root.querySelector<T>(selector);\n                        if (el) foundElements.set(selector, el);\n                    }\n                }\n                if (foundElements.size === selectorList.length) {\n                    cleanup();\n                    resolve(selectorList.length === 1\n                        ? foundElements.get(selectorList[0])!\n                        : Array.from(foundElements.values()));\n                }\n            };\n\n            const observer = new MutationObserver(checkForElements);\n            if (signal?.aborted) {\n                reject(new DOMException('waitForElement aborted', 'AbortError'));\n                return;\n            }\n\n            const timeoutId = window.setTimeout(() => {\n                cleanup();\n                const missing = selectorList.filter(s => !foundElements.has(s));\n                reject(new DOMException(\n                    `Element(s) \"${missing.join(', ')}\" not found within ${timeout}ms in root: ${root.nodeName}`,\n                    'TimeoutError'\n                ));\n            }, timeout);\n\n            const cleanup = () => {\n                observer.disconnect();\n                clearTimeout(timeoutId);\n                signal?.removeEventListener('abort', onAbort);\n            };\n\n            const onAbort = () => {\n                cleanup();\n                reject(new DOMException('waitForElement aborted', 'AbortError'));\n            };\n\n            signal?.addEventListener('abort', onAbort, { once: true });\n\n            observer.observe(root, { childList: true, subtree: true });\n            // Check immediately in case elements already exist\n            checkForElements();\n        });\n    }\n}\n", "// src/spaceface/app/bin/symlinks.ts\n\nexport { DomReadyPromise } from \"../system/bin/DomReadyPromise.js\";\nexport { InactivityWatcher } from \"../system/bin/InactivityWatcher.js\";\nexport { eventBus } from \"../system/bin/EventBus.js\";\nexport { EventBinder } from \"../system/bin/EventBinder.js\";\nexport { EventWatcher } from \"../system/bin/EventWatcher.js\";\nexport { PartialFetcher } from \"../system/bin/PartialFetcher.js\";\nexport { PartialLoader } from \"../system/bin/PartialLoader.js\";\nexport { generateId } from \"../system/bin/generateId.js\";\n\nexport type { FloatingImagesManagerInterface } from '../system/types/features.js';\n", "// src/spaceface/system/bin/generateId.ts\n\n\n/**\n * Generates a unique ID string with an optional prefix and length.\n *\n * @param prefix - The prefix for the ID (default: 'id').\n * @param length - The length of the random portion of the ID (default: 9).\n * @param useCrypto - Whether to use cryptographically secure random values (default: false).\n * @returns A unique ID string.\n */\nexport function generateId(prefix: string = 'id', length: number = 9, useCrypto: boolean = false): string {\n  if (!Number.isInteger(length) || length <= 0) {\n    throw new Error('Length must be a positive integer.');\n  }\n\n  const randomString = useCrypto\n    ? Array.from(crypto.getRandomValues(new Uint8Array(length)))\n        .map((byte) => (byte % 36).toString(36))\n        .join('')\n    : Math.random().toString(36).slice(2, 2 + length);\n\n  return `${prefix}-${randomString}`;\n}\n", "import { eventBus } from '../symlink.js';\n\nexport interface DevEventLoggerOptions {\n    includeDebug?: boolean;\n}\n\ntype LogLevel = 'debug' | 'info' | 'warn' | 'error' | 'log';\ntype EventPayloadObject = {\n    level?: LogLevel;\n    args?: unknown;\n    [key: string]: unknown;\n};\n\nexport function attachDevEventLogger(options: DevEventLoggerOptions = {}): void {\n    const isDevHost = ['localhost', '127.0.0.1'].some(host =>\n        window.location.hostname.includes(host),\n    );\n    if (!isDevHost) return;\n\n    eventBus.onAny((eventName: string, payload: unknown) => {\n        if (!options.includeDebug) {\n            const maybeLevel = (\n                typeof payload === 'object' &&\n                payload !== null &&\n                'level' in payload\n            ) ? (payload as { level?: unknown }).level : undefined;\n            if (eventName === 'log:debug') return;\n            if (eventName === 'log' && maybeLevel === 'debug') return;\n        }\n\n        const objectPayload: EventPayloadObject | undefined =\n            typeof payload === 'object' && payload !== null\n                ? payload as EventPayloadObject\n                : undefined;\n        const { level = 'log', args, ...otherDetails } = objectPayload ?? {};\n        if (!payload) {\n            console.log(`[spaceface onAny] Event: ${eventName} - no payload`);\n            return;\n        }\n        if (typeof payload === 'string') {\n            console.log(`[spaceface onAny] Event: ${eventName} [LOG]`, payload);\n            return;\n        }\n\n        const fullMessage = args ?? otherDetails ?? '(no details)';\n        const method = (['debug', 'info', 'warn', 'error', 'log'] as const).includes(level)\n            ? level\n            : 'log';\n        switch (method) {\n            case 'debug':\n                console.debug(`[SPCFC *] Event: ${eventName} [${String(level).toUpperCase()}] -`, fullMessage);\n                break;\n            case 'info':\n                console.info(`[SPCFC *] Event: ${eventName} [${String(level).toUpperCase()}] -`, fullMessage);\n                break;\n            case 'warn':\n                console.warn(`[SPCFC *] Event: ${eventName} [${String(level).toUpperCase()}] -`, fullMessage);\n                break;\n            case 'error':\n                console.error(`[SPCFC *] Event: ${eventName} [${String(level).toUpperCase()}] -`, fullMessage);\n                break;\n            default:\n                console.log(`[SPCFC *] Event: ${eventName} [${String(level).toUpperCase()}] -`, fullMessage);\n        }\n    });\n}\n", "// src/spaceface/app/bin/spaceface.core.ts\n\nimport {\n    generateId,\n    eventBus,\n    DomReadyPromise,\n    InactivityWatcher,\n    FloatingImagesManagerInterface\n} from './symlink.js';\nimport type { LogPayload } from '../system/types/bin.js';\nimport { EVENTS } from '../system/types/events.js';\nimport type {\n    AppConfigOptions,\n    AppRuntimeConfig,\n    FeatureModuleMap,\n    ManagedFeatureLifecycle,\n    PartialLoaderFeatureConfig,\n    SlideplayerFeatureConfig,\n    ScreensaverFeatureConfig,\n    FloatingImagesFeatureConfig,\n    ScrollDeckFeatureConfig,\n    SlidePlayerInstance,\n    ScrollDeckInstance,\n    ScreensaverControllerInstance,\n    PartialLoaderInstance,\n} from './types.js';\n\nexport class AppConfig {\n    public config: AppRuntimeConfig;\n\n    constructor(options: AppConfigOptions = {}) {\n        this.config = {\n            hostname: options.hostname ?? window.location.hostname,\n            production: options.production ?? (\n                window.location.hostname !== 'localhost' &&\n                !window.location.hostname.includes('127.0.0.1')\n            ),\n            features: options.features ?? {},\n            ...options,\n        };\n    }\n}\n\nexport class SpacefaceCore {\n    static EVENT_LOG = EVENTS.LOG;\n    static EVENT_TELEMETRY = EVENTS.TELEMETRY;\n\n    public appConfig: AppConfig;\n    public debug: boolean;\n    public pageType: string;\n    public startTime: number;\n\n    private featureModules: { [K in keyof FeatureModuleMap]: () => Promise<FeatureModuleMap[K]> };\n    private featureCache = new Map<keyof FeatureModuleMap, FeatureModuleMap[keyof FeatureModuleMap] | null>();\n    private inactivityWatcher: InactivityWatcher | null = null;\n    private screensaverController: ScreensaverControllerInstance | null = null;\n    private slideshows: SlidePlayerInstance[] = [];\n    private scrollDecks: ScrollDeckInstance[] = [];\n    private floatingImagesManagers: FloatingImagesManagerInterface[] = [];\n    private _partialUnsub?: () => void;\n    private _partialObserver?: { disconnect?: () => void };\n    private pjaxFeatures = new Map<string, { init: () => Promise<void> | void; when?: (pageType: string) => boolean }>();\n    private managedFeatures: ManagedFeatureLifecycle[] = [];\n    private onceFeatures: ManagedFeatureLifecycle[] = [];\n\n    constructor(options: AppConfigOptions = {}) {\n        this.appConfig = new AppConfig(options);\n        this.appConfig.config.features = this.normalizeFeaturesConfig(this.appConfig.config.features);\n        this.debug = !!this.appConfig.config.debug;\n        this.pageType = this.resolvePageType();\n        this.startTime = performance.now();\n\n        this.featureModules = {\n            partialLoader: () => import('../system/bin/PartialLoader.js'),\n            slideplayer: () => import('../system/features/SlidePlayer/SlidePlayer.js'),\n            scrollDeck: () => import('../system/features/ScrollDeck/ScrollDeck.js'),\n            screensaver: () => import('../system/features/Screensaver/ScreensaverController.js'),\n            floatingImages: () => import('../system/features/FloatingImages/FloatingImagesManager.js'),\n        };\n\n        if (!this.appConfig.config.features) {\n            this.log('warn', 'No features specified in config');\n        }\n\n        this.setupManagedFeatures();\n        this.setupOnceFeatures();\n    }\n\n    public log(level: 'debug' | 'info' | 'warn' | 'error', ...args: unknown[]): void {\n        if (!this.debug && level === 'debug') return;\n        const [first, ...rest] = args;\n        const message = typeof first === 'string' ? first : '';\n        const data = typeof first === 'string' ? (rest.length ? rest : undefined) : (args.length ? args : undefined);\n        const payload: LogPayload & { args: unknown[] } = {\n            level,\n            args,\n            scope: 'Spaceface',\n            message,\n            data,\n            time: Date.now(),\n        };\n        eventBus.emit(SpacefaceCore.EVENT_LOG, payload);\n        if (this.debug) {\n            console[level]?.(`[spaceface] [${level.toUpperCase()}]`, ...args);\n        }\n    }\n\n    private resolvePageType(): string {\n        const body = document.body;\n        if (body.dataset.page) return body.dataset.page;\n        const rawPath = window.location.pathname;\n        const path = rawPath.replace(/\\/+$/, '') || '/';\n        if (path === '/') return 'home';\n\n        const segment = path.split('/').filter(Boolean).pop() ?? 'default';\n        return segment\n            .replace(/\\.html$/i, '')\n            .replace(/^_+/, '')\n            || 'default';\n    }\n\n    private async loadFeatureModule<K extends keyof FeatureModuleMap>(name: K): Promise<FeatureModuleMap[K] | null> {\n        if (this.featureCache.has(name)) return this.featureCache.get(name) as FeatureModuleMap[K] | null;\n        try {\n            const module = await this.featureModules[name]?.();\n            if (!module) {\n                throw new Error(`Module \"${name}\" could not be loaded.`);\n            }\n            this.featureCache.set(name, module);\n            return module;\n        } catch (err) {\n            this.log('error', `Failed to load module \"${name}\"`, err);\n            this.featureCache.set(name, null);\n            return null;\n        }\n    }\n\n    public async initBase(): Promise<void> {\n        this.log('info', `App initialization started (Page: ${this.pageType})`);\n        document.documentElement.classList.add('js-enabled', `page-${this.pageType}`);\n        await DomReadyPromise.ready();\n        this.log('info', 'DOM ready');\n    }\n\n    public finishInit(): void {\n        const duration = (performance.now() - this.startTime).toFixed(2);\n        this.log('info', `App initialized in ${duration}ms`);\n        eventBus.emit(SpacefaceCore.EVENT_TELEMETRY, {\n            type: 'init:duration',\n            value: duration,\n            page: this.pageType,\n        });\n    }\n\n    public async initInactivityWatcher(): Promise<void> {\n        const start = performance.now();\n        const screensaver = this.appConfig.config.features.screensaver;\n        if (!screensaver || this.inactivityWatcher) {\n            this.emitFeatureTelemetry('inactivityWatcher', start, 'skipped');\n            return;\n        }\n        try {\n            this.inactivityWatcher = InactivityWatcher.getInstance({\n                inactivityDelay: screensaver.delay ?? 3000,\n            });\n            this.log('debug', `InactivityWatcher initialized with delay=${screensaver.delay ?? 3000}ms`);\n            this.emitFeatureTelemetry('inactivityWatcher', start, 'success');\n        } catch (error) {\n            this.emitFeatureTelemetry('inactivityWatcher', start, 'error', error);\n            throw error;\n        }\n    }\n\n    public async initSlidePlayer(): Promise<void> {\n        const start = performance.now();\n        const slideplayer: SlideplayerFeatureConfig | undefined = this.appConfig.config.features.slideplayer;\n        if (!slideplayer) {\n            this.emitFeatureTelemetry('slideplayer', start, 'skipped');\n            return;\n        }\n        try {\n            const module = await this.loadFeatureModule('slideplayer');\n            const SlidePlayer = module?.SlidePlayer;\n            if (!SlidePlayer) {\n                this.emitFeatureTelemetry('slideplayer', start, 'skipped');\n                return;\n            }\n            this.slideshows = Array.from(document.querySelectorAll<HTMLElement>('.slideshow-container')).map(node => {\n                const slideshow = new SlidePlayer(node, {\n                    interval: slideplayer.interval ?? 5000,\n                    includePicture: slideplayer.includePicture ?? false,\n                });\n                slideshow.ready?.then?.(() => {});\n                return slideshow;\n            });\n            this.log('info', `${this.slideshows.length} SlidePlayer instance(s) loaded`);\n            this.emitFeatureTelemetry('slideplayer', start, 'success');\n        } catch (error) {\n            this.emitFeatureTelemetry('slideplayer', start, 'error', error);\n            throw error;\n        }\n    }\n\n    public async initScreensaver(): Promise<void> {\n        const start = performance.now();\n        const screensaver: ScreensaverFeatureConfig | undefined = this.appConfig.config.features.screensaver;\n        if (!screensaver?.partialUrl) {\n            this.log('error', \"Screensaver configuration is missing or incomplete\");\n            this.emitFeatureTelemetry('screensaver', start, 'skipped');\n            return;\n        }\n        try {\n            const module = await this.loadFeatureModule('screensaver');\n            const ScreensaverController = module?.ScreensaverController;\n            if (!ScreensaverController) {\n                throw new Error('ScreensaverController module is unavailable.');\n            }\n            const id = generateId('screensaver', 9);\n            const container = Object.assign(document.createElement('div'), {\n                id,\n                style: 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 999; display: none;',\n            });\n            document.body.appendChild(container);\n            this.screensaverController = new ScreensaverController({\n                partialUrl: screensaver.partialUrl,\n                targetSelector: `#${id}`,\n                ...(screensaver.delay !== undefined && { inactivityDelay: screensaver.delay }),\n            });\n            await this.screensaverController?.init?.();\n            eventBus.emit(EVENTS.SCREENSAVER_INITIALIZED, id);\n            this.log('info', 'Screensaver initialized:', id);\n            this.emitFeatureTelemetry('screensaver', start, 'success');\n        } catch (error) {\n            this.log('error', 'Failed to initialize screensaver:', error);\n            this.emitFeatureTelemetry('screensaver', start, 'error', error);\n        }\n    }\n\n    public async initScrollDeck(): Promise<void> {\n        const start = performance.now();\n        const scrollDeck: ScrollDeckFeatureConfig | undefined = this.appConfig.config.features.scrollDeck;\n        if (!scrollDeck) {\n            this.emitFeatureTelemetry('scrollDeck', start, 'skipped');\n            return;\n        }\n\n        try {\n            const module = await this.loadFeatureModule('scrollDeck');\n            const ScrollDeck = module?.ScrollDeck;\n            if (!ScrollDeck) {\n                this.emitFeatureTelemetry('scrollDeck', start, 'skipped');\n                return;\n            }\n\n            const selector = scrollDeck.selector ?? '.scroll-deck-container';\n            const containers = Array.from(document.querySelectorAll<HTMLElement>(selector));\n            if (!containers.length) {\n                this.emitFeatureTelemetry('scrollDeck', start, 'skipped');\n                return;\n            }\n\n            this.destroyScrollDecks();\n            this.scrollDecks = containers.map(container => {\n                return new ScrollDeck(container, {\n                    includePicture: scrollDeck.includePicture ?? false,\n                    debug: scrollDeck.debug ?? this.debug,\n                });\n            });\n\n            this.log('info', `${this.scrollDecks.length} ScrollDeck instance(s) loaded`);\n            this.emitFeatureTelemetry('scrollDeck', start, 'success');\n        } catch (error) {\n            this.emitFeatureTelemetry('scrollDeck', start, 'error', error);\n            throw error;\n        }\n    }\n\n    public async initPartialLoader(): Promise<PartialLoaderInstance | null> {\n        const start = performance.now();\n        const config: PartialLoaderFeatureConfig | undefined = this.appConfig.config.features.partialLoader;\n        if (!config?.enabled) {\n            this.emitFeatureTelemetry('partialLoader', start, 'skipped');\n            return null;\n        }\n        try {\n            const module = await this.loadFeatureModule('partialLoader');\n            const PartialLoader = module?.PartialLoader;\n            if (!PartialLoader) {\n                this.emitFeatureTelemetry('partialLoader', start, 'skipped');\n                return null;\n            }\n            const loader = new PartialLoader({\n                debug: config.debug ?? this.debug,\n                baseUrl: config.baseUrl ?? '/',\n                cacheEnabled: config.cacheEnabled ?? true,\n                timeout: config.timeout,\n                retryAttempts: config.retryAttempts,\n            });\n            await loader.loadContainer(document);\n            const watchResult = loader.watch?.(document);\n            if (typeof watchResult === 'function') {\n                this._partialUnsub = watchResult;\n            } else if (watchResult) {\n                this._partialObserver = watchResult;\n            }\n            this.log('info', 'PartialLoader initialized');\n            this.emitFeatureTelemetry('partialLoader', start, 'success');\n            return loader;\n        } catch (error) {\n            this.emitFeatureTelemetry('partialLoader', start, 'error', error);\n            throw error;\n        }\n    }\n\n    public async initDomFeatures(): Promise<void> {\n        await this.runFeatureGraph(this.managedFeatures, 'init');\n    }\n\n    public async initOnceFeatures(): Promise<void> {\n        await this.runFeatureGraph(this.onceFeatures, 'init', { continueOnError: true });\n        this.log('info', `Page features initialized for: ${this.pageType}`);\n    }\n\n    public registerPjaxFeature(\n        name: string,\n        init: () => Promise<void> | void,\n        when?: (pageType: string) => boolean\n    ): void {\n        if (this.pjaxFeatures.has(name)) return;\n        this.pjaxFeatures.set(name, { init, when });\n    }\n\n    public async handlePjaxComplete(): Promise<void> {\n        this.pageType = this.resolvePageType();\n        document.documentElement.classList.add(`page-${this.pageType}`);\n\n        await this.runFeatureGraph(this.managedFeatures, 'onRouteChange');\n\n        for (const { init, when } of this.pjaxFeatures.values()) {\n            if (when && !when(this.pageType)) continue;\n            await init();\n        }\n    }\n\n    public destroy(): void {\n        this._partialUnsub?.();\n        this._partialObserver?.disconnect?.();\n        this.managedFeatures.forEach(feature => feature.destroy());\n        this.onceFeatures.forEach(feature => feature.destroy());\n        this.featureCache.clear();\n        document.querySelector('[id^=\"screensaver\"]')?.remove();\n        this.log('info', 'Spaceface destroyed, all resources released.');\n    }\n\n    private emitFeatureTelemetry(\n        feature: string,\n        startTime: number,\n        status: 'success' | 'skipped' | 'error',\n        error?: unknown\n    ): void {\n        const duration = (performance.now() - startTime).toFixed(2);\n        eventBus.emit(SpacefaceCore.EVENT_TELEMETRY, {\n            type: 'feature:init',\n            feature,\n            status,\n            duration,\n            page: this.pageType,\n            error,\n        });\n    }\n\n    public async initFloatingImages(): Promise<void> {\n        const start = performance.now();\n        const floatingImages: FloatingImagesFeatureConfig | undefined = this.appConfig.config.features.floatingImages;\n        if (!floatingImages) {\n            this.emitFeatureTelemetry('floatingImages', start, 'skipped');\n            return;\n        }\n\n        try {\n            const module = await this.loadFeatureModule('floatingImages');\n            const FloatingImagesManager = module?.FloatingImagesManager;\n            if (!FloatingImagesManager) {\n                this.emitFeatureTelemetry('floatingImages', start, 'skipped');\n                return;\n            }\n\n            const selector = floatingImages.selector ?? '.floating-images-container';\n            const containers = Array.from(document.querySelectorAll<HTMLElement>(selector));\n            if (!containers.length) {\n                this.emitFeatureTelemetry('floatingImages', start, 'skipped');\n                return;\n            }\n\n            this.destroyFloatingImagesManagers();\n            const shouldPauseOnScreensaver =\n                floatingImages.pauseOnScreensaver ?? (this.pageType === 'floatingimages');\n            this.floatingImagesManagers = containers.map(container => {\n                return new FloatingImagesManager(container, {\n                    maxImages: floatingImages.maxImages,\n                    debug: floatingImages.debug ?? this.debug,\n                    hoverBehavior: floatingImages.hoverBehavior ?? 'none',\n                    hoverSlowMultiplier: floatingImages.hoverSlowMultiplier ?? 0.2,\n                    tapToFreeze: floatingImages.tapToFreeze ?? true,\n                    pauseOnScreensaver: shouldPauseOnScreensaver,\n                });\n            });\n\n            this.log('info', `${this.floatingImagesManagers.length} FloatingImages instance(s) loaded`);\n            this.emitFeatureTelemetry('floatingImages', start, 'success');\n        } catch (error) {\n            this.emitFeatureTelemetry('floatingImages', start, 'error', error);\n            throw error;\n        }\n    }\n\n    private destroyFloatingImagesManagers(): void {\n        this.floatingImagesManagers.forEach(manager => manager.destroy?.());\n        this.floatingImagesManagers = [];\n    }\n\n    private destroySlidePlayers(): void {\n        this.slideshows.forEach(slideshow => slideshow.destroy?.());\n        this.slideshows = [];\n    }\n\n    private destroyScrollDecks(): void {\n        this.scrollDecks.forEach(scrollDeck => scrollDeck.destroy?.());\n        this.scrollDecks = [];\n    }\n\n    private setupManagedFeatures(): void {\n        this.managedFeatures = [\n            {\n                name: 'slideplayer',\n                dependsOn: [],\n                init: () => this.initSlidePlayer(),\n                onRouteChange: async () => {\n                    this.destroySlidePlayers();\n                    await this.initSlidePlayer();\n                },\n                destroy: () => this.destroySlidePlayers(),\n            },\n            {\n                name: 'scrollDeck',\n                dependsOn: [],\n                init: () => this.initScrollDeck(),\n                onRouteChange: async () => {\n                    this.destroyScrollDecks();\n                    await this.initScrollDeck();\n                },\n                destroy: () => this.destroyScrollDecks(),\n            },\n            {\n                name: 'floatingImages',\n                dependsOn: [],\n                init: () => this.initFloatingImages(),\n                onRouteChange: async () => {\n                    this.destroyFloatingImagesManagers();\n                    await this.initFloatingImages();\n                },\n                destroy: () => this.destroyFloatingImagesManagers(),\n            },\n        ];\n    }\n\n    private setupOnceFeatures(): void {\n        this.onceFeatures = [\n            {\n                name: 'inactivityWatcher',\n                dependsOn: [],\n                init: () => this.initInactivityWatcher(),\n                destroy: () => this.inactivityWatcher?.destroy?.(),\n            },\n            {\n                name: 'screensaver',\n                dependsOn: ['inactivityWatcher'],\n                init: () => this.initScreensaver(),\n                destroy: () => this.screensaverController?.destroy?.(),\n            },\n        ];\n    }\n\n    private async runFeatureGraph(\n        features: ManagedFeatureLifecycle[],\n        stage: 'init' | 'onRouteChange',\n        options: { continueOnError?: boolean } = {}\n    ): Promise<void> {\n        const pending = new Map(features.map(feature => [feature.name, feature]));\n        const completed = new Set<string>();\n        const failed = new Set<string>();\n        let guard = 0;\n\n        while (pending.size) {\n            guard++;\n            if (guard > features.length * 2) {\n                throw new Error('Feature dependency graph contains a cycle or unresolved dependency.');\n            }\n\n            let progressed = false;\n            for (const [name, feature] of Array.from(pending.entries())) {\n                const deps = feature.dependsOn ?? [];\n                const blockedByFailedDep = deps.some(dep => failed.has(dep));\n                if (blockedByFailedDep) {\n                    failed.add(name);\n                    pending.delete(name);\n                    progressed = true;\n                    this.log('warn', `Skipping feature \"${name}\" due to failed dependency`, { deps });\n                    continue;\n                }\n                if (!deps.every(dep => completed.has(dep))) continue;\n\n                try {\n                    if (stage === 'onRouteChange' && feature.onRouteChange) {\n                        await feature.onRouteChange(this.pageType);\n                    } else {\n                        await feature.init();\n                    }\n\n                    completed.add(name);\n                } catch (error) {\n                    failed.add(name);\n                    if (!options.continueOnError) {\n                        throw error;\n                    }\n                    this.log('error', `Feature \"${name}\" failed during ${stage}`, error);\n                } finally {\n                    pending.delete(name);\n                    progressed = true;\n                }\n            }\n\n            if (!progressed) {\n                const unresolved = Array.from(pending.keys()).join(', ');\n                throw new Error(`Unresolved feature dependencies: ${unresolved}`);\n            }\n        }\n    }\n\n    public getFeatureSnapshot(): {\n        pageType: string;\n        managedFeatures: string[];\n        onceFeatures: string[];\n        activeSlidePlayers: number;\n        activeScrollDecks: number;\n        activeFloatingImagesManagers: number;\n        inactivityWatcherReady: boolean;\n        screensaverReady: boolean;\n        partialLoaderWatching: boolean;\n    } {\n        return {\n            pageType: this.pageType,\n            managedFeatures: this.managedFeatures.map(f => f.name),\n            onceFeatures: this.onceFeatures.map(f => f.name),\n            activeSlidePlayers: this.slideshows.length,\n            activeScrollDecks: this.scrollDecks.length,\n            activeFloatingImagesManagers: this.floatingImagesManagers.length,\n            inactivityWatcherReady: !!this.inactivityWatcher,\n            screensaverReady: !!this.screensaverController,\n            partialLoaderWatching: !!(this._partialUnsub || this._partialObserver),\n        };\n    }\n\n    private normalizeFeaturesConfig(features: AppRuntimeConfig['features']): AppRuntimeConfig['features'] {\n        const normalized = { ...features };\n\n        const isPositiveNumber = (value: unknown) => typeof value === 'number' && Number.isFinite(value) && value > 0;\n\n        if (normalized.slideplayer) {\n            if (normalized.slideplayer.interval !== undefined && !isPositiveNumber(normalized.slideplayer.interval)) {\n                this.log('warn', 'Invalid slideplayer.interval; expected positive number. Falling back to default.');\n                delete normalized.slideplayer.interval;\n            }\n        }\n\n        if (normalized.screensaver) {\n            if (typeof normalized.screensaver.partialUrl !== 'string' || !normalized.screensaver.partialUrl.trim()) {\n                this.log('warn', 'Invalid screensaver.partialUrl; disabling screensaver feature.');\n                delete normalized.screensaver;\n            } else if (normalized.screensaver.delay !== undefined && !isPositiveNumber(normalized.screensaver.delay)) {\n                this.log('warn', 'Invalid screensaver.delay; removing delay override.');\n                delete normalized.screensaver.delay;\n            }\n        }\n\n        if (normalized.floatingImages) {\n            if (normalized.floatingImages.maxImages !== undefined && !isPositiveNumber(normalized.floatingImages.maxImages)) {\n                this.log('warn', 'Invalid floatingImages.maxImages; removing override.');\n                delete normalized.floatingImages.maxImages;\n            }\n            if (\n                normalized.floatingImages.hoverSlowMultiplier !== undefined &&\n                (typeof normalized.floatingImages.hoverSlowMultiplier !== 'number' || normalized.floatingImages.hoverSlowMultiplier < 0)\n            ) {\n                this.log('warn', 'Invalid floatingImages.hoverSlowMultiplier; removing override.');\n                delete normalized.floatingImages.hoverSlowMultiplier;\n            }\n            if (\n                normalized.floatingImages.selector !== undefined &&\n                typeof normalized.floatingImages.selector !== 'string'\n            ) {\n                this.log('warn', 'Invalid floatingImages.selector; removing override.');\n                delete normalized.floatingImages.selector;\n            }\n        }\n\n        if (normalized.scrollDeck) {\n            if (\n                normalized.scrollDeck.selector !== undefined &&\n                typeof normalized.scrollDeck.selector !== 'string'\n            ) {\n                this.log('warn', 'Invalid scrollDeck.selector; removing override.');\n                delete normalized.scrollDeck.selector;\n            }\n        }\n\n        if (normalized.partialLoader) {\n            if (normalized.partialLoader.timeout !== undefined && !isPositiveNumber(normalized.partialLoader.timeout)) {\n                this.log('warn', 'Invalid partialLoader.timeout; removing override.');\n                delete normalized.partialLoader.timeout;\n            }\n            if (normalized.partialLoader.retryAttempts !== undefined && !isPositiveNumber(normalized.partialLoader.retryAttempts)) {\n                this.log('warn', 'Invalid partialLoader.retryAttempts; removing override.');\n                delete normalized.partialLoader.retryAttempts;\n            }\n        }\n\n        return normalized;\n    }\n}\n", "import { SpacefaceCore } from './spaceface.core.js';\nimport type { SpacefaceFeaturesConfig } from './types.js';\n\nexport interface StartupOptions {\n    features: SpacefaceFeaturesConfig;\n    debug?: boolean;\n    usePartialLoader?: boolean;\n    usePjax?: boolean;\n    pjaxContainerSelector?: string;\n    enableDevEventLogging?: () => void;\n}\n\nexport function startup(options: StartupOptions): SpacefaceCore {\n    const app = new SpacefaceCore({\n        features: options.features,\n        debug: options.debug,\n    });\n\n    void app.initBase().then(async () => {\n        if (options.enableDevEventLogging) {\n            options.enableDevEventLogging();\n        }\n\n        if (options.usePartialLoader) {\n            await app.initPartialLoader();\n        }\n\n        await app.initDomFeatures();\n        await app.initOnceFeatures();\n        app.finishInit();\n\n        if (options.usePjax) {\n            const { initPjax } = await import('./pjax.js');\n            initPjax({ containerSelector: options.pjaxContainerSelector ?? '[data-pjax=\"container\"]' });\n            document.addEventListener('pjax:complete', () => {\n                void app.handlePjaxComplete();\n            });\n        }\n    });\n\n    window.addEventListener('beforeunload', () => {\n        app.destroy();\n        app.log('info', 'App destroyed on beforeunload');\n    });\n\n    return app;\n}\n", "import { defaultFeatures } from './config/features.js';\nimport { attachDevEventLogger } from './dev/devEventLogger.js';\nimport { startup } from './startup.js';\n\nconst isDevHost = ['localhost', '127.0.0.1'].some(host =>\n    window.location.hostname.includes(host),\n);\n\nstartup({\n    features: defaultFeatures,\n    debug: isDevHost,\n    usePjax: true,\n    pjaxContainerSelector: '[data-pjax=\"container\"]',\n    enableDevEventLogging: () => attachDevEventLogger({ includeDebug: isDevHost }),\n});\n"],
  "mappings": "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",
  "names": ["EventBus", "eventBus", "init_EventBus", "__esmMin", "enable", "event", "fn", "priority", "list", "listener", "i", "wrapper", "payload", "l", "err", "anyList", "results", "message", "error", "EventWatcher", "init_EventWatcher", "__esmMin", "init_EventBus", "target", "debug", "maybeTarget", "levelOrMessage", "messageOrData", "data", "level", "message", "payload", "logPayload", "eventBus", "logKey", "sanitizedPayload", "error", "err", "type", "handler", "options", "e", "createTimeout", "id", "fn", "ms", "debounce", "func", "delay", "immediate", "timer", "debounced", "args", "callNow", "throttle", "options", "leading", "trailing", "lastCall", "lastArgs", "invoke", "throttled", "now", "remaining", "init_timing", "__esmMin", "EVENTS", "init_events", "__esmMin", "InactivityWatcher", "init_InactivityWatcher", "__esmMin", "init_EventWatcher", "init_EventBus", "init_timing", "init_events", "_InactivityWatcher", "EventWatcher", "target", "options", "throttle", "now", "eventBus", "EVENTS", "EventLogger", "init_EventLogger", "__esmMin", "init_EventBus", "scope", "devMode", "level", "levels", "currentLevelIndex", "message", "data", "entry", "eventBus", "error", "method", "prefix", "msg", "EventBinder", "eventBinder", "init_EventBinder", "__esmMin", "init_EventBus", "init_EventLogger", "_EventBinder", "debug", "EventLogger", "method", "details", "payload", "error", "signal", "listener", "enable", "event", "handler", "b", "unsubscribe", "eventBus", "err", "target", "options", "maybeTarget", "controller", "normalizedOptions", "optionsEqual", "a", "i", "callback", "binder", "result", "PartialLoader_exports", "__export", "PartialLoader", "init_PartialLoader", "__esmMin", "init_timing", "init_EventBus", "options", "msg", "data", "logKey", "payload", "eventBus", "input", "items", "results", "item", "error", "url", "link", "src", "info", "container", "id", "fetchPromise", "html", "attempt", "controller", "timeoutId", "res", "err", "template", "div", "base", "resolvedUrl", "ms", "resolve", "links", "observer", "debounce", "PartialFetcher", "init_PartialFetcher", "__esmMin", "init_EventBus", "init_PartialLoader", "PartialLoader", "message", "data", "payload", "eventBus", "url", "targetSelector", "options", "loader", "container", "error", "urls", "activeLoader", "dummyContainer", "AsyncImageLoader", "init_AsyncImageLoader", "__esmMin", "container", "options", "message", "data", "methodName", "selector", "images", "el", "includeFailed", "timeout", "results", "img", "resolve", "onLoad", "timer", "onError", "r", "sources", "picture", "source", "AnimationLoop", "animationLoop", "init_AnimationLoop", "__esmMin", "errorHandler", "callback", "cb", "err", "AnimationPolicy", "init_AnimationPolicy", "__esmMin", "reason", "paused", "SlidePlayer_exports", "__export", "SlidePlayer", "init_SlidePlayer", "__esmMin", "init_EventBus", "init_EventBinder", "init_AsyncImageLoader", "init_AnimationLoop", "init_AnimationPolicy", "init_events", "_SlidePlayer", "AnimationPolicy", "containerOrSelector", "interval", "includePicture", "dotsSelector", "autoCreateDots", "startPaused", "enableBusEvents", "autoplay", "debug", "AsyncImageLoader", "EventBinder", "err", "level", "message", "data", "payload", "eventBus", "EVENTS", "container", "animationLoop", "now", "reason", "shouldPause", "nowPaused", "event", "index", "restart", "prevIndex", "_", "i", "dot", "prev", "ev", "dx", "dy", "direction", "type", "detail", "busEvent", "ResizeManager", "resizeManager", "init_ResizeManager", "__esmMin", "init_timing", "enabled", "message", "data", "cb", "options", "debounce", "throttle", "wrappedCb", "handler", "el", "entry", "callbacks", "observer", "entries", "fn", "error", "rect", "ScrollDeck_exports", "__export", "ScrollDeck", "init_ScrollDeck", "__esmMin", "init_EventBinder", "init_AsyncImageLoader", "init_ResizeManager", "_ScrollDeck", "containerOrSelector", "options", "EventBinder", "AsyncImageLoader", "err", "level", "message", "data", "container", "dot", "resizeManager", "vh", "value", "min", "max", "start", "end", "t", "slide", "h", "ty", "tz", "scale", "z", "yInDeck", "n", "segment", "local", "activeDot", "index", "progress", "cardH", "startY", "prev", "curr", "prevSlide", "currSlide", "prevScale", "currY", "clamp", "init_math", "__esmMin", "value", "min", "max", "DAMPING", "MIN_VELOCITY", "MAX_SPEED", "VELOCITY_JITTER", "FloatingImage", "init_FloatingImage", "__esmMin", "init_math", "element", "dims", "options", "message", "data", "x", "y", "multiplier", "applyPosition", "signX", "clamp", "signY", "speedSquared", "scale", "PerformanceMonitor", "init_PerformanceMonitor", "__esmMin", "now", "delta", "currentFPS", "level", "settingsMap", "FloatingImagesManager_exports", "__export", "FloatingImagesManager", "init_FloatingImagesManager", "__esmMin", "init_FloatingImage", "init_PerformanceMonitor", "init_ResizeManager", "init_AsyncImageLoader", "init_AnimationLoop", "init_EventBus", "init_timing", "init_AnimationPolicy", "init_events", "AnimationPolicy", "container", "options", "PerformanceMonitor", "perfSettings", "entries", "entry", "AsyncImageLoader", "animationLoop", "level", "message", "data", "payload", "eventBus", "EVENTS", "resizeManager", "onVisibilityChange", "dims", "imgElements", "el", "err", "floatingImage", "FloatingImage", "debounce", "img", "error", "multiplier", "imageMultiplier", "hoverEnabled", "touchEnabled", "onPointerEnter", "onPointerLeave", "onPointerUp", "event", "unsub", "ScreensaverController_exports", "__export", "ScreensaverController", "init_ScreensaverController", "__esmMin", "init_EventBus", "init_EventBinder", "init_InactivityWatcher", "init_PartialFetcher", "init_FloatingImagesManager", "init_events", "_ScreensaverController", "options", "PartialFetcher", "EventBinder", "level", "message", "data", "payload", "eventBus", "EVENTS", "InactivityWatcher", "error", "container", "FloatingImagesManager", "err", "pjax_exports", "__export", "Pjax", "initPjax", "options", "pjax", "isAbortError", "init_pjax", "__esmMin", "error", "event", "link", "href", "url", "pushState", "container", "controller", "requestToken", "cached", "title", "html", "res", "text", "parsed", "nextContainer", "firstKey", "defaultFeatures", "devFeatures", "DomReadyPromise", "#readyPromise", "resolve", "selectors", "options", "timeout", "root", "signal", "selectorList", "foundElements", "reject", "checkForElements", "selector", "el", "cleanup", "observer", "timeoutId", "missing", "s", "onAbort", "init_InactivityWatcher", "init_EventBus", "init_EventBinder", "init_EventWatcher", "init_PartialFetcher", "init_PartialLoader", "generateId", "prefix", "length", "useCrypto", "randomString", "byte", "attachDevEventLogger", "options", "host", "eventBus", "eventName", "payload", "maybeLevel", "objectPayload", "level", "args", "otherDetails", "fullMessage", "init_events", "AppConfig", "options", "SpacefaceCore", "_SpacefaceCore", "EVENTS", "level", "args", "first", "rest", "message", "data", "payload", "eventBus", "body", "path", "name", "module", "err", "DomReadyPromise", "duration", "start", "screensaver", "InactivityWatcher", "error", "slideplayer", "SlidePlayer", "node", "slideshow", "ScreensaverController", "id", "generateId", "container", "scrollDeck", "ScrollDeck", "selector", "containers", "config", "PartialLoader", "loader", "watchResult", "init", "when", "feature", "startTime", "status", "floatingImages", "FloatingImagesManager", "shouldPauseOnScreensaver", "manager", "features", "stage", "pending", "completed", "failed", "guard", "progressed", "deps", "dep", "unresolved", "f", "normalized", "isPositiveNumber", "value", "startup", "options", "app", "SpacefaceCore", "initPjax", "isDevHost", "host", "startup", "defaultFeatures", "attachDevEventLogger"]
}
